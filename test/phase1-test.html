<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Phase 1 Task 1 - Ready/Wait/Resume Test</title>
	<style>
		body {
			margin: 20px;
			font-family: monospace;
			background: #222;
			color: #fff;
		}
		.pass { color: #4CAF50; }
		.fail { color: #f44336; }
		.test { margin: 10px 0; padding: 10px; background: #333; }
	</style>
</head>
<body>
	<h1>Phase 1 Task 1: Ready/Wait/Resume System Test</h1>
	<div id="results"></div>

	<script type="module">
		const results = document.getElementById( "results" );

		function testResult( name, passed, message = "" ) {
			const div = document.createElement( "div" );
			div.className = "test";
			const status = passed ? "✓ PASS" : "✗ FAIL";
			const className = passed ? "pass" : "fail";
			div.innerHTML = `<span class="${className}">${status}</span> - ${name}`;
			if( message ) {
				div.innerHTML += `<br><pre>${message}</pre>`;
			}
			results.appendChild( div );
		}

		try {
			const piModule = await import( "../build/dist/pi.esm.min.js" );
			const $ = piModule.default;

			// Test 1: $ alias exists
			testResult( "$ alias exists", typeof $ === "object" );

			// Test 2: pi._ has wait and resume
			testResult( "pi._.wait exists", typeof $._.wait === "function" );
			testResult( "pi._.resume exists", typeof $._.resume === "function" );

			// Test 3: $.ready command exists
			testResult( "$.ready exists", typeof $.ready === "function" );

			// Test 4: $.ready executes immediately if doc ready
			let readyExecuted = false;
			$.ready( function() {
				readyExecuted = true;
			} );

			setTimeout( () => {
				testResult(
					"$.ready executes callback when doc ready",
					readyExecuted,
					"Callback should have executed immediately"
				);
			}, 100 );

			// Test 5: wait/resume delays ready
			let delayedExecuted = false;
			$._.wait();

			$.ready( function() {
				delayedExecuted = true;
			} );

			setTimeout( () => {
				testResult(
					"$.ready delayed by wait()",
					!delayedExecuted,
					"Should NOT execute while wait count > 0"
				);

				// Now resume
				$._.resume();

				setTimeout( () => {
					testResult(
						"$.ready executes after resume()",
						delayedExecuted,
						"Should execute after resume brings count to 0"
					);
				}, 100 );
			}, 100 );

		} catch( e ) {
			testResult( "Load Pi.js", false, e.message + "\n" + e.stack );
		}
	</script>
</body>
</html>

