<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Pi.js 2.0 - API Inspector</title>
	<style>
		body {
			margin: 0;
			padding: 20px;
			font-family: monospace;
			background: #222;
			color: #fff;
		}
		h1 {
			color: #4CAF50;
		}
		.section {
			margin: 20px 0;
			padding: 15px;
			background: #333;
			border-radius: 5px;
		}
		.section h2 {
			margin-top: 0;
			color: #FFC107;
		}
		.command-list {
			background: #1a1a1a;
			padding: 15px;
			border-radius: 3px;
			max-height: 500px;
			overflow-y: auto;
		}
		.command {
			padding: 3px 0;
			color: #4CAF50;
		}
		.count {
			color: #4CAF50;
			font-weight: bold;
		}
		.status {
			color: #FFC107;
			font-style: italic;
		}
		.category {
			color: #2196F3;
			font-weight: bold;
			margin-top: 10px;
			margin-bottom: 5px;
		}
		canvas {
			margin: 20px 0;
			display: block;
		}
	</style>
</head>
<body>
	<h1>Pi.js 2.0 API Inspector</h1>
	<p>Inspecting the current API structure...</p>

	<div id="results"></div>

	<script src="../build/pi.js"></script>
	<script>
		const results = document.getElementById( "results" );

		// Helper to fetch file size
		async function getFileSize( url ) {
			try {
				const response = await fetch( url );
				if( response.ok ) {
					const blob = await response.blob();
					return blob.size;
				}
			} catch( e ) {
				console.warn( `Could not fetch size for ${url}` );
			}
			return null;
		}

		// Helper to format bytes
		function formatBytes( bytes ) {
			if( bytes === null ) return "N/A";
			if( bytes < 1024 ) return `${bytes} B`;
			if( bytes < 1024 * 1024 ) return `${(bytes / 1024).toFixed(2)} KB`;
			return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;
		}

		async function inspectAPI() {
			try {
				// Use $ alias (pi.js loaded as IIFE)
				const pi = window.pi;
				const $ = window.$;

				// Fetch file sizes
				const sizes = {
					"unminified": await getFileSize( "../build/pi.js" ),
					"minified": await getFileSize( "../build/pi.min.js" ),
					"esm": await getFileSize( "../build/pi.esm.min.js" ),
					"cjs": await getFileSize( "../build/pi.cjs.min.js" )
				};

				// Create status section
				const statusSection = document.createElement( "div" );
				statusSection.className = "section";
				statusSection.innerHTML = `
					<h2>Pi.js v${pi.version}</h2>
					<h2>Refactor Progress: Phases 0-17 Complete âœ… (81%)</h2>
					<div class="status">
						<ul>
							<li>âœ… Phase 0-4: Foundation, Core, Screen, Helpers, Drawing</li>
							<li>âœ… Phase 6-7: Paint/Fill, Bezier Curves</li>
							<li>âœ… Phase 8-10: Images, Fonts/Text, Tables</li>
							<li>âœ… Phase 11-14: Input (Keyboard, Mouse, Touch, Gamepad)</li>
							<li>âœ… Phase 15-17: Sound, PLAY, Palette & Settings</li>
							<li>ðŸ”„ Phase 18-20: Testing, Documentation, Release</li>
						</ul>
					</div>
				`;
				results.appendChild( statusSection );

				// Create bundle size section
				const sizeSection = document.createElement( "div" );
				sizeSection.className = "section";
				sizeSection.innerHTML = "<h2>Bundle Sizes</h2>";
				
				const sizeList = document.createElement( "div" );
				sizeList.className = "command-list";
				
				sizeList.innerHTML = `
					<div class="command">
						<span class="count">Unminified (IIFE):</span> 
						${formatBytes( sizes.unminified )}
					</div>
					<div class="command">
						<span class="count">Minified (IIFE):</span> 
						${formatBytes( sizes.minified )}
					</div>
					<div class="command">
						<span class="count">ESM (minified):</span> 
						${formatBytes( sizes.esm )}
					</div>
					<div class="command">
						<span class="count">CJS (minified):</span> 
						${formatBytes( sizes.cjs )}
					</div>
				`;

				// Add compression ratio if both sizes available
				if( sizes.unminified && sizes.minified ) {
					const ratio = ((1 - sizes.minified / sizes.unminified) * 100).toFixed(1);
					sizeList.innerHTML += `
						<div class="command">
							<span class="count">Compression:</span> 
							${ratio}% smaller when minified
						</div>
					`;
				}
				
				sizeSection.appendChild( sizeList );
				results.appendChild( sizeSection );

				// Get all public API methods (exclude internal, util, version, _)
				const publicMethods = [];
				const screenMethods = [];
				
				for( const key in pi ) {
					if( key === "_" || key === "util" || key === "version" ) {
						continue;
					}
					if( typeof pi[ key ] === "function" ) {
						publicMethods.push( key );
					}
				}

				// Get screen methods by creating a test screen
				try {
					const testScreen = pi.screen( "1x1" );
					for( const key in testScreen ) {
						if( typeof testScreen[ key ] === "function" ) {
							screenMethods.push( key );
						}
					}
					pi.removeAllScreens();
				} catch( e ) {
					console.warn( "Could not enumerate screen methods:", e );
				}

				// Display public API methods
				const apiSection = document.createElement( "div" );
				apiSection.className = "section";
				apiSection.innerHTML = "<h2>Public API Methods</h2>";
				
				const apiList = document.createElement( "div" );
				apiList.className = "command-list";
				
				apiList.innerHTML = `<div class="count">Total Commands: ${publicMethods.length}</div>`;
				
				// Sort and display
				publicMethods.sort().forEach( method => {
					apiList.innerHTML += `<div class="command">$.${method}()</div>`;
				} );
				
				apiSection.appendChild( apiList );
				results.appendChild( apiSection );

				// Display screen methods
				if( screenMethods.length > 0 ) {
					const screenSection = document.createElement( "div" );
					screenSection.className = "section";
					screenSection.innerHTML = "<h2>Screen Instance Methods</h2>";
					
					const screenList = document.createElement( "div" );
					screenList.className = "command-list";
					
					screenList.innerHTML = `<div class="count">Total Methods: ${screenMethods.length}</div>`;
					
					screenMethods.sort().forEach( method => {
						screenList.innerHTML += `<div class="command">screen.${method}()</div>`;
					} );
					
					screenSection.appendChild( screenList );
					results.appendChild( screenSection );
				}

				// Display namespace structure
				const structureSection = document.createElement( "div" );
				structureSection.className = "section";
				structureSection.innerHTML = "<h2>API Namespace Structure</h2>";
				
				const structureList = document.createElement( "div" );
				structureList.className = "command-list";
				
				structureList.innerHTML = `
					<div class="command">âœ“ window.pi - Main API object</div>
					<div class="command">âœ“ window.$ - Preferred alias (same as pi)</div>
				`;
				
				// Check for _ namespace
				if( pi._ ) {
					structureList.innerHTML += `<div class="command">âœ“ pi._ - Internal API (for plugins)</div>`;
					const internalKeys = Object.keys( pi._ ).sort();
					internalKeys.forEach( key => {
						structureList.innerHTML += `<div class="command">  â””â”€ pi._.${key}</div>`;
					} );
				}
				
				// Check for util namespace
				if( pi.util ) {
					const utilCount = Object.keys( pi.util ).length;
					structureList.innerHTML += `<div class="command">âœ“ pi.util - ${utilCount} utility functions</div>`;
				}
				
				structureSection.appendChild( structureList );
				results.appendChild( structureSection );

				// Display implemented commands by category
				const implSection = document.createElement( "div" );
				implSection.className = "section";
				implSection.innerHTML = "<h2>Implemented Commands by Category</h2>";
				
				const implList = document.createElement( "div" );
				implList.className = "command-list";
				
				implList.innerHTML = `
					<div class="category">Core System (Phase 1):</div>
					<div class="command">â€¢ $.ready(callback) - Execute when Pi.js is loaded</div>
					<div class="command">â€¢ $.setScreen(screen) - Set active screen</div>
					<div class="command">â€¢ $.getScreen(id) - Get screen by ID</div>
					<div class="command">â€¢ $.removeAllScreens() - Remove all screens</div>
					<div class="command">â€¢ $.setDefaultColor(color) - Set default drawing color</div>
					<div class="command">â€¢ $.setDefaultPal(palette) - Set default palette</div>
					<div class="command">â€¢ $.getDefaultPal() - Get default palette</div>
					<div class="command">â€¢ $.setDefaultInputFocus(element) - Set input focus</div>
					<div class="command">â€¢ $.set(options) - Global settings</div>

					<div class="category">Screen Management (Phase 2):</div>
					<div class="command">â€¢ $.screen(aspect, container?, options?) - Create screen/canvas</div>
					<div class="command">â€¢ screen.width() - Get screen width</div>
					<div class="command">â€¢ screen.height() - Get screen height</div>
					<div class="command">â€¢ screen.canvas() - Get canvas element</div>
					<div class="command">â€¢ screen.setBgColor(color) - Set background color</div>
					<div class="command">â€¢ screen.setContainerBgColor(color) - Set container bg</div>
					<div class="command">â€¢ screen.findColor(color) - Find/add color to palette</div>
					<div class="command">â€¢ screen.cls(x?, y?, width?, height?) - Clear screen</div>
					<div class="command">â€¢ screen.render() - Render to canvas</div>
					<div class="command">â€¢ screen.removeScreen() - Remove this screen</div>

					<div class="category">Drawing Commands (Phase 4):</div>
					<div class="command">â€¢ screen.pset(x, y) - Set pixel</div>
					<div class="command">â€¢ screen.line(x1, y1, x2, y2) - Draw line (Bresenham)</div>
					<div class="command">â€¢ screen.circle(x, y, radius, fillColor?) - Draw circle</div>
					<div class="command">â€¢ screen.rect(x, y, w, h, fillColor?) - Draw rectangle</div>

					<div class="category">Utility Functions (Phase 0):</div>
					<div class="command">â€¢ pi.util.* - ${Object.keys( pi.util || {} ).length} utility functions</div>
					<div class="command">  â””â”€ Color conversion, math helpers, type checking, etc.</div>

					<div class="category">Plugin API (pi._):</div>
					<div class="command">â€¢ pi._.addCommand() - Register single command</div>
					<div class="command">â€¢ pi._.addCommands() - Register dual pixel/AA command</div>
					<div class="command">â€¢ pi._.addSetting() - Register setting</div>
					<div class="command">â€¢ pi._.addPen() - Register pen mode</div>
					<div class="command">â€¢ pi._.addBlendCommand() - Register blend mode</div>
					<div class="command">â€¢ pi._.data - Access internal data store</div>
					<div class="command">â€¢ pi._.parseOptions() - Parse command parameters</div>
				`;
				
				implSection.appendChild( implList );
				results.appendChild( implSection );

				// Display utils
				if( pi.util ) {
					const utilsSection = document.createElement( "div" );
					utilsSection.className = "section";
					utilsSection.innerHTML = "<h2>Utility Functions (pi.util.*)</h2>";
					
					const utilsList = document.createElement( "div" );
					utilsList.className = "command-list";
					
					const utils = Object.keys( pi.util ).sort();
					utilsList.innerHTML = `<div class="count">Total: ${utils.length}</div>`;
					
					utils.forEach( util => {
						utilsList.innerHTML += `<div class="command">pi.util.${util}</div>`;
					} );
					
					utilsSection.appendChild( utilsList );
					results.appendChild( utilsSection );
				}

				// Next steps
				const nextSection = document.createElement( "div" );
				nextSection.className = "section";
				nextSection.innerHTML = `
					<h2>Remaining Phases</h2>
					<div class="status">
						<ul>
							<li>ðŸ”„ Phase 18: Testing & Bug Fixing - Visual regression, unit tests</li>
							<li>Phase 19: Documentation - API reference, migration guide</li>
							<li>Phase 20: Release Preparation - Version bump, changelog</li>
						</ul>
						<br>
						<h3 style="color: #4CAF50;">ðŸŽ‰ Core Porting Complete!</h3>
						<p style="color: #4CAF50;">All 17 core phases finished! 227KB unminified, 110KB minified.</p>
						<p style="color: #FFC107;">Next: Polish, test, document, and release v2.0.0!</p>
					</div>
				`;
				results.appendChild( nextSection );

				console.log( "Pi.js loaded successfully!" );
				console.log( "pi object:", pi );
				console.log( "$ alias:", $ );
				console.log( "Public methods:", publicMethods );

			} catch( e ) {
				results.innerHTML = `
					<div class="section">
						<h2 style="color: #f44336;">Error Loading API</h2>
						<div>Build the project first with: <code>npm run build</code></div>
						<pre style="color: #f44336;">${e.message}\n${e.stack}</pre>
					</div>
				`;
				console.error( "Failed to load Pi.js:", e );
			}
		}

		// Run inspection
		inspectAPI();
	</script>
</body>
</html>
