<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Phase 15-16: Sound & PLAY Test</title>
	<style>
		body {
			margin: 0;
			padding: 20px;
			font-family: monospace;
			background: #222;
			color: #fff;
		}
		h1 {
			color: #4CAF50;
		}
		.status {
			margin: 20px 0;
			padding: 15px;
			background: #333;
			border-radius: 5px;
		}
		canvas {
			margin: 20px 0;
			display: block;
		}
		.info {
			background: #1a1a1a;
			padding: 15px;
			border-radius: 5px;
			margin: 20px 0;
		}
		button {
			background: #4CAF50;
			color: white;
			border: none;
			padding: 10px 20px;
			margin: 5px;
			border-radius: 3px;
			cursor: pointer;
			font-family: monospace;
		}
		button:hover {
			background: #45a049;
		}
		button.danger {
			background: #f44336;
		}
		button.danger:hover {
			background: #da190b;
		}
	</style>
</head>
<body>
	<h1>Phase 15-16: Sound & PLAY Test</h1>
	<div class="status" id="status">Loading Pi.js...</div>
	<div id="container" style="width: 640px; height: 400px;"></div>

	<div class="info">
		<h3>WebAudio Tests:</h3>
		<button id="beep440">Beep (440Hz)</button>
		<button id="beep880">Beep (880Hz)</button>
		<button id="chord">Chord (C-E-G)</button>
		<button id="stopAll" class="danger">Stop All Sounds</button>
		
		<h3>Waveform Tests:</h3>
		<button id="sine">Sine Wave</button>
		<button id="square">Square Wave</button>
		<button id="sawtooth">Sawtooth Wave</button>
		<button id="triangle">Triangle Wave</button>
		
		<h3>PLAY Command Tests:</h3>
		<button id="playScale">Play Scale (C-D-E-F-G-A-B-C)</button>
		<button id="playMelody">Play Melody</button>
		<button id="playDotted">Dotted Notes (C. D. E.)</button>
		<button id="playVolume">Volume Test (V50 C V100 C)</button>
		<button id="playEnvelope">Envelope (MA50 MT80 MD20 C)</button>
		<button id="playWaveform">Waveform (SQUARE C SINE C)</button>
		<button id="stopPlay" class="danger">Stop PLAY</button>
		
		<h3>Volume Control:</h3>
		<button id="vol100">100%</button>
		<button id="vol50">50%</button>
		<button id="vol25">25%</button>
		<button id="vol0">Mute</button>
	</div>

	<script src="../build/pi.js"></script>
	<script>
		const status = document.getElementById( "status" );
		const $ = window.$ || window.pi;

		try {
			// Create screen
			const screen = $.screen( "640x400", "container" );
			screen.cls();
			screen.setFont( 4 );  // Use 8x14 font

			status.innerHTML = "✅ Sound and PLAY systems ready!";

			// Log display
			let logs = [];

			function addLog( msg, color ) {
				logs.push( { "msg": msg, "color": color || 15 } );
				if( logs.length > 25 ) {
					logs.shift();
				}
				redraw();
			}

			function redraw() {
				screen.cls();
				
				// Title
				screen.locate( 0, 0 );
				screen.setColor( 10 );
				screen.print( "SOUND & PLAY COMMAND TEST", true, true );
				
				// Draw logs
				for( let i = 0; i < logs.length; i++ ) {
					screen.locate( i + 2, 0 );
					screen.setColor( logs[ i ].color );
					screen.print( logs[ i ].msg, false );
				}
				
				screen.render();
			}

			// Beep tests
			document.getElementById( "beep440" ).addEventListener( "click", () => {
				addLog( "Playing 440Hz beep (1 second)", 11 );
				$.sound( 440, 1 );
			} );

			document.getElementById( "beep880" ).addEventListener( "click", () => {
				addLog( "Playing 880Hz beep (0.5 seconds)", 11 );
				$.sound( 880, 0.5 );
			} );

			document.getElementById( "chord" ).addEventListener( "click", () => {
				addLog( "Playing C-E-G chord", 13 );
				$.sound( 261.63, 2, 0.3 );  // C4
				$.sound( 329.63, 2, 0.3, "sine", 0.01 );  // E4
				$.sound( 392.00, 2, 0.3, "sine", 0.02 );  // G4
			} );

			document.getElementById( "stopAll" ).addEventListener( "click", () => {
				addLog( "Stopping all sounds", 12 );
				$.stopSound();
			} );

			// Waveform tests
			document.getElementById( "sine" ).addEventListener( "click", () => {
				addLog( "Sine wave (440Hz)", 14 );
				$.sound( 440, 1, 1, "sine" );
			} );

			document.getElementById( "square" ).addEventListener( "click", () => {
				addLog( "Square wave (440Hz)", 14 );
				$.sound( 440, 1, 1, "square" );
			} );

			document.getElementById( "sawtooth" ).addEventListener( "click", () => {
				addLog( "Sawtooth wave (440Hz)", 14 );
				$.sound( 440, 1, 1, "sawtooth" );
			} );

			document.getElementById( "triangle" ).addEventListener( "click", () => {
				addLog( "Triangle wave (440Hz)", 14 );
				$.sound( 440, 1, 1, "triangle" );
			} );

			// PLAY command tests
			document.getElementById( "playScale" ).addEventListener( "click", () => {
				addLog( "PLAY: C-D-E-F-G-A-B-C scale", 10 );
				$.play( "L4 O4 C D E F G A B O5 C" );
			} );

			document.getElementById( "playMelody" ).addEventListener( "click", () => {
				addLog( "PLAY: Simple melody", 10 );
				$.play( "T120 L8 O4 C E G O5 C O4 G E C" );
			} );

			document.getElementById( "playDotted" ).addEventListener( "click", () => {
				addLog( "PLAY: Dotted notes (1.5x duration)", 10 );
				$.play( "L4 O4 C. D. E." );
			} );

			document.getElementById( "playVolume" ).addEventListener( "click", () => {
				addLog( "PLAY: Volume control (50% then 100%)", 10 );
				$.play( "L4 O4 V50 C V100 C V25 E V100 G" );
			} );

			document.getElementById( "playEnvelope" ).addEventListener( "click", () => {
				addLog( "PLAY: Custom envelope (A=50% T=80% D=20%)", 10 );
				$.play( "MA50 MT80 MD20 L4 O4 C D E F" );
			} );

			document.getElementById( "playWaveform" ).addEventListener( "click", () => {
				addLog( "PLAY: Waveform types (square, sine)", 10 );
				$.play( "L4 O4 SQUARE C D SINE E F" );
			} );

			document.getElementById( "stopPlay" ).addEventListener( "click", () => {
				addLog( "Stopping PLAY", 12 );
				$.stopPlay();
			} );

			// Volume control
			document.getElementById( "vol100" ).addEventListener( "click", () => {
				$.setVolume( 1 );
				addLog( "Volume: 100%", 15 );
			} );

			document.getElementById( "vol50" ).addEventListener( "click", () => {
				$.setVolume( 0.5 );
				addLog( "Volume: 50%", 15 );
			} );

			document.getElementById( "vol25" ).addEventListener( "click", () => {
				$.setVolume( 0.25 );
				addLog( "Volume: 25%", 15 );
			} );

			document.getElementById( "vol0" ).addEventListener( "click", () => {
				$.setVolume( 0 );
				addLog( "Volume: Muted", 12 );
			} );

			// Initial display
			addLog( "Sound system loaded!", 10 );
			addLog( "Click buttons above to test audio.", 11 );
			addLog( "", 15 );
			addLog( "Commands available:", 14 );
			addLog( "  $.sound(freq, dur, vol?, type?) - Generate tone", 15 );
			addLog( "  $.play(string) - QBasic PLAY notation", 15 );
			addLog( "  $.stopSound() / $.stopPlay() - Stop playback", 15 );
			addLog( "  $.setVolume(vol) - Master volume control", 15 );
			addLog( "  $.createAudioPool(src, size) - Load sound files", 15 );

			console.log( "✅ Sound and PLAY systems initialized!" );
			console.log( "Commands:", {
				"sound": $.sound,
				"play": $.play,
				"stopSound": $.stopSound,
				"stopPlay": $.stopPlay,
				"setVolume": $.setVolume
			} );

		} catch( e ) {
			status.innerHTML = `✗ Error: ${e.message}`;
			console.error( "Test failed:", e );
			throw e;
		}
	</script>
</body>
</html>

