<!DOCTYPE html>
<html>
	<head>
		<title>Renderer Comprehensive</title>
		<script type="text/toml">
			[[TOML_START]]
			file = "renderer_comprehensive"
			name = "renderer comprehensive"
			lite = true
			width = 660
			height = 510
			delay = 100
			[[TOML_END]]
		</script>
		<script src="../../../build/pi-lite.js"></script>
		<script src="../../libs/seedrandom.js"></script>
		<style>
			html, body {
				background-color: grey;
				margin: 0;
				padding: 0;
			}
			.container {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				padding: 10px;
			}
			.screen {
				border: 2px solid #333;
				background-color: #000;
			}
		</style>
	</head>
<body>
	<div class="container">
		<div id="screen1" class="screen" style="width: 200px; height: 150px;"></div>
		<div id="screen2" class="screen" style="width: 200px; height: 150px;"></div>
		<div id="screen3" class="screen" style="width: 200px; height: 150px;"></div>
		<div id="screen4" class="screen" style="width: 200px; height: 150px;"></div>
	</div>
	
<script>
	Math.seedrandom( "constant" );
	$.ready( function() {
				
		// ============================================================
		// Screen 1: Blend Modes (replace, alpha)
		// ============================================================
		const replaceColor1 = "rgba(0,255,0,1)";
		const alphaColor1 =  "rgba(0,0,255,1)";
		const replaceColor2 = "rgba(0,255,0,0.5)";
		const alphaColor2 =  "rgba(0,0,255,0.5)";

		$.screen( "200x150", "screen1" );
		$.setBgColor( "#00000000" );
		$.setContainerBgColor( "#00000000" );
		$.setColor( 15 );
		$.setPosPx( 5, 5 );
		$.print( "1: BLEND MODES" );
		
		$.setPosPx( 5, 15 );
		$.setColor( replaceColor1 );
		$.print( "replace" );

		$.setPosPx( 80, 15 );
		$.setColor( alphaColor1 );
		$.print( "alpha", true );

		// Background pattern
		$.setColor( 7 );
		for( let x = 10; x < 180; x += 5 ) {
			for( let y = 30; y < 140; y += 5 ) {
				$.pset( x, y );
				$.pset( x - 1, y );
				$.pset( x + 1, y );
				$.pset( x, y - 1 );
				$.pset( x, y + 1 );
			}
		}
		
		// Replace blend 1
		$.setColor( replaceColor1 );
		$.setBlend( "replace" );
		$.rect( 15, 35, 100, 65, replaceColor2 );
		
		// Alpha blend 1
		$.setColor( alphaColor1 );
		$.setBlend( "alpha" );
		$.rect( 70, 35, 100, 65, alphaColor2 );

		// Replace blend 2
		$.setColor( replaceColor1 );
		$.setBlend( "replace" );
		$.rect( 15, 65, 100, 65, replaceColor2 );
		
		// Alpha blend 2
		$.setColor( alphaColor1 );
		$.setBlend( "alpha" );
		$.rect( 70, 65, 100, 65, alphaColor2 );

		// Reset blend to default
		$.setBlend( "replace" );
		
		// ============================================================
		// Screen 2: Noise Blending
		// ============================================================
		$.screen( "200x150", "screen2" );
		$.setColor( 15 );
		$.setPosPx( 5, 5 );
		$.print( "2: NOISE" );
		
		$.setColor( 10 );
		$.setPosPx( 5, 17 );
		$.print( "Noise 50" );

		$.setColor( 12 );
		$.setPosPx( 75, 17 );
		$.print( "Noise [30,60,30,0]" );

		// Background pattern
		$.setColor( 7 );
		for( let x = 10; x < 180; x += 5 ) {
			for( let y = 30; y < 140; y += 5 ) {
				$.pset( x, y );
				$.pset( x - 1, y );
				$.pset( x + 1, y );
				$.pset( x, y - 1 );
				$.pset( x, y + 1 );
			}
		}
		
		// Noise blend with single value
		$.setColor( 10 );
		$.setBlend( "replace", 50 );
		$.setNoise( 50, 1 );
		$.rect( 15, 35, 65, 45, "rgba(88,255,88,0.5)" );
		$.setBlend( "alpha" );
		$.setNoise( 25, 1 );
		$.rect( 15, 85, 65, 45, "rgba(88,255,88,0.5)" );
		
		// Noise blend with array
		$.setBlend( "replace" );
		$.setNoise( [ 30, 60, 30, 0 ] );
		$.setColor( 9 );
		$.setBlend( "replace" );
		$.setNoise( 35, 1 );
		$.rect( 105, 35, 65, 45, "rgba(88,88,255,0.5)" );
		$.setBlend( "alpha" );
		$.setNoise( 55, 1 );
		$.rect( 105, 85, 65, 45, "rgba(88,88,255,0.5)" );
		
		// ============================================================
		// Screen 3: Clear Screen (cls)
		// ============================================================
		$.screen( "200x150", "screen3" );
		
		// Fill screen with pattern
		$.setColor( 2 );
		for( let x = 10; x < 190; x += 10 ) {
			for( let y = 20; y < 140; y += 10 ) {
				$.pset( x, y );
			}
		}
		
		// Add some text
		$.setColor( 15 );
		$.setPosPx( 10, 30 );
		$.print( "Before cls" );
		$.setPosPx( 10, 45 );
		$.print( "Pattern here" );
					
		// Full clear
		$.cls();
		$.setColor( 12 );
		$.setPosPx( 10, 20 );
		$.print( "After full cls" );
		$.setPosPx( 10, 35 );
		$.print( "Clean screen - only red dots" );

		// Draw a second pattern after cls
		$.setColor( 4 );
		for( let x = 15; x < 190; x += 10 ) {
			for( let y = 25; y < 140; y += 10 ) {
				$.pset( x, y );
			}
		}

		// Partial clear
		$.cls( 50, 50, 100, 50 );
		$.setColor( 10 );
		$.setPosPx( 10, 70 );
		$.print( "Partial cls" );

		$.setColor( 15 );
		$.setPosPx( 5, 5 );
		$.print( "3: CLEAR SCREEN" );
		
				
		// ============================================================
		// Screen 4: Complex Interactions
		// ============================================================
		let x, y;
		$.screen( "200x150", "screen4" );
		$.setColor( 15 );
		$.setPosPx( 5, 5 );
		$.print( "4: COMPLEX" );
		
		// Background with noise
		$.setBlend( "replace" );
		$.setNoise( 20, 1 );
		$.setColor( 1 );
		$.rect( 10, 20, 180, 105, "rgba(88,88,150,1)" );
		
		// Different pens with alpha blending
		$.setBlend( "alpha" );
		$.setColor( "rgba(255,0,0,0.7)" );
		$.circle( 30, 50, 12, "rgba(255,0,0,0.7)" );
		
		$.setColor( "rgba(0,255,0,0.5)" );
		$.rect( 50, 50, 16, 16, "rgba(0,255,0,0.5)" );
		
		$.setColor( "rgba(0,0,255,0.8)" );
		$.circle( 70, 50, 8, "rgba(0,0,255,0.8)" );
		
		// Lines with different modes
		$.setBlend( "replace" );
		$.setNoise( 30, 1 );
		$.setColor( 14 );
		y = 80;
		for( x = 20; x < 80; x += 6 ) {
			y += 4;
			$.circle( x, y, 4, 14 );
		}
		
		$.setBlend( "alpha" );
		$.setColor( "rgba(255,255,0,0.6)" );
		x = 20;
		for( x = 20; x < 80; x += 6 ) {
			$.rect( x, y, 4, 4, "rgba(255,255,0,0.6)" );
			y -= 4;
		}
		
		// Final render
		$.setPosPx( 5, 130 );
		$.print( "Complex blend test" );
		
	} );
</script>
</body>
</html>
