<!DOCTYPE html>
<html>
	<head>
		<title>Input 03</title>
		<script type="text/toml">
			[[TOML_START]]
			file = "input_03"
			name = "input 03"
			width = 300
			height = 210
			commands = """
				DL 100
				KT "Hello"
				DL 100
				KP "Escape"
				DL 100
				KT "World"
				DL 500
				KT "Final Word"
				KP "Enter"
				"""
			[[TOML_END]]
		</script>
		<!-- [Pi.js Script]-->
		<script src="../../../build/pi.js"></script>
		<!-- [/Pi.js Script]-->
		<style>
			html, body {
				background-color: grey;
			}
		</style>
	</head>
<body>
<script>

$.screen( { "aspect": "300m210" } );
$.ready( async () => {

	// Test 1: Cancel with Escape key
	$.print( "Test 1: Cancel with Escape" );
	try {
		await $.input( { "prompt": "Type something: " } );
		$.print( "ERROR: Input was not cancelled!" );
	} catch( val ) {
		$.print( "Cancelled: \"" + val + "\"" );
	}

	// Test 2: Programmatic cancel
	$.print( "" );
	$.print( "Test 2: Programmatic cancel" );
	
	// Start input but don't await it yet
	const inputPromise = $.input( { "prompt": "Type more: " } );
	
	// Cancel after a short delay
	setTimeout( () => {
		$.cancelInput();
	}, 200 );
	
	try {
		await inputPromise;
		$.print( "ERROR: Input was not cancelled!" );
	} catch( val ) {
		$.print( "Cancelled: \"" + val + "\"" );
	}

	// Test 3: Normal completion after cancel
	$.print( "" );
	$.print( "Test 3: Normal input" );
	const name = await $.input( { "prompt": "Name: " } );
	$.print( "Completed: \"" + name + "\"" );
} );

</script>
</body>
</html>

