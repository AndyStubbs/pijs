<!DOCTYPE html>
<html>
	<head>
		<title>Pointer Events Comprehensive Test</title>
		<script type="text/toml">
			[[TOML_START]]
			file = "events_comprehensive"
			name = "Events Comprehensive Test"
			width = 1200
			height = 800
			delay = 0
			commands = """
				SL "#mouse-screen canvas"
				DL 50
				MV 100, 75
				DL 50
				MD
				DL 50
				MV 200, 75
				DL 50
				MU
				DL 50
				MV 100, 125
				DL 50
				MD
				DL 50
				MV 200, 125
				DL 50
				MU
				SL "#touch-screen canvas"
				DL 50
				TS 100, 75
				DL 50
				TM 200, 75, 10
				DL 50
				TE
				DL 50
				TS 100, 125
				DL 50
				TM 200, 125, 10
				DL 50
				TE
				SL "#press-screen canvas"
				DL 50
				MV 100, 75
				DL 50
				MC
				DL 50
				MV 100, 125
				DL 50
				MC
				DL 50
				MV 200, 75
				DL 50
				MC
				DL 50
				MV 200, 125
				DL 50
				MC
				SL "#events-screen canvas"
				DL 50
				MV 150, 100
				DL 50
				MC
				DL 50
				"""
			[[TOML_END]]
		</script>
		<!-- [Pi.js Script]-->
		<script src="../../../build/pi.js"></script>
		<!-- [/Pi.js Script]-->
		<style>
			html, body {
				background-color: #333;
				margin: 0;
				padding: 10px;
				font-family: Arial, sans-serif;
			}
			.container {
				display: inline-block;
				margin: 5px;
				border: 2px solid #666;
				background-color: #222;
				vertical-align: top;
				width: 320px;
				height: 250px;
			}
			.screen-label {
				color: white;
				text-align: center;
				padding: 5px;
				font-size: 12px;
			}
		</style>
	</head>
<body>

<!-- Test containers for multiple screens -->
<div class="container">
	<div class="screen-label">Mouse Test Screen</div>
	<div id="mouse-screen"></div>
</div>

<div class="container">
	<div class="screen-label">Touch Test Screen</div>
	<div id="touch-screen"></div>
</div>

<div class="container">
	<div class="screen-label">Press Test Screen</div>
	<div id="press-screen"></div>
</div>

<div class="container">
	<div class="screen-label">Events Test Screen</div>
	<div id="events-screen"></div>
</div>


<script>

	const tests = [
		setupMouseModule,
		testEnableContextMenu,
		testBasicMouseDown,
		testBasicMouseUp,
		testBasicMouseDownOnce,
		testHitboxMouseDown,
		testHitboxMouseDownWithData,
		testBasicMouseMoveOnce,
		testInMouse,
		setupTouchModule,
		setupPressModule,
		setupEventsModule
	];
	let test = 0;

	// Main test execution
	$.ready( function() {
		nextTest( tests, test++ );
	} );

	function printTestResult( testName, result ) {
		if( result ) {
			$.setColor( 2 );
			$.print( "$ " + testName );
		} else {
			$.setColor( 4 );
			$.print( "! " + testName );
		}
	}

	function nextTest( tests, test ) {
		setTimeout( tests[ test ], 100 );
	}

	////////////////////////////////////////////////////////////////////////////////////////////////
	// Mouse Module Tests
	////////////////////////////////////////////////////////////////////////////////////////////////

	function setupMouseModule() {
		var mouseScreen = $.screen( "300x200", "mouse-screen" );
		$.setBgColor( 1 );
		$.setColor( 15 );
		$.setPos( 1, 1 );
		$.print( "Mouse Module Tests" );
		nextTest( tests, test++ );
	}

	function testEnableContextMenu() {
		try {
			$.setEnableContextMenu( true );
			printTestResult( "setEnableContextMenu true", true );
		} catch( e ) {
			printTestResult( "setEnableContextMenu true", false );
		}
		
		try {
			$.setEnableContextMenu( false );
			printTestResult( "setEnableContextMenu false", true);
		} catch( e ) {
			printTestResult( "setEnableContextMenu false", false );
		}

		nextTest( tests, test++ );
	}
	
	function testBasicMouseDown() {
		try {
			$.onmouse( "down", onmousedown );
		} catch( e ) {
			printTestResult( "testBasicMouseDown", false);
		}

		function onmousedown( data ) {
			if( data && data.action === "down" ) {
				printTestResult( "testBasicMouseDown", true );
			} else {
				printTestResult( "testBasicMouseDown", false );
			}
			$.offmouse( "down", onmousedown );
			nextTest( tests, test++ );
		}
	}

	function testBasicMouseUp() {
		try {
			$.onmouse( "up", onmouseup );
		} catch( e ) {
			printTestResult( "testBasicMouseUp", false);
		}

		function onmouseup( data ) {
			if( data && data.action === "up" ) {
				printTestResult( "testBasicMouseUp", true );
			} else {
				printTestResult( "testBasicMouseUp", false );
			}
			$.offmouse( "up", onmouseup );

			nextTest( tests, test++ );
		}
	}

	function testBasicMouseDownOnce() {
		try {
			$.onmouse( "down", onmousedown, true );
		} catch( e ) {
			printTestResult( "testBasicMouseDownOnce", false);
		}

		function onmousedown( data ) {
			if( data && data.action === "down" ) {
				printTestResult( "testBasicMouseDownOnce", true );
			} else {
				printTestResult( "testBasicMouseDownOnce", false );
			}
			nextTest( tests, test++ );
		}
	}

	function testHitboxMouseDown() {
		const hitBox = { "x": 200, "y": 15, "width": 50, "height": 50 };
		$.setColor( 15 );
		$.rect( hitBox );
		try {
			$.onmouse( "down", onmousedown, true, hitBox );
		} catch( e ) {
			printTestResult( "testHitboxMouseDown", false);
		}

		function onmousedown( data ) {
			if( data && data.action === "down" ) {
				printTestResult( "testHitboxMouseDown", true );
				$.setColor( 2 );
			} else {
				printTestResult( "testHitboxMouseDown", false );
				$.setColor( 4 );
			}
			$.rect( hitBox );
			nextTest( tests, test++ );
		}
	}

	function testHitboxMouseDownWithData() {
		const hitBox = { "x": 200, "y": 75, "width": 50, "height": 50 };
		$.setColor( 15 );
		$.rect( hitBox );
		try {
			$.onmouse( "down", onmousedown, true, hitBox, { "cool": "beans" } );
		} catch( e ) {
			printTestResult( "testHitboxMouseDownWithData", false);
		}

		function onmousedown( data, customData ) {
			if( data && data.action === "down" && customData.cool ) {
				printTestResult( "testHitboxMouseDownWithData", true );
				$.setColor( 2 );
			} else {
				printTestResult( "testHitboxMouseDownWithData", false );
				$.setColor( 4 );
			}
			$.rect( hitBox );
			nextTest( tests, test++ );
		}
	}

	function testBasicMouseMoveOnce() {
		try {
			$.onmouse( "move", onmousedown, true );
		} catch( e ) {
			printTestResult( "testBasicMouseMoveOnce", false);
		}

		function onmousedown( data ) {
			if( data && data.action === "move" ) {
				printTestResult( "testBasicMouseMoveOnce", true );
			} else {
				printTestResult( "testBasicMouseMoveOnce", false );
			}
			nextTest( tests, test++ );
		}
	}

	function testInMouse() {
		let lastX;
		let lastY;
		let testMoveX = true;
		let testMoveY = true;
		let testButton1 = true;
		let testButton2 = true;

		const interval = setInterval( () => {
			const mouse = $.inmouse();
			if( testMoveX && lastX && mouse.x !== lastX ) {
				printTestResult( "testInMouseMoveX", true );
				testMoveX = false;
			}
			if( testMoveY && lastY && mouse.y !== lastY ) {
				printTestResult( "testInMouseMoveY", true );
				testMoveY = false;
			}
			if( testButton1 && mouse.buttons === 1 ) {
				printTestResult( "testInMouseButton1", true );
				testButton1 = false;
			}
			if( testButton2 && mouse.buttons === 2 ) {
				printTestResult( "testInMouseButton2", true );
				testButton2 = false;
			}

			if( !testMoveX && !testMoveY && !testButton1 && !testButton2 ) {
				clearInterval( interval );
				nextTest( tests, test++ );
			}
			lastX = mouse.x;
			lastY = mouse.y;
		}, 20 );
	}

	////////////////////////////////////////////////////////////////////////////////////////////////
	// Touch Module Tests
	////////////////////////////////////////////////////////////////////////////////////////////////

	function setupTouchModule() {
		var touchScreen = $.screen( "300x200", "touch-screen" );
		$.setBgColor( 1 );
		$.setColor( 15 );
		$.setPos( 1, 1 );
		$.print( "Touch Module Tests" );
		nextTest( tests, test++ );
	}

	////////////////////////////////////////////////////////////////////////////////////////////////
	// Press Module Tests
	////////////////////////////////////////////////////////////////////////////////////////////////

	function setupPressModule() {
		var pressScreen = $.screen( "300x200", "press-screen" );
		$.setBgColor( 1 );
		$.setColor( 15 );
		$.setPos( 1, 1 );
		$.print( "Press Module Tests" );
		
		nextTest( tests, test++ );
	}

	////////////////////////////////////////////////////////////////////////////////////////////////
	// Events Module Tests
	////////////////////////////////////////////////////////////////////////////////////////////////

	// Events Module Tests
	function setupEventsModule() {
		var eventsScreen = $.screen( "300x200", "events-screen" );
		$.setBgColor( 1 );
		$.setColor( 15 );
		$.setPos( 1, 1 );
		$.print( "Events Module Tests" );

		nextTest( tests, test++ );
	}

</script>
</body>
</html>
