<!DOCTYPE html>
<html>
	<head>
		<title>Graphics Advanced Comprehensive Test</title>
		<script type="text/toml">
			[[TOML_START]]
			file = "graphics_advanced_comprehensive"
			name = "graphics advanced comprehensive"
			width = 640
			height = 480
			delay = 0
			[[TOML_END]]
		</script>
		<!-- [Pi.js Script]-->
		<script src="../../../build/pi.js"></script>
		<!-- [/Pi.js Script]-->
		<style>
			html, body {
				background-color: grey;
			}
		</style>
	</head>
<body>
<script>
	$.ready( function () {
		$.screen( "640x480" );
		
		// Test grid layout:
		// +---------------------------+---------------------------+
		// | ARC Tests                 | ELLIPSE Tests             |
		// | (0,0 - 320,240)           | (320,0 - 640,240)         |
		// +---------------------------+---------------------------+
		// | BEZIER Tests              | FILTERIMG Tests           |
		// | (0,240 - 320,480)         | (320,240 - 640,480)       |
		// +---------------------------+---------------------------+

		// === SECTION 1: ARC Tests (Top Left) ===
		$.setColor( 15 );
		$.setPosPx( 5, 5 );
		$.print( "ARC" );
		
		// Basic arcs - pixel mode
		$.setPixelMode( true );
		$.setPen( "pixel", 1 );
		
		// Quarter circles at different angles
		$.setColor( 9 );
		$.arc( 50, 50, 30, 0, 90 );
		
		$.setColor( 10 );
		$.arc( 120, 50, 30, 90, 180 );
		
		$.setColor( 11 );
		$.arc( 190, 50, 30, 180, 270 );
		
		$.setColor( 12 );
		$.arc( 260, 50, 30, 270, 360 );
		
		// Half circles
		$.setColor( 13 );
		$.arc( 50, 110, 25, 0, 180 );
		
		$.setColor( 14 );
		$.arc( 120, 110, 25, 180, 360 );
		
		// Dashed circles (multiple arcs)
		$.setColor( 2 );
		for( let a = 0; a < 360; a += 45 ) {
			$.arc( 190, 110, 25, a, a + 30 );
		}
		
		// Spiral effect - pixel mode
		let sa = 0;
		let ea = 60;
		for( let r = 5; r < 30; r += 3 ) {
			$.setColor( 9 + ( r % 6 ) );
			$.arc( 260, 110, r, sa, ea );
			sa += 40;
			ea += 40;
		}
		
		// Anti-aliased arcs
		$.setPixelMode( false );
		$.setPen( "circle", 2 );
		
		$.setColor( 14 );
		$.arc( 50, 180, 35, 45, 135 );
		
		$.setColor( 12 );
		$.arc( 130, 180, 35, 135, 225 );
		
		$.setColor( 10 );
		$.arc( 210, 180, 35, 225, 315 );
		
		// Overlapping arcs
		$.setPen( "pixel", 1 );
		$.setColor( 9 );
		$.arc( 270, 180, 30, 0, 180 );
		$.setColor( 11 );
		$.arc( 270, 180, 25, 90, 270 );
		$.setColor( 13 );
		$.arc( 270, 180, 20, 180, 360 );
		
		// Reset
		$.setPixelMode( true );

		// === SECTION 2: ELLIPSE Tests (Top Right) ===
		$.setColor( 15 );
		$.setPosPx( 325, 5 );
		$.print( "ELLIPSE" );
		
		// Basic ellipses - pixel mode
		$.setPixelMode( true );
		$.setPen( "pixel", 1 );
		
		// Horizontal ellipses
		$.setColor( 9 );
		$.ellipse( 370, 40, 40, 20 );
		
		$.setColor( 10 );
		$.ellipse( 470, 40, 50, 15 );
		
		$.setColor( 11 );
		$.ellipse( 580, 40, 35, 25 );
		
		// Vertical ellipses
		$.setColor( 12 );
		$.ellipse( 370, 110, 15, 40 );
		
		$.setColor( 13 );
		$.ellipse( 440, 110, 20, 50 );
		
		$.setColor( 14 );
		$.ellipse( 520, 110, 25, 45 );
		
		// Filled ellipses
		$.setColor( 14 );
		$.ellipse( 370, 180, 35, 25, 9 );
		
		$.setColor( 12 );
		$.ellipse( 460, 180, 30, 20, 10 );
		
		$.setColor( 10 );
		$.ellipse( 550, 180, 40, 30, 11 );
		
		// Anti-aliased ellipses
		$.setPixelMode( false );
		
		$.setColor( 2 );
		$.ellipse( 370, 215, 25, 15 );
		
		$.setColor( 13 );
		$.ellipse( 460, 215, 30, 18, 9 );
		
		// Circle (equal radii)
		$.setColor( 11 );
		$.ellipse( 560, 215, 25, 25 );
		
		// Reset
		$.setPixelMode( true );

		// === SECTION 3: BEZIER Tests (Bottom Left) ===
		$.setColor( 15 );
		$.setPosPx( 5, 245 );
		$.print( "BEZIER" );
		
		// Simple bezier curves - pixel mode
		$.setPixelMode( true );
		$.setPen( "pixel", 1 );
		
		// S-curve
		$.setColor( 9 );
		$.bezier( 20, 270, 80, 270, 20, 330, 80, 330 );
		
		// Wave
		$.setColor( 10 );
		$.bezier( 100, 270, 120, 290, 140, 310, 160, 330 );
		
		// Loop
		$.setColor( 11 );
		$.bezier( 180, 270, 220, 270, 180, 330, 220, 330 );
		
		// Sharp turn
		$.setColor( 12 );
		$.bezier( 240, 270, 240, 300, 280, 300, 280, 330 );
		
		// Anti-aliased bezier curves
		$.setPixelMode( false );
		$.setPen( "circle", 2 );
		
		// Smooth curve
		$.setColor( 13 );
		$.bezier( 20, 360, 60, 340, 100, 380, 140, 360 );
		
		// Complex curve
		$.setColor( 14 );
		$.bezier( 160, 360, 180, 340, 200, 380, 220, 360 );
		
		// Sharp bezier
		$.setColor( 2 );
		$.bezier( 240, 360, 250, 340, 250, 380, 280, 360 );
		
		// Thick bezier with square pen
		$.setPen( "square", 3 );
		$.setColor( 11 );
		$.bezier( 20, 410, 80, 390, 120, 430, 160, 410 );
		
		// Thick bezier with circle pen
		$.setPen( "circle", 3 );
		$.setColor( 9 );
		$.bezier( 180, 410, 220, 390, 240, 430, 280, 410 );
		
		// Reset
		$.setPixelMode( true );
		$.setPen( "pixel", 1 );

		// === SECTION 4: FILTERIMG Tests (Bottom Right) ===
		$.setColor( 15 );
		$.setPosPx( 325, 245 );
		$.print( "FILTERIMG" );
		
		// Create a test pattern to filter
		$.setPixelMode( true );
		
		// Colorful pattern - 3x2 grid of rectangles
		$.setColor( 9 );
		$.rect( 330, 270, 80, 30, 9 );
		
		$.setColor( 10 );
		$.rect( 420, 270, 80, 30, 10 );
		
		$.setColor( 11 );
		$.rect( 510, 270, 80, 30, 11 );
		
		$.setColor( 12 );
		$.rect( 330, 310, 80, 30, 12 );
		
		$.setColor( 13 );
		$.rect( 420, 310, 80, 30, 13 );
		
		$.setColor( 14 );
		$.rect( 510, 310, 80, 30, 14 );
		
		// Draw some circles
		$.setColor( 2 );
		$.circle( 380, 285, 15, 2 );
		
		$.setColor( 3 );
		$.circle( 470, 285, 15, 3 );
		
		$.setColor( 4 );
		$.circle( 560, 285, 15, 4 );
		
		$.setColor( 5 );
		$.circle( 380, 325, 15, 5 );
		
		$.setColor( 6 );
		$.circle( 470, 325, 15, 6 );
		
		$.setColor( 7 );
		$.circle( 560, 325, 15, 7 );
		
		// Test 1: Apply grayscale filter to top-left rectangle using clipping
		$.filterImg(
			function ( color ) {
				const avg = Math.round( ( color.r + color.g + color.b ) / 3 );
				return {
					"r": avg,
					"g": avg,
					"b": avg,
					"a": color.a
				};
			},
			330, 270, 409, 299
		);
		
		// Test 2: Apply color inversion filter to middle rectangle using clipping
		$.filterImg(
			function ( color ) {
				return {
					"r": 255 - color.r,
					"g": 255 - color.g,
					"b": 255 - color.b,
					"a": color.a
				};
			},
			420, 310, 499, 339
		);
		
		// Test 3: Apply red tint to top-right rectangle using clipping
		$.filterImg(
			function ( color ) {
				return {
					"r": Math.min( 255, color.r + 50 ),
					"g": color.g,
					"b": color.b,
					"a": color.a
				};
			},
			510, 270, 589, 299
		);
		
		// Test 4: Apply blue tint to bottom-right rectangle using clipping
		$.filterImg(
			function ( color ) {
				return {
					"r": color.r,
					"g": color.g,
					"b": Math.min( 255, color.b + 50 ),
					"a": color.a
				};
			},
			510, 310, 589, 339
		);
		
		// Draw text labels
		$.setColor( 15 );
		$.setPosPx( 330, 355 );
		$.print( "Filters with clipping:" );
		$.setPosPx( 330, 365 );
		$.print( "Gray/Inv/Red/Blue" );
		
		// Draw gradient pattern for additional filter tests
		for( let y = 390; y < 450; y += 5 ) {
			const colorVal = Math.floor( ( y - 390 ) / 60 * 14 ) + 1;
			$.setColor( colorVal );
			$.rect( 330, y, 280, 5, colorVal );
		}
		
		// Test 5: Apply brightness adjustment to left half of gradient (full clipping)
		$.filterImg(
			function ( color ) {
				const factor = 1.5;
				return {
					"r": Math.min( 255, Math.round( color.r * factor ) ),
					"g": Math.min( 255, Math.round( color.g * factor ) ),
					"b": Math.min( 255, Math.round( color.b * factor ) ),
					"a": color.a
				};
			}, 330, 390, 469, 449
		);
		
		// Test 6: Apply sepia tone to right half of gradient (full clipping)
		$.filterImg(
			function ( color ) {
				const r = Math.min( 255, Math.round( color.r * 0.393 + color.g * 0.769 + color.b * 0.189 ) );
				const g = Math.min( 255, Math.round( color.r * 0.349 + color.g * 0.686 + color.b * 0.168 ) );
				const b = Math.min( 255, Math.round( color.r * 0.272 + color.g * 0.534 + color.b * 0.131 ) );
				return {
					"r": r,
					"g": g,
					"b": b,
					"a": color.a
				};
			},
			470, 390, 609, 449
		);
		
		// Add divider line
		$.setColor( 8 );
		$.line( 469, 390, 469, 449 );
		
		// Labels for gradient tests
		$.setColor( 0 );
		$.setPosPx( 340, 455 );
		$.print( "Bright" );
		$.setPosPx( 520, 455 );
		$.print( "Sepia" );
		
		// Create test pattern for additional clipping tests
		$.setColor( 9 );
		$.rect( 330, 460, 40, 15, 9 );
		$.setColor( 10 );
		$.rect( 375, 460, 40, 15, 10 );
		$.setColor( 11 );
		$.rect( 420, 460, 40, 15, 11 );
		$.setColor( 12 );
		$.rect( 465, 460, 40, 15, 12 );
		$.setColor( 13 );
		$.rect( 510, 460, 40, 15, 13 );
		$.setColor( 14 );
		$.rect( 555, 460, 40, 15, 14 );
		
		// Test 7: NO coordinates - applies to entire screen (backward compatibility)
		// This should invert the bottom-left rectangle ONLY (within filterImg section)
		// but technically processes whole screen
		$.filterImg( function ( color, x, y ) {
			if( x >= 330 && x <= 369 && y >= 460 && y <= 474 ) {
				return {
					"r": 255 - color.r,
					"g": 255 - color.g,
					"b": 255 - color.b,
					"a": color.a
				};
			}
			return color;
		} );
		
		// Test 8: Partial coordinates - only x1, y1 provided (x2, y2 default to screen max)
		// Darken filter starting from specific point to end of screen
		$.filterImg(
			function ( color ) {
				return {
					"r": Math.round( color.r * 0.7 ),
					"g": Math.round( color.g * 0.7 ),
					"b": Math.round( color.b * 0.7 ),
					"a": color.a
				};
			},
			465, 460
		);
		
		// Test 9: Mixed coordinates - x1, y1, x2 provided, y2 defaults
		// Green tint on second rectangle (override previous darkening partially)
		$.filterImg(
			function ( color ) {
				return {
					"r": color.r,
					"g": Math.min( 255, color.g + 40 ),
					"b": color.b,
					"a": color.a
				};
			},
			375, 460, 414
		);
		
		// === Draw section dividers ===
		$.setColor( 8 );
		$.line( 320, 0, 320, 479 );
		$.line( 0, 240, 639, 240 );
	} );
</script>
</body>
</html>

