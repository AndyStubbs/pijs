<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Gamepad Test 02 - Multiple Gamepads</title>
	<script src="../../../build/pi.js"></script>
</head>
<body>
<script>

/*+++
title = "Gamepad Test 02 - Multiple Gamepads"
description = "Tests multiple gamepad support and ingamepad() with index parameter"
+++*/

$.screen( "640x480" );

// Draw loop
function draw() {
	$.cls( 0 );
	$.setColor( 15 );
	
	// Title
	$.setPos( 0, 0 );
	$.print( "GAMEPAD TEST - Multiple Gamepads" );
	
	// Instructions
	$.setPos( 0, 2 );
	$.setColor( 8 );
	$.print( "Connect up to 4 gamepads" );
	$.print( "Press buttons or move sticks" );
	
	// Get all gamepads
	const allGamepads = $.ingamepad();
	
	$.setPos( 0, 5 );
	$.setColor( 15 );
	$.print( `Total connected: ${allGamepads.length}` );
	
	// Test individual gamepad access
	for( let i = 0; i < 4; i++ ) {
		const gp = $.ingamepad( i );
		const row = 7 + i * 5;
		
		$.setPos( 0, row );
		
		if( gp ) {
			$.setColor( 10 );
			$.print( `Gamepad ${i}: Connected (index ${gp.index})` );
			
			// Show buttons
			$.setColor( 15 );
			$.setPos( 2, row + 1 );
			$.print( `Buttons: ${gp.buttons.length}, Axes: ${gp.axes.length}` );
			
			// Show pressed buttons
			$.setPos( 2, row + 2 );
			const pressedButtons = [];
			for( let j = 0; j < gp.buttons.length; j++ ) {
				if( gp.buttons[ j ].pressed ) {
					pressedButtons.push( j );
				}
			}
			if( pressedButtons.length > 0 ) {
				$.setColor( 14 );
				$.print( `Pressed: ${pressedButtons.join( ", " )}` );
			} else {
				$.setColor( 8 );
				$.print( "No buttons pressed" );
			}
			
			// Show axis values
			$.setPos( 2, row + 3 );
			if( gp.axes2 && gp.axes2.length > 0 ) {
				const hasMovement = gp.axes2.some( a => Math.abs( a ) > 0 );
				
				if( hasMovement ) {
					const allAxes = [];
					for( let j = 0; j < Math.min( 4, gp.axes2.length ); j++ ) {
						allAxes.push( `${j}:${gp.axes2[ j ].toFixed( 2 )}` );
					}
					$.setColor( 11 );
					$.print( allAxes.join( ", " ).substring( 0, 37 ) );
				} else {
					$.setColor( 8 );
					$.print( "No axis movement" );
				}
			}
		} else {
			$.setColor( 8 );
			$.print( `Gamepad ${i}: Not connected` );
		}
	}
	
	requestAnimationFrame( draw );
}

draw();

</script>
</body>
</html>
