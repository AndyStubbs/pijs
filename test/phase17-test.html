<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Phase 17: Palette System Test</title>
	<style>
		body {
			margin: 0;
			padding: 20px;
			font-family: monospace;
			background: #222;
			color: #fff;
		}
		h1 {
			color: #4CAF50;
		}
		.status {
			margin: 20px 0;
			padding: 15px;
			background: #333;
			border-radius: 5px;
		}
		canvas {
			margin: 20px 0;
			display: block;
		}
		.info {
			background: #1a1a1a;
			padding: 15px;
			border-radius: 5px;
			margin: 20px 0;
		}
		button {
			background: #4CAF50;
			color: white;
			border: none;
			padding: 10px 20px;
			margin: 5px;
			border-radius: 3px;
			cursor: pointer;
			font-family: monospace;
		}
		button:hover {
			background: #45a049;
		}
		button.danger {
			background: #f44336;
		}
		button.danger:hover {
			background: #da190b;
		}
	</style>
</head>
<body>
	<h1>Phase 17: Palette System Test</h1>
	<div class="status" id="status">Loading Pi.js...</div>
	<div id="container" style="width: 640px; height: 400px;"></div>

	<div class="info">
		<h3>Palette Tests:</h3>
		<button id="showPalette">Show Palette Colors</button>
		<button id="setPalColor">Set Pal Color 7 to Red</button>
		<button id="swapColor">Swap Color 15 → Green</button>
		<button id="reset">Reset Palette</button>
		
		<h3>Pixel Mode Tests:</h3>
		<button id="pixelModeOn">Pixel Mode ON</button>
		<button id="pixelModeOff">Pixel Mode OFF (AA)</button>
		<button id="drawCircle">Draw Circle (test mode)</button>
		
		<h3>Pen Tests:</h3>
		<button id="penPixel">Pixel Pen (size 1)</button>
		<button id="penSquare">Square Pen (size 5)</button>
		<button id="penCircle">Circle Pen (size 5)</button>
		<button id="penNoise">Pen with Noise</button>
		<button id="drawLine">Draw Line (test pen)</button>
		
		<h3>Blend Mode Tests:</h3>
		<button id="blendNormal">Normal Blend</button>
		<button id="blendAlpha">Alpha Blend</button>
		<button id="drawOverlap">Draw Overlap (test blend)</button>
	</div>

	<script src="../build/pi.js"></script>
	<script>
		const status = document.getElementById( "status" );
		const $ = window.$ || window.pi;

		try {
			// Create screen
			const screen = $.screen( "640x400", "container" );
			screen.cls();

			status.innerHTML = "✅ Palette system test ready!";

			let currentMode = "pixel";
			let currentPen = "pixel";
			let currentBlend = "normal";

			// Palette tests
			document.getElementById( "showPalette" ).addEventListener( "click", () => {
				screen.cls();
				
				// Draw first 16 CGA colors
				for( let i = 0; i < 16; i++ ) {
					screen.setColor( i );
					const x = ( i % 8 ) * 80;
					const y = Math.floor( i / 8 ) * 50;
					screen.rect( x, y, 70, 40, i );
					
					// Draw color number
					screen.setColor( 15 );
					screen.locate( Math.floor( y / 14 ) + 1, Math.floor( x / 8 ) + 1 );
					screen.print( `${i}`, false );
				}
				
				// Show extended colors
				screen.locate( 8, 0 );
				screen.setColor( 11 );
				screen.print( "First 16 CGA colors shown. Total palette: 256 colors", false );
				
				screen.render();
			} );

			document.getElementById( "setPalColor" ).addEventListener( "click", () => {
				// Change color 7 (light gray) to bright red
				screen.setPalColor( 7, "#FF0000" );
				
				screen.cls();
				screen.setColor( 15 );
				screen.locate( 0, 0 );
				screen.print( "Color 7 changed to RED", false );
				
				// Draw with the new color 7
				screen.setColor( 7 );
				screen.rect( 100, 100, 100, 100, 7 );
				
				screen.render();
			} );

			document.getElementById( "swapColor" ).addEventListener( "click", () => {
				// Swap color 15 (white) to green on entire screen
				screen.swapColor( 15, "#00FF00" );
				screen.render();
			} );

			document.getElementById( "reset" ).addEventListener( "click", () => {
				// Reset by recreating the screen
				location.reload();
			} );

			// Pixel mode tests
			document.getElementById( "pixelModeOn" ).addEventListener( "click", () => {
				screen.setPixelMode( true );
				currentMode = "pixel";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pixel Mode: ON (no anti-aliasing)", false );
				screen.render();
			} );

			document.getElementById( "pixelModeOff" ).addEventListener( "click", () => {
				screen.setPixelMode( false );
				currentMode = "anti-aliased";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pixel Mode: OFF (anti-aliased)", false );
				screen.render();
			} );

			document.getElementById( "drawCircle" ).addEventListener( "click", () => {
				screen.cls();
				screen.setColor( 15 );
				screen.locate( 0, 0 );
				screen.print( `Mode: ${currentMode}`, false );
				
				screen.setColor( 14 );
				screen.circle( 320, 200, 100 );
				screen.render();
			} );

			// Pen tests
			document.getElementById( "penPixel" ).addEventListener( "click", () => {
				screen.setPen( "pixel", 1 );
				currentPen = "pixel (1px)";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pen: Pixel (size 1)", false );
				screen.render();
			} );

			document.getElementById( "penSquare" ).addEventListener( "click", () => {
				screen.setPen( "square", 5 );
				currentPen = "square (5px)";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pen: Square (size 5)", false );
				screen.render();
			} );

			document.getElementById( "penCircle" ).addEventListener( "click", () => {
				screen.setPen( "circle", 5 );
				currentPen = "circle (5px)";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pen: Circle (size 5)", false );
				screen.render();
			} );

			document.getElementById( "penNoise" ).addEventListener( "click", () => {
				screen.setPen( "circle", 3, [ -1, 1, -1, 1 ] );
				currentPen = "circle with noise";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Pen: Circle with noise (size 3)", false );
				screen.render();
			} );

			document.getElementById( "drawLine" ).addEventListener( "click", () => {
				screen.cls();
				screen.setColor( 15 );
				screen.locate( 0, 0 );
				screen.print( `Pen: ${currentPen}`, false );
				
				screen.setColor( 10 );
				screen.line( 50, 100, 590, 300 );
				screen.render();
			} );

			// Blend mode tests
			document.getElementById( "blendNormal" ).addEventListener( "click", () => {
				screen.setBlendMode( "normal" );
				currentBlend = "normal";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Blend Mode: Normal (replace)", false );
				screen.render();
			} );

			document.getElementById( "blendAlpha" ).addEventListener( "click", () => {
				screen.setBlendMode( "blend" );
				currentBlend = "blend";
				screen.cls();
				screen.setColor( 11 );
				screen.locate( 0, 0 );
				screen.print( "Blend Mode: Blend (alpha)", false );
				screen.render();
			} );

			document.getElementById( "drawOverlap" ).addEventListener( "click", () => {
				screen.cls();
				screen.setColor( 15 );
				screen.locate( 0, 0 );
				screen.print( `Blend: ${currentBlend}`, false );
				
				// Draw overlapping circles
				screen.setColor( 12 );  // Red
				screen.circle( 250, 200, 80, 12 );
				
				screen.setColor( 10 );  // Green
				screen.circle( 350, 200, 80, 10 );
				
				screen.setColor( 9 );  // Blue
				screen.circle( 300, 250, 80, 9 );
				
				screen.render();
			} );

			// Initial display
			screen.setColor( 10 );
			screen.locate( 0, 0 );
			screen.print( "PALETTE & SCREEN SETTINGS TEST", true, true );
			
			screen.setColor( 15 );
			screen.locate( 3, 0 );
			screen.print( "Commands available:", false );
			screen.locate( 4, 2 );
			screen.print( "screen.getPal() - Get palette", false );
			screen.locate( 5, 2 );
			screen.print( "screen.setPalColor(idx, color) - Set pal color", false );
			screen.locate( 6, 2 );
			screen.print( "screen.swapColor(old, new) - Swap colors", false );
			screen.locate( 7, 2 );
			screen.print( "screen.setPixelMode(bool) - Pixel/AA mode", false );
			screen.locate( 8, 2 );
			screen.print( "screen.setPen(pen, size, noise?) - Pen style", false );
			screen.locate( 9, 2 );
			screen.print( "screen.setBlendMode(mode) - Blend mode", false );
			
			screen.locate( 11, 0 );
			screen.setColor( 14 );
			screen.print( "Click buttons above to test features!", false );
			
			screen.render();

			console.log( "✅ Palette system initialized!" );
			console.log( "Commands:", {
				"getPal": screen.getPal,
				"setPalColor": screen.setPalColor,
				"swapColor": screen.swapColor,
				"setPixelMode": screen.setPixelMode,
				"setPen": screen.setPen,
				"setBlendMode": screen.setBlendMode
			} );

		} catch( e ) {
			status.innerHTML = `✗ Error: ${e.message}`;
			console.error( "Test failed:", e );
			throw e;
		}
	</script>
</body>
</html>

