title = "getAsync"
category = "pixels"
isScreen = true
summary = "Asynchronously reads a region of pixels as indices (default) or color values."
description = """
Returns a Promise resolving to a 2D array [height][width]. By default resolves to palette indices.
Set asIndex=false to resolve to color value objects. Tolerance controls color-to-index matching.

Note: if asIndex is set to false then the 2D array cannot be used with the put command.
"""
example = """
$.screen( "300x200" );
$.circle( 150, 110, 50, 4 );

getStuff( true );
getStuff( false );

async function getStuff( asIndex ) {

	// Color value names
	const colorNames = {
		"rgba(0, 0, 0, 0)": "black",
		"rgba(170, 170, 170, 255)": " gray",
		"rgba(170, 0, 0, 255)": "  red",
	};
	const mapColors = c => colorNames[ `rgba(${c.array.join( ", " )})` ];

	// Get stuff
	const stuffName = asIndex ? "indices" : "colors";
	const stuff = await $.getAsync( 105, 85, 5, 5, 1, asIndex );
	$.print( `${stuffName} = [` );
	for( let i = 0; i < stuff.length; i++ ) {
		if( asIndex ) {
			$.print( `\t[ ${stuff[ i ].join( ", " )} ],` );
		} else {
			$.print( `\t[ ${stuff[ i ].map( mapColors ).join( ", " )} ],` );
		}
	}
	$.print( "]" );

	if( asIndex ) {
		$.put( stuff, 80, 85 );
		$.print( "\\n\\n\\n\\n\\n\\n" );
	}
}
"""

[[parameters]]
name = "x"
type = "number"
description = "Left coordinate."

[[parameters]]
name = "y"
type = "number"
description = "Top coordinate."

[[parameters]]
name = "width"
type = "number"
description = "Region width."

[[parameters]]
name = "height"
type = "number"
description = "Region height."

[[parameters]]
name = "tolerance"
type = "number"
description = "Color matching tolerance [0.0-1.0] for index conversion (default 1)."
optional = true

[[parameters]]
name = "asIndex"
type = "boolean"
description = "If false, resolve to color value objects instead of indices."
optional = true

[[returns]]
type = "Promise<Array<Array<number | PiColor>>>"
typeDesc = "*Promise"
description = "Promise resolving to 2D array [height][width] of indices (default) or color values."

