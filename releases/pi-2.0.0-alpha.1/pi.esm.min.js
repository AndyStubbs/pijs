/**
 * Pi.js - Graphics and Sound Library
 * @version 2.0.0-alpha.1
 * @author Andy Stubbs
 * @license Apache-2.0
 * @preserve
 */
var sn=Object.defineProperty;var Xt=(e,t)=>{for(var o in t)sn(e,o,{get:t[o],enumerable:!0})};var S={};Xt(S,{calcColorDifference:()=>ue,clamp:()=>x,convertToColor:()=>j,degreesToRadian:()=>T,generateColorKey:()=>le,getFloat:()=>A,getInt:()=>m,hexToData:()=>dt,inRange:()=>Oe,inRange2:()=>gt,isDomElement:()=>ut,isFunction:()=>B,isObjectLiteral:()=>Ht,pad:()=>cn,padL:()=>Zt,parseOptions:()=>ce,queueMicrotask:()=>mt,radiansToDegrees:()=>ft,rgbToColor:()=>ae,rndRange:()=>ye});function ce(e,t){let o={};for(let r of t)o[r]=null;let n=!1;if(e.length>0&&Ht(e[0])){let r=e[0];for(let i of t)i in r&&(n=!0,o[i]=r[i])}if(!n)for(let r=0;r<t.length;r++)r<e.length&&(o[t[r]]=e[r]);return o}var B=e=>typeof e=="function",ut=e=>e instanceof Element,Ht=e=>{if(typeof e!="object"||e===null||Array.isArray(e))return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype};function dt(e,t,o){e=e.toUpperCase();let n=[],r=0,i="",s=0;for(let l=0;l<o;l++){n.push([]);for(let c=0;c<t;c++){if(s>=i.length){let a=parseInt(e[r],16);isNaN(a)&&(a=0),i=Zt(a.toString(2),4,"0"),r+=1,s=0}n[l].push(parseInt(i[s])),s+=1}}return n}function x(e,t,o){return Math.min(Math.max(e,t),o)}function Oe(e,t){return e.x>=t.x&&e.x<t.x+t.width&&e.y>=t.y&&e.y<t.y+t.height}function gt(e,t,o,n,r,i){return e>=o&&e<o+r&&t>=n&&t<n+i}function ye(e,t){return Math.random()*(t-e)+e}function T(e){return e*(Math.PI/180)}function ft(e){return e*(180/Math.PI)}function Zt(e,t,o){typeof o!="string"&&(o=" ");let n="";e=e+"";for(let r=e.length;r<t;r++)n+=o;return n+e}function cn(e,t,o){for((typeof o!="string"||o.length===0)&&(o=" "),e=e+"";e.length<t;)e=o+e+o;return e.length>t&&(e=e.substring(0,t)),e}function m(e,t){if(e==null)return t;let o=Number(e);return Number.isFinite(o)?Math.round(o):t}function A(e,t){if(e==null)return t;let o=Number(e);return Number.isFinite(o)?o:t}var mt=e=>{window.queueMicrotask?window.queueMicrotask(e):setTimeout(e,0)},Qt={key:0,r:0,g:0,b:0,a:0,rgba:"",hex:""},_e=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});function le(e,t,o,n){return e<<24|t<<16|o<<8|n}function ae(e,t,o,n){let r=un(e,t,o,n);return Jt(e,t,o,n,r)}function j(e){if(e==null||e==="")return null;if(Object.getPrototypeOf(e)===Qt)return e;if(Array.isArray(e)){if(e.length<3)return null;e.length===3&&e.push(255)}else if(e.r!==void 0)e=[e.r,e.g,e.b,e.a];else if(typeof e=="string"){if(/(^#[0-9A-F]{8}$)|(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e))return ln(e);if(e.indexOf("rgb")===0){if(e=an(e),e.length<3)return null;e.length===3&&e.push(255)}else return dn(e)}for(let t=0;t<3;t+=1)e[t]=m(e[t],0);return e[3]=A(e[3],0),e[3]<1?e[3]=Math.round(e[3]*255):e[3]=Math.round(e[3]),ae(e[0],e[1],e[2],e[3])}function ue(e,t,o=[.2,.68,.07,.05]){let n=e.r-t.r,r=e.g-t.g,i=e.b-t.b,s=e.a-t.a;return n*n*o[0]+r*r*o[1]+i*i*o[2]+s*s*o[3]}function Jt(e,t,o,n,r){let i=Object.create(Qt);return i.key=le(e,t,o,n,r),i.r=e,i.g=t,i.b=o,i.a=n,i.rgba=`rgba(${e},${t},${o},${(n/255).toFixed(3)})`,i.hex=r,i}function ln(e){let t,o,n,r;return e.length===4?(t=parseInt(e.slice(1,2),16)*16-1,o=parseInt(e.slice(2,3),16)*16-1,n=parseInt(e.slice(3,4),16)*16-1):(t=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16)),e.length===9?r=parseInt(e.slice(7,9),16):r=255,Jt(t,o,n,r,e)}function an(e){e=e.slice(e.indexOf("(")+1,e.indexOf(")"));let t=e.split(","),o=[];for(let n=0;n<t.length;n++){let r;n===3?r=parseFloat(t[n].trim())*255:r=parseInt(t[n].trim()),o.push(r)}return o}function Ve(e){Number.isInteger(e)||(e=Math.round(e)),e=x(e,0,255);let t=Number(e).toString(16);return t.length<2?"0"+t:t.toUpperCase()}function un(e,t,o,n){return isNaN(n)&&(n=255),"#"+Ve(e)+Ve(t)+Ve(o)+Ve(n)}function dn(e){_e.clearRect(0,0,1,1),_e.fillStyle=e,_e.fillRect(0,0,1,1);let t=_e.getImageData(0,0,1,1).data;return ae(t[0],t[1],t[2],t[3])}var Be=[],ht={},ze,Ne,pt=[],Ge=!1,Me=0,qe=null;function Dt(e,t){ze=e,Ne=t,typeof document<"u"&&document.readyState==="loading"?document.addEventListener("DOMContentLoaded",mn):Ge=!0}function we(){Me++}function Q(){Me--,Me<0&&(Me=0),vt()}function I(e,t,o,n=!1,r=!1){let i={name:e,fn:t,parameterNames:o,isScreen:n,screenOptional:r};if(Be.push(i),e.startsWith("set")&&e!=="set"){let s=i.name.substring(3,4).toLowerCase()+i.name.substring(4);ht[s]=i}}function We(){let e=[];for(let t of Be)if(t.name.startsWith("set")){let o=t.name.substring(3,4).toLowerCase()+t.name.substring(4);e.push(o)}e.sort((t,o)=>t==="screen"?-1:o==="screen"?1:t.localeCompare(o)),Ne.addCommand("set",fn,e,!0),Be.sort((t,o)=>t.name.localeCompare(o.name)),Ne.sortScreenCommands();for(let t of Be)Ue(t)}function Ue(e){e.isScreen?ze[e.name]=(...t)=>{let o=ce(t,e.parameterNames),n=Ne.getActiveScreen();if(!n&&!e.screenOptional){let r=new Error(`${e.name}: No screens available for command.`);throw r.code="NO_SCREEN",r}return e.fn(n,o)}:ze[e.name]=(...t)=>{let o=ce(t,e.parameterNames);return e.fn(o)}}function Te(){return ze}I("ready",gn,["callback"]);function gn(e){let t=e.callback;if(t!=null&&!B(t)){let o=new TypeError("ready: Parameter callback must be a function.");throw o.code="INVALID_CALLBACK",o}return new Promise(o=>{pt.push({callback:t,resolve:o,triggered:!1}),vt()})}function fn(e,t){for(let o in t)if(t[o]!==null&&ht[o]){let n=ht[o],i=[t[o]],s=ce(i,n.parameterNames);n.isScreen?n.fn(e,s):n.fn(s),o==="screen"&&(e=Ne.getActiveScreen())}}function mn(){Ge=!0,vt()}function vt(){qe!==null&&clearTimeout(qe),qe=setTimeout(hn,0)}function hn(){if(qe=null,!Ge||Me!==0)return;let e=pt.slice();pt=[];for(let t of e)t.triggered||(t.triggered=!0,t.callback&&t.callback(),t.resolve())}var F={};Xt(F,{addAACommand:()=>W,addCommand:()=>h,addPixelCommand:()=>G,addScreenCleanupFunction:()=>bt,addScreenDataItem:()=>b,addScreenDataItemGetter:()=>oe,addScreenInitFunction:()=>ne,addScreenInternalCommands:()=>$,getActiveScreen:()=>de,init:()=>xt,sortScreenCommands:()=>vn});var pn={screen:!0},Y={},Xe=[],Ke={},Ye={},It={},Et=[],At=[],eo=[],to=[],yt=0,Ie=null,ke=null,$e=new Set;function xt(){ke=new ResizeObserver(e=>{for(let t of e){let n=t.target.querySelectorAll("canvas[data-screen-id]");if(n.length!==0)for(let r of n){let i=parseInt(r.dataset.screenId,10),s=Y[i];s&&jn(s)}}})}function h(e,t,o,n=!1){Xe.push({name:e,fn:t,parameterNames:o,screenOptional:n}),I(e,t,o,!0,n)}function G(e,t,o){let n={name:e,fn:t,parameterNames:o,isScreen:!0};Xe.push(n),I(e,t,o,!0),Ke[e]=n}function W(e,t,o){let n={name:e,fn:t,parameterNames:o,isScreen:!0};Ye[e]=n}function vn(){Xe.sort((e,t)=>e.name.localeCompare(t.name))}function b(e,t){It[e]=t}function $(e,t){At.push({name:e,fn:t})}function oe(e,t){Et.push({name:e,fn:t})}function de(){return Ie}function ne(e){eo.push(e)}function bt(e){to.push(e)}I("screen",yn,["aspect","container","isOffscreen","willReadFrequently","noStyles","resizeCallback"]);function yn(e){if(e.resizeCallback!=null&&!B(e.resizeCallback)){let o=new TypeError("screen: resizeCallback must be a function.");throw o.code="INVALID_CALLBACK",o}if(typeof e.aspect=="string"&&e.aspect!==""&&(e.aspectData=Nn(e.aspect.toLowerCase()),!e.aspectData)){let o=new Error("screen: invalid value for aspect.");throw o.code="INVALID_ASPECT",o}let t=Tn(e);for(let o of Xe)wt(t,o);Ie=t,Y[t.id]=t,t.api.setFont(t.font.id);for(let o of eo)o(t);return t.api}h("removeScreen",wn,[]);function wn(e){let t=e.id;e.api.cancelInput(),e.api.clearEvents();let o=`Cannot call {METHOD}() on removed screen (id: ${t}). The screen has been removed from the page.`;for(let n in e.api)typeof e.api[n]=="function"&&(e.api[n]=()=>{let r=new TypeError(o.replace("{METHOD}",n));throw r.code="DELETED_METHOD",r});if(e.canvas&&e.canvas.parentElement&&e.canvas.parentElement.removeChild(e.canvas),e.container&&ke&&$e.has(e.container)){let n=!1;for(let r in Y){let i=Y[r];if(i!==e&&i.container===e.container){n=!0;break}}n||(ke.unobserve(e.container),$e.delete(e.container))}e.canvas=null,e.bufferCanvas=null,e.context=null,e.bufferContext=null,e.commands=null,e.resizeCallback=null,e.container=null,e.aspectData=null,e.clientRect=null,e.previousOffsetSize=null;for(let n in It)e[n]=null;for(let n of Et)e[n.name]=null;for(let n of At)e[n.name]=null;if(e===Ie){Ie=null;for(let n in Y)if(Y[n]!==e){Ie=Y[n];break}}for(let n of to)n(e);delete Y[t]}I("setScreen",In,["screen"]);function In(e){let t=e.screen,o;if(Number.isInteger(t)?o=t:t&&Number.isInteger(t.id)&&(o=t.id),!Y[o]){let n=new Error("screen: Invalid screen.");throw n.code="INVALID_SCREEN",n}Ie=Y[o]}I("getScreen",En,["screenId"]);function En(e){let t=m(e.screenId,null);if(t===null){let n=new Error("screen: Invalid screen id.");throw n.code="INVALID_SCREEN_ID",n}let o=Y[t];if(!o){let n=new Error(`screen: Screen "${t} not found.`);throw n.code="SCREEN_NOT_FOUND",n}return o.api}h("width",An,[]);function An(e){return e.width}h("height",xn,[]);function xn(e){return e.height}h("canvas",bn,[]);function bn(e){return e.canvas}h("setPixelMode",Cn,["isEnabled"]);function Cn(e,t){if(!!t.isEnabled){e.context.imageSmoothingEnabled=!1;for(let n in Ke)wt(e,Ke[n]),Ue(Ke[n])}else{e.context.imageSmoothingEnabled=!0;for(let n in Ye)wt(e,Ye[n]),Ue(Ye[n])}}h("getPixelMode",Mn,[]);function Mn(e){return!e.context.imageSmoothingEnabled}function wt(e,t){e.api[t.name]=(...o)=>{let n=ce(o,t.parameterNames);return t.fn(e,n)}}function Nn(e){let t=e.replaceAll(" ","").match(/^(\d+)(:|x|e|m)(\d+)$/);if(!t)return null;let o=Number(t[1]),n=t[2],r=Number(t[3]);return isNaN(o)||o===0||isNaN(r)||r===0?null:{width:o,height:r,splitter:n,isMultiple:n==="m"||n==="e"}}function Tn(e){if(e.isOffscreen){if(!e.aspectData){let t=new Error("screen: You must supply an aspect ratio with exact dimensions for offscreen screens.");throw t.code="NO_ASPECT_OFFSCREEN",t}if(e.aspectData.splitter!=="x"){let t=new Error("screen: You must use aspect ratio with e(x)act pixel dimensions for offscreenscreens. For example: 320x200 for width of 320 and height of 200 pixels.");throw t.code="INVALID_OFFSCREEN_ASPECT",t}return kn(e)}if(typeof e.container=="string")e.container=document.getElementById(e.container);else if(!e.container)e.container=document.body;else if(!ut(e.container)){let t=new TypeError("screen: Invalid argument container. Container must be a DOM element or a string id of a DOM element.");throw t.code="INVALID_CONTAINER",t}return e.noStyles?Pn(e):Fn(e)}function kn(e){return e.canvas=document.createElement("canvas"),e.canvas.width=e.aspectData.width,e.canvas.height=e.aspectData.height,e.bufferCanvas=document.createElement("canvas"),e.bufferCanvas.width=e.aspectData.width,e.bufferCanvas.height=e.aspectData.height,e.container=null,e.isOffscreen=!0,e.isNoStyles=!1,e.resizeCallback=null,e.previousOffsetSize=null,Ct(e)}function Fn(e){e.canvas=document.createElement("canvas"),e.bufferCanvas=document.createElement("canvas"),e.canvas.tabIndex=0,e.canvas.style.outline="none",e.canvas.style.backgroundColor="black",e.canvas.style.position="absolute",e.canvas.style.imageRendering="pixelated",e.canvas.style.imageRendering="crisp-edges";let t=!0;if(e.container===document.body&&(t=!1,document.documentElement.style.height="100%",document.documentElement.style.margin="0",document.body.style.height="100%",document.body.style.margin="0",document.body.style.overflow="hidden",e.canvas.style.left="0",e.canvas.style.top="0"),e.container.offsetHeight===0&&(e.container.style.height="200px"),e.container.appendChild(e.canvas),e.aspectData){let n=Fe(e.container);oo(e.aspectData,e.canvas,n.width,n.height),e.bufferCanvas.width=e.canvas.width,e.bufferCanvas.height=e.canvas.height}else{t&&(e.canvas.style.position="static"),e.canvas.style.width="100%",e.canvas.style.height="100%";let n=Fe(e.canvas);e.canvas.width=n.width,e.canvas.height=n.height,e.bufferCanvas.width=n.width,e.bufferCanvas.height=n.height}e.previousOffsetSize={width:e.canvas.offsetWidth,height:e.canvas.offsetHeight};let o=Ct(e);return ke&&e.container&&!$e.has(e.container)&&(ke.observe(e.container),$e.add(e.container)),o}function Pn(e){if(e.canvas=document.createElement("canvas"),e.bufferCanvas=document.createElement("canvas"),e.container.appendChild(e.canvas),e.canvas.tabIndex=0,e.aspectData&&e.aspectData.splitter==="x")e.canvas.width=e.aspectData.width,e.canvas.height=e.aspectData.height,e.bufferCanvas.width=e.canvas.width,e.bufferCanvas.height=e.canvas.height;else{let t=Fe(e.canvas);e.bufferCanvas.width=t.width,e.bufferCanvas.height=t.height}return e.previousOffsetSize=null,Ct(e)}function Ct(e){let t={willReadFrequently:!!e.willReadFrequently},o=Object.create(pn);o.id=yt;let n={id:yt,canvas:e.canvas,width:e.canvas.width,height:e.canvas.height,container:e.container,aspectData:e.aspectData,isOffscreen:e.isOffscreen,isNoStyles:e.isNoStyles,context:e.canvas.getContext("2d",t),bufferCanvas:e.bufferCanvas,bufferContext:e.bufferCanvas.getContext("2d",t),clientRect:e.canvas.getBoundingClientRect(),resizeCallback:e.resizeCallback,previousOffsetSize:e.previousOffsetSize||null,api:o};Object.assign(n,structuredClone(It));for(let r of Et)n[r.name]=structuredClone(r.fn());for(let r of At)n[r.name]=r.fn;return yt+=1,e.canvas.dataset.screenId=n.id,n.context.imageSmoothingEnabled=!1,n.context.fillStyle=n.color.hex,n.context.strokeStyle=n.color.hex,n}function oo(e,t,o,n){let r=e.width,i=e.height,s=e.splitter,l,c;if(e.isMultiple&&s!==":"){let a=Math.floor(o/r),u=Math.floor(n/i),d=a>u?u:a;d<1&&(d=1),l=r*d,c=i*d,s==="e"&&(r=Math.floor(o/d),i=Math.floor(n/d),l=r*d,c=i*d)}else{let a=i/r,u=r/i;l=n*u,c=o*a,l>o?(l=o,c=l*a):c=n,s==="e"&&(r+=Math.round((o-l)*(r/l)),i+=Math.round((n-c)*(i/c)),l=o,c=n)}t.style.width=Math.floor(l)+"px",t.style.height=Math.floor(c)+"px",t.style.marginLeft=Math.floor((o-l)/2)+"px",t.style.marginTop=Math.floor((n-c)/2)+"px",s!==":"?(t.width=r,t.height=i):(t.width=Math.floor(l),t.height=Math.floor(c))}function Fe(e){return{width:e.offsetWidth||e.clientWidth||e.width,height:e.offsetHeight||e.clientHeight||e.height}}function jn(e){if(e.isOffscreen||e.isNoStyles||e.canvas.offsetParent===null)return;let t=e.previousOffsetSize||{width:e.canvas.offsetWidth,height:e.canvas.offsetHeight};e.bufferContext.clearRect(0,0,e.width,e.height),e.bufferContext.drawImage(e.canvas,0,0);let o;e.aspectData?(o=Fe(e.container),oo(e.aspectData,e.canvas,o.width,o.height)):(o=Fe(e.canvas),e.canvas.width=o.width,e.canvas.height=o.height),e.clientRect=e.canvas.getBoundingClientRect(),e.context.drawImage(e.bufferCanvas,0,0,e.width,e.height),e.bufferCanvas.width=e.canvas.width,e.bufferCanvas.height=e.canvas.height,e.width=e.canvas.width,e.height=e.canvas.height;let n={width:e.canvas.offsetWidth,height:e.canvas.offsetHeight};e.resizeCallback&&(t.width!==n.width||t.height!==n.height)&&e.resizeCallback(e.api,t,n),e.previousOffsetSize=n}var ge={},He={};function io(){Mt("pixel",qn,"square"),Mt("square",zn,"square"),Mt("circle",Gn,"round"),no("replace",On),no("alpha",Bn),b("imageData",null),b("imageData2",null),b("isDirty",!1),b("penData",{cap:"square",size:1}),b("blendData",{noise:null}),b("isAutoRender",!0),b("autoRenderMicrotaskScheduled",!1),$("pen",ge.pixel.fn),$("blend",He.replace.fn),$("blendColor",so)}function M(e){(e.isDirty===!1||e.imageData===null)&&(e.imageData=e.context.getImageData(0,0,e.width,e.height),e.imageData2=e.imageData.data)}function N(e){e.isDirty===!1&&(e.isDirty=!0,e.isAutoRender&&!e.autoRenderMicrotaskScheduled&&(e.autoRenderMicrotaskScheduled=!0,mt(function(){e.isAutoRender&&e.api.render(),e.autoRenderMicrotaskScheduled=!1})))}h("render",Ln,[]);function Ln(e){e.imageData&&e.isDirty&&e.context.putImageData(e.imageData,0,0),e.isDirty=!1}h("cls",Sn,["x","y","width","height"]);function Sn(e,t){let o=m(t.x,0),n=m(t.y,0),r=m(t.width,e.width),i=m(t.height,e.height);o!==0||n!==0||r!==e.width||i!==e.height?(e.api.render(),e.context.clearRect(o,n,r,i)):(e.context.clearRect(o,n,r,i),e.imageData=null,e.isDirty=!1,e.printCursor.x=0,e.printCursor.y=0,e.cursor.x=0,e.cursor.y=0)}h("setAutoRender",Rn,["isAutoRender"]);function Rn(e,t){let o=!!t.isAutoRender;e.isAutoRender=o,o&&e.api.render()}h("setPen",_n,["pen","size"]);function _n(e,t){let o=t.pen,n=A(t.size,null);if(!ge[o]){let r=new TypeError("setPen: parameter pen is not a valid pen.");throw r.code="INVALID_PEN",r}if(n===null){let r=new TypeError("setPen: parameter size must be a number");throw r.code="INVALID_SIZE",r}o==="pixel"&&(n=1),n<1&&(n=1),n===1?(e.pen=ge.pixel.fn,e.context.lineWidth=1):(e.pen=ge[o].fn,e.context.lineWidth=n),e.penData.size=n,e.penData.cap=ge[o].cap,e.context.lineCap=ge[o].cap}h("setBlend",Vn,["mode","noise"]);function Vn(e,t){let o=t.mode,n=t.noise;if(!He[o]){let r=new TypeError("setBlend: Argument blend is not a valid blend mode.");throw r.code="INVALID_BLEND_MODE",r}if(Array.isArray(n)){for(let r=0;r<n.length;r++)if(isNaN(n[r])){let i=new TypeError("setBlend: parameter noise array contains an invalid value");throw i.code="INVALID_NOISE_VALUE",i}e.blendColor=ro,e.blendData.noise=n}else n=m(n,null),n===null?(e.blendColor=so,e.blendData.noise=null):(e.blendColor=ro,e.blendData.noise=x(n,0,255));e.blend=He[o].fn}function Mt(e,t,o){ge[e]={fn:t,cap:o,size:1}}function no(e,t){He[e]={fn:t}}function so(e,t){return t}function ro(e,t){let o=e.blendData.noise,n={r:t.r,g:t.g,b:t.b,a:t.a},r=o/2;if(Array.isArray(o))n.r=x(Math.round(n.r+ye(-o[0],o[0])),0,255),n.g=x(Math.round(n.g+ye(-o[1],o[1])),0,255),n.b=x(Math.round(n.b+ye(-o[2],o[2])),0,255),n.a=x(n.a+ye(-o[3],o[3]),0,255);else{let i=Math.round(Math.random()*o-r);n.r=x(n.r+i,0,255),n.g=x(n.g+i,0,255),n.b=x(n.b+i,0,255)}return n}function On(e,t,o,n){n=e.blendColor(e,n);let r=e.imageData2,i=(e.width*o+t)*4;r[i]=n.r,r[i+1]=n.g,r[i+2]=n.b,r[i+3]=n.a}function Bn(e,t,o,n){n=e.blendColor(e,n);let r=e.imageData2,i=(e.width*o+t)*4,s=n.a/255,l=r[i+3]/255,c=s+l*(1-s);r[i]=Math.round((n.r*s+r[i]*l*(1-s))/c),r[i+1]=Math.round((n.g*s+r[i+1]*l*(1-s))/c),r[i+2]=Math.round((n.b*s+r[i+2]*l*(1-s))/c),r[i+3]=Math.round(c*255)}function qn(e,t,o,n){t<0||t>=e.width||o<0||o>=e.height||e.blend(e,t,o,n)}function zn(e,t,o,n){let r=Math.round(e.penData.size)|1,i=Math.round(r/2)-1,s=x(t-i,0,e.width),l=x(t-i+r,0,e.width),c=x(o-i,0,e.height),a=x(o-i+r,0,e.height);for(let u=c;u<a;u++)for(let d=s;d<l;d++)e.blend(e,d,u,n)}function Gn(e,t,o,n){let r=Math.round(e.penData.size);if(r===2){t>=0&&t<e.width&&o>=0&&o<e.height&&e.blend(e,t,o,n),t+1>=0&&t+1<e.width&&o>=0&&o<e.height&&e.blend(e,t+1,o,n),t-1>=0&&t-1<e.width&&o>=0&&o<e.height&&e.blend(e,t-1,o,n),t>=0&&t<e.width&&o+1>=0&&o+1<e.height&&e.blend(e,t,o+1,n),t>=0&&t<e.width&&o-1>=0&&o-1<e.height&&e.blend(e,t,o-1,n);return}let i=r*2,s=r,l=s-1,c=(s-.5)*(s-.5),a=x(t-l,0,e.width),u=x(t-l+i,0,e.width),d=x(o-l,0,e.height),g=x(o-l+i,0,e.height);for(let f=d;f<g;f++){let y=f-o;for(let p=a;p<u;p++){let v=p-t;v*v+y*y<c&&e.blend(e,p,f,n)}}}var re=[],Ze=new Map,Pe=-1;function co(){lo({pal:["#0000AA","#00AA00","#00AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF","#000000","#141414","#202020","#2D2D2D","#393939","#454545","#515151","#616161","#717171","#828282","#929292","#A2A2A2","#B6B6B6","#CACACA","#E3E3E3","#FFFFFF","#0000FF","#4100FF","#7D00FF","#BE00FF","#FF00FF","#FF00BE","#FF007D","#FF0041","#FF0000","#FF4100","#FF7D00","#FFBE00","#FFFF00","#BEFF00","#7DFF00","#41FF00","#00FF00","#00FF41","#00FF7D","#00FFBE","#00FFFF","#00BEFF","#007DFF","#0041FF","#7D7DFF","#9E7DFF","#BE7DFF","#DF7DFF","#FF7DFF","#FF7DDF","#FF7DBE","#FF7D9E","#FF7D7D","#FF9E7D","#FFBE7D","#FFDF7D","#FFFF7D","#DFFF7D","#BEFF7D","#9EFF7D","#7DFF7D","#7DFF9E","#7DFFBE","#7DFFDF","#7DFFFF","#7DDFFF","#7DBEFF","#7D9EFF","#B6B6FF","#C6B6FF","#DBB6FF","#EBB6FF","#FFB6FF","#FFB6EB","#FFB6DB","#FFB6C6","#FFB6B6","#FFC6B6","#FFDBB6","#FFEBB6","#FFFFB6","#EBFFB6","#DBFFB6","#C6FFB6","#B6FFB6","#B6FFC6","#B6FFDB","#B6FFEB","#B6FFFF","#B6EBFF","#B6DBFF","#B6C6FF","#000071","#1C0071","#390071","#550071","#710071","#710055","#710039","#71001C","#710000","#711C00","#713900","#715500","#717100","#557100","#397100","#1C7100","#007100","#00711C","#007139","#007155","#007171","#005571","#003971","#001C71","#393971","#453971","#553971","#613971","#713971","#713961","#713955","#713945","#713939","#714539","#715539","#716139","#717139","#617139","#557139","#457139","#397139","#397145","#397155","#397161","#397171","#396171","#395571","#394571","#515171","#595171","#615171","#695171","#715171","#715169","#715161","#715159","#715151","#715951","#716151","#716951","#717151","#697151","#617151","#597151","#517151","#517159","#517161","#517169","#517171","#516971","#516171","#515971","#000041","#100041","#200041","#310041","#410041","#410031","#410020","#410010","#410000","#411000","#412000","#413100","#414100","#314100","#204100","#104100","#004100","#004110","#004120","#004131","#004141","#003141","#002041","#001041","#202041","#282041","#312041","#392041","#412041","#412039","#412031","#412028","#412020","#412820","#413120","#413920","#414120","#394120","#314120","#284120","#204120","#204128","#204131","#204139","#204141","#203941","#203141","#202841","#2D2D41","#312D41","#352D41","#3D2D41","#412D41","#412D3D","#412D35","#412D31","#412D2D","#41312D","#41352D","#413D2D","#41412D","#3D412D","#35412D","#31412D","#2D412D","#2D4131","#2D4135","#2D413D","#2D4141","#2D3D41","#2D3541","#2D3141","#000000","#000000","#000000","#000000","#000000","#000000","#000000"]}),ao({color:7}),oe("pal",()=>re),oe("color",()=>Pe),oe("palMap",()=>Ze)}I("setDefaultPal",lo,["pal"]);function lo(e){let t=e.pal;if(!Array.isArray(t)){let o=new TypeError("setDefaultPal: Parameter pal must be an array.");throw o.code="INVALID_PARAMETER",o}if(t.length===0){let o=new RangeError("setDefaultPal: Parameter pal must have at least one color value.");throw o.code="EMPTY_PALETTE",o}re=[j([0,0,0,0])];for(let o=0;o<t.length;o++){let n=j(t[o]);n===null?(console.warn(`setDefaultPal: Invalid color value inside array pal at index: ${o}.`),re.push(j("#000000"))):re.push(n)}Ze=new Map;for(let o=0;o<re.length;o++)Ze.set(re[o].key,o);Ze.has(Pe.key)||(Pe=re[1])}I("setDefaultColor",ao,["color"]);function ao(e){let t=e.color;if(!isNaN(Number(t))&&re.length>t)Pe=re[t];else{if(t=j(t),t===null){let o=new TypeError("setDefaultColor: Parameter color is not a valid color format.");throw o.code="INVALID_PARAMETER",o}Pe=t}}h("setColor",Wn,["color","isAddToPalette"]);function Wn(e,t){let o=t.color,n=!!t.isAddToPalette,r;if(typeof o=="number"){if(o>=e.pal.length){let i=new TypeError("setColor: Parameter color index is not in pal.");throw i.code="INVALID_PARAMETER",i}r=e.pal[o]}else{if(r=j(o),r===null){let i=new TypeError("setColor: Parameter color is not a valid color format.");throw i.code="INVALID_PARAMETER",i}n&&fe(e,r)===null&&(e.pal.push(r),e.palMap.set(r.key,e.pal.length-1))}return e.color=r,e.context.fillStyle=e.color.hex,e.context.strokeStyle=e.color.hex,!0}h("getPalIndex",Un,["color","tolerance"]);function Un(e,t){let o=t.color,n=A(t.tolerance,1);if(n<0||n>1){let s=new RangeError("getPalIndex: Parameter tolerance must be a number between 0 and 1.");throw s.code="INVALID_PARAMETER",s}let r=j(o);if(r===null){let s=new TypeError("getPalIndex: Parameter color is not a valid color format.");throw s.code="INVALID_COLOR",s}let i=fe(e,r,n);return i===null?!1:i}h("setBgColor",Kn,["color"]);function Kn(e,t){let o=t.color,n;if(Number.isInteger(o)?n=e.pal[o]:n=j(o),n&&typeof n.hex=="string")e.canvas.style.backgroundColor=n.hex;else{let r=new TypeError("bgColor: invalid color value for parameter color.");throw r.code="INVALID_COLOR",r}}h("setContainerBgColor",Yn,["color"]);function Yn(e,t){let o=t.color,n;if(e.container)if(Number.isInteger(o)?n=e.pal[o]:n=j(o),n&&typeof n.hex=="string"){e.container.style.backgroundColor=n.hex;return}else{let r=new TypeError("containerBgColor: invalid color value for parameter color.");throw r.code="INVALID_COLOR",r}}h("setPalColor",$n,["index","color"]);function $n(e,t){let o=t.index,n=t.color;if(!Number.isInteger(o)||o<0||o>=e.pal.length){let s=new RangeError("setPalColor: Parameter index must be an integer value.");throw s.code="INVALID_INDEX",s}if(o===0){let s=new RangeError("setPalColor: Parameter index cannot be 0, this is reserved for transparency. To set background color of the screen use the setBgColor command.");throw s.code="INVALID_INDEX",s}let r=j(n);if(r===null){let s=new TypeError("setPalColor: Parameter color is not a valid color format.");throw s.code="INVALID_COLOR",s}let i=e.pal[o];e.color.key===i.key&&(e.color=r,e.context.fillStyle=r.hex,e.context.strokeStyle=r.hex),e.pal[o]=r,e.palMap.delete(i.key),e.palMap.set(r.key,o)}h("getPal",Xn,[]);function Xn(e){let t=[];for(let o=1;o<e.pal.length;o+=1)t.push({...e.pal[o]});return t}h("getPalInternal",Hn,[]);function Hn(e){let t=[];for(let o=0;o<e.pal.length;o+=1)t.push({...e.pal[o]});return t}h("setPal",Zn,["pal"]);function Zn(e,t){let o=t.pal;if(!Array.isArray(o)){let s=new TypeError("setPal: Parameter pal is must be an array.");throw s.code="INVALID_PARAMETER",s}if(o.length===0){let s=new RangeError("setPal: Parameter pal must have at least one color value.");throw s.code="EMPTY_PALETTE",s}let n=[j([0,0,0,0])];for(let s=0;s<o.length;s++){let l=j(o[s]);l===null?(console.warn(`setPal: Invalid color value inside array pal at index: ${s}.`),n.push(j("#000000"))):n.push(l)}e.pal=n,e.palMap=new Map;for(let s=0;s<n.length;s++)e.palMap.set(n[s].key,s);let r=e.color,i=fe(e,r);i!==null?(e.color=n[i],e.context.fillStyle=e.color.hex,e.context.strokeStyle=e.color.hex):(e.color=n[1],e.context.fillStyle=e.color.hex,e.context.strokeStyle=e.color.hex)}h("replaceColors",Qn,["findColors","newColors"]);function Qn(e,t){let o=t.findColors,n=t.newColors;if(!Array.isArray(o)||!Array.isArray(n)){let s=new TypeError("replaceColors: Parameter findColors is must be an array.");throw s.code="INVALID_PARAMETER",s}if(o.length>n.length){let s=[];for(let l=0;l<n.length;l+=1)s.push(o[l]);o=s}let r={};for(let s=0;s<o.length;s+=1){let l=q(e,o[s]);if(l===null){console.warn(`replaceColors: Invalid color value inside array findColors at index: ${s}.`);continue}let c=q(e,n[s]);if(c===null){console.warn(`replaceColors: Invalid color value inside array newColors at index: ${s}.`);continue}r[l.key]=c}if(Object.keys(r).length===0){let s=new TypeError("replaceColors: No valid find and new colors found.");throw s.code="INVALID_PARAMETER",s}M(e);let i=e.imageData2;for(let s=0;s<e.height;s++)for(let l=0;l<e.width;l++){let c=(e.width*s+l)*4,a=i[c],u=i[c+1],d=i[c+2],g=i[c+3],f=le(a,u,d,g);r[f]&&(i[c]=r[f].r,i[c+1]=r[f].g,i[c+2]=r[f].b,i[c+3]=r[f].a)}N(e)}h("replacePalColors",Jn,["findColors","newColors"]);function Jn(e,t){let o=t.findColors,n=t.newColors;if(!Array.isArray(o)||!Array.isArray(n)){let s=new TypeError("replacePalColors: Parameter findColors is must be an array.");throw s.code="INVALID_PARAMETER",s}if(o.length>n.length){let s=[];for(let l=0;l<n.length;l+=1)s.push(o[l]);o=s}let r={};for(let s=0;s<o.length;s+=1){let l=null;if(Number.isInteger(o[s])&&o[s]<e.pal.length&&(l=e.pal[o[s]]),l===null&&(l=j(o[s]),fe(e,l)===null))continue;let c=null;if(Number.isInteger(n[s])&&n[s]<e.pal.length&&(c=e.pal[n[s]]),c===null&&(c=j(n[s])),c===null){console.warn(`replacePalColors: Invalid color value inside array newColors at index: ${s}.`);continue}r[l.key]=c}if(Object.keys(r).length===0)return;M(e);let i=e.imageData2;for(let s=0;s<e.height;s++)for(let l=0;l<e.width;l++){let c=(e.width*s+l)*4,a=i[c],u=i[c+1],d=i[c+2],g=i[c+3],f=le(a,u,d,g);r[f]&&(i[c]=r[f].r,i[c+1]=r[f].g,i[c+2]=r[f].b,i[c+3]=r[f].a)}for(let s=0;s<e.pal.length;s+=1){let l=e.pal[s].key;r[l]&&(e.pal[s]=r[l])}e.palMap=new Map;for(let s=0;s<e.pal.length;s+=1)e.palMap.set(e.pal[s].key,s);N(e)}function q(e,t){let o;return Number.isInteger(t)?t>=e.pal.length?null:e.pal[t]:(o=j(t),o)}function fe(e,t,o=1){if(e.palMap.has(t.key))return e.palMap.get(t.key);let n=65025*3.25;o=o*(2-o)*n;for(let r=0;r<e.pal.length;r++){if(e.pal[r].key===t.key)return r;{let i;if(r===0?i=ue(e.pal[r],t,[.2,.2,.2,.4]):i=ue(e.pal[r],t),n-i>=o)return r}}return null}var Dn=new Set(["INPUT","TEXTAREA","SELECT","BUTTON"]),er=500,U={},J={},xe=new Set,X={},E=null,Je=!1;function uo(){go(),window.addEventListener("blur",et)}function Nt(){for(let e in X)delete X[e]}I("startKeyboard",go,[]);function go(){Je||(window.addEventListener("keydown",fo,{capture:!0}),window.addEventListener("keyup",mo,{capture:!0}),Je=!0,document.activeElement&&document.activeElement.blur())}I("stopKeyboard",tr,[]);function tr(){Je&&(window.removeEventListener("keydown",fo,{capture:!0}),window.removeEventListener("keyup",mo,{capture:!0}),Je=!1,et())}I("inkey",or,["key"]);function or(e){let t=e.key;if(t){if(typeof t!="string"){let n=new TypeError("inkey: key must be a string.");throw n.code="INVALID_PARAMETERS",n}return U[t]?U[t]:J[t]?J[t]:null}let o=[];for(let n in U)U[n]&&o.push(U[n]);return o}I("setActionKeys",nr,["keys"]);function nr(e){let t=e.keys;if(!Array.isArray(t)){let o=new TypeError("setActionKeys: keys must be an array.");throw o.code="INVALID_PARAMETERS",o}for(let o of t)xe.add(o)}I("removeActionKeys",rr,["keys"]);function rr(e){let t=e.keys;if(!Array.isArray(t)){let o=new TypeError("removeActionKeys: keys must be an array.");throw o.code="INVALID_PARAMETERS",o}for(let o of t)xe.delete(o)}I("onkey",ir,["key","mode","fn","once","allowRepeat"]);function ir(e){let t=e.key,o=e.mode,n=e.fn,r=!!e.once,i=!!e.allowRepeat;if(!t||typeof t!="string"&&!Array.isArray(t)){let c=new TypeError("onkey: key must be a string or an array of strings.");throw c.code="INVALID_PARAMETERS",c}if(!o||typeof o!="string"){let c=new TypeError("onkey: mode must be a string with value of up or down.");throw c.code="INVALID_PARAMETERS",c}if(typeof n!="function"){let c=new TypeError("onkey: fn must be a function.");throw c.code="INVALID_PARAMETERS",c}let s=typeof t=="string"?[t]:t,l={comboKey:s.sort().join(""),combo:s,mode:o,fn:n,once:r,allowRepeat:i,isRemoved:!1};for(let c of s)X[c]||(X[c]=[]),X[c].push(l)}I("offkey",sr,["key","mode","fn","once","allowRepeat"]);function sr(e){let t=e.key,o=e.mode,n=e.fn,r=!!e.once,i=!!e.allowRepeat;if(!t||typeof t!="string"&&!Array.isArray(t)){let c=new TypeError("offkey: key must be a string or an array of strings.");throw c.code="INVALID_PARAMETERS",c}if(typeof n!="function"){let c=new TypeError("offkey: callback must be a function.");throw c.code="INVALID_PARAMETERS",c}let s=typeof t=="string"?[t]:t,l=s.sort().join("");for(let c of s){let a=X[c];if(!a)continue;let u=[];for(let d=0;d<a.length;d+=1){let g=a[d];g.comboKey===l&&g.mode===o&&g.fn===n&&g.once===r&&g.allowRepeat===i&&(u.push(d),g.isRemoved=!0)}for(let d=u.length-1;d>=0;d-=1)a.splice(u[d],1);a.length===0&&delete X[c]}}h("input",cr,["prompt","fn","cursor","isNumber","isInteger","allowNegative"]);function cr(e,t){let o=t.prompt,n=t.fn,r=t.cursor?t.cursor:"\xDB",i=!!t.isNumber,s=!!t.isInteger,l=!!t.allowNegative;if(typeof o!="string"){let d=new TypeError("input: prompt must be a string");throw d.code="INVALID_PARAMETERS",d}if(n&&typeof n!="function"){let d=new TypeError("input: fn must be a function.");throw d.code="INVALID_PARAMETERS",d}if(typeof r!="string"){let d=new TypeError("input: cursor must be a string");throw d.code="INVALID_PARAMETERS",d}let c,a,u=new Promise((d,g)=>{c=d,a=g});return E&&De(!0),E={screenData:e,prompt:o,cursor:r,lastCursorBlink:Date.now(),showCursor:!0,isNumber:i,isInteger:s,allowNegative:l,val:"",fn:n,resolve:c,reject:a},ar(),u}h("cancelInput",lr,[]);function lr(e){E&&De(!0)}function fo(e){if(ho(e)){et();return}let t={code:e.code,key:e.key,location:e.location,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,repeat:e.repeat};U[e.code]=t,J[e.key]=t,Ae(e,"down",e.code),Ae(e,"down",e.key),Ae(e,"down","any"),(xe.has(e.code)||xe.has(e.key))&&e.preventDefault()}function mo(e){if(ho(e)){et();return}Ae(e,"up",e.code),Ae(e,"up",e.key),Ae(e,"up","any"),delete U[e.code],delete J[e.key],(xe.has(e.code)||xe.has(e.key))&&e.preventDefault()}function Ae(e,t,o){let n=X[o];if(!n)return;let r=o==="any",i=n.slice(),s=new Set;for(let l=0;l<i.length;l+=1){let c=i[l];if(c.mode!==t||e.repeat&&!c.allowRepeat||c.isRemoved)continue;if(r){let u=U[e.code];u||(u=J[e.key]),u!==void 0&&c.fn(u),c.once&&(s.add(c),c.isRemoved=!0);continue}if(c.combo.every(u=>J[u]||U[u])){let u=c.combo.map(d=>J[d]?J[d]:U[d]);u.length===1?c.fn(u[0]):c.fn(u),c.once&&(s.add(c),c.isRemoved=!0)}}s.size>0&&(X[o]=n.filter(l=>!s.has(l)),X[o].length===0&&delete X[o])}function ho(e){let t=e.target;if(!t)return!1;if(Dn.has(t.tagName)||t.isContentEditable)return!0;let o=t.getAttribute&&t.getAttribute("role");return o==="textbox"||o==="searchbox"}function et(){for(let e in U)delete U[e];for(let e in J)delete J[e]}function ar(){let e=E.screenData,t=document.createElement("canvas");t.width=e.width,t.height=e.height;let o=t.getContext("2d");e.api.render(),o.drawImage(e.canvas,0,0),E.backCanvas=t,E.backContext=o,Te().onkey("any","down",po),E.interval=setInterval(vo,100)}function po(e){if(e.key==="Enter"){De();return}else if(e.key==="Escape"){De(!0);return}else if(e.key==="Backspace")E.val.length>0&&(E.val=E.val.substring(0,E.val.length-1));else if(e.key&&e.key.length===1){let t=!1;E.isNumber&&E.allowNegative&&(e.key==="-"?(E.val.charAt(0)!=="-"&&(E.val="-"+E.val),t=!0):e.key==="+"&&E.val.charAt(0)==="-"&&(E.val=E.val.substring(1),t=!0)),t||(E.val+=e.key,(E.isNumber&&isNaN(Number(E.val))||E.isInteger&&!Number.isInteger(Number(E.val)))&&(E.val=E.val.substring(0,E.val.length-1)))}}function vo(e){let t=E.screenData,o=E.prompt+E.val;if(!e){let l=Date.now();l-E.lastCursorBlink>er&&(E.lastCursorBlink=l,E.showCursor=!E.showCursor),E.showCursor&&(o+=E.cursor)}let n=t.api.getPos();n.row>=t.api.getRows()&&(t.api.print(""),t.api.setPos(n.col,n.row-1),n=t.api.getPos(t));let r=t.api.getPosPx(t),i=(o.length+1)*t.font.width,s=t.font.height;t.context.clearRect(r.x,r.y,i,s),t.context.drawImage(E.backCanvas,r.x,r.y,i,s,r.x,r.y,i,s),t.imageData=null,t.api.print(o,!0),t.api.setPos(n.col,n.row)}function De(e){let t=E.screenData;Te().offkey("any","down",po),vo(!0),t.printCursor.y+=t.font.height,clearInterval(E.interval);let o=E.val;E.isNumber&&(o===""||o==="-"?o=0:(o=Number(o),E.isInteger&&(o=Math.floor(o))));let n=E;E=null,e?n.reject(o):(n.resolve(o),n.fn&&n.fn(o))}function yo(){b("mouseStarted",!1),b("mouse",null),b("lastEvent",null),b("isContextMenuEnabled",!1),b("mouseEventListenersActive",0),b("onMouseEventListeners",{down:[],up:[],move:[]}),ne(dr),window.addEventListener("blur",vr)}function Tt(e){e.onMouseEventListeners={down:[],up:[],move:[]},e.mouseEventListenersActive=0}function dr(e){e.mouse={x:Math.floor(e.width/2),y:Math.floor(e.height/2),lastX:Math.floor(e.width/2),lastY:Math.floor(e.height/2),buttons:0,action:"none"}}h("startMouse",tt,[]);function tt(e){e.mouseStarted||(e.canvas.addEventListener("mousemove",wo),e.canvas.addEventListener("mousedown",Io),e.canvas.addEventListener("mouseup",Eo),e.canvas.addEventListener("contextmenu",Ao),e.mouseStarted=!0)}h("stopMouse",gr,[]);function gr(e){e.mouseStarted&&(e.canvas.removeEventListener("mousemove",wo),e.canvas.removeEventListener("mousedown",Io),e.canvas.removeEventListener("mouseup",Eo),e.canvas.removeEventListener("contextmenu",Ao),e.mouseStarted=!1)}h("getMouse",je,[]);function je(e){let t={};return t.x=e.mouse.x,t.y=e.mouse.y,t.lastX=e.mouse.lastX,t.lastY=e.mouse.lastY,t.buttons=e.mouse.buttons,t.action=e.mouse.action,t.type="mouse",t}h("inmouse",fr,[]);function fr(e){return tt(e),je(e)}h("setEnableContextMenu",mr,["isEnabled"]);function mr(e,t){e.isContextMenuEnabled=!!t.isEnabled,tt(e)}h("onmouse",hr,["mode","fn","once","hitBox","customData"]);function hr(e,t){let o=t.mode,n=t.fn,r=t.once,i=t.hitBox,s=t.customData;me(o,n,r,i,["down","up","move"],"onmouse",e.onMouseEventListeners,null,null,s)&&(tt(e),e.mouseEventListenersActive+=1)}h("offmouse",pr,["mode","fn"]);function pr(e,t){let o=t.mode,n=t.fn;ie(o,n,["down","up","move"],"offmouse",e.onMouseEventListeners)&&(n==null?e.mouseEventListenersActive=0:(e.mouseEventListenersActive-=1,e.mouseEventListenersActive<0&&(e.mouseEventListenersActive=0)))}function wo(e){let t=ot(e);if(!t)return;kt(t,e,"move");let o=je(t);t.mouseEventListenersActive>0&&H("move",o,t.onMouseEventListeners),t.triggerPressListeners&&t.triggerPressListeners(t,"move",o)}function Io(e){let t=ot(e);if(!t)return;kt(t,e,"down");let o=je(t);t.mouseEventListenersActive>0&&H("down",o,t.onMouseEventListeners),t.triggerPressListeners&&t.triggerPressListeners(t,"down",o),t.triggerClickListeners&&t.triggerClickListeners(t,o,"down")}function Eo(e){let t=ot(e);if(!t)return;kt(t,e,"up");let o=je(t);t.mouseEventListenersActive>0&&H("up",o,t.onMouseEventListeners),t.triggerPressListeners&&t.triggerPressListeners(t,"up",o),t.triggerClickListeners&&t.triggerClickListeners(t,o,"up")}function Ao(e){let t=ot(e);if(t&&!t.isContextMenuEnabled)return e.preventDefault(),!1}function kt(e,t,o){let n=e.clientRect,r=Math.floor(t.offsetX/n.width*e.width),i=Math.floor(t.offsetY/n.height*e.height),s=r,l=i;e.mouse&&(e.mouse.x!==void 0&&(s=e.mouse.x),e.mouse.y!==void 0&&(l=e.mouse.y)),e.mouse={x:r,y:i,lastX:s,lastY:l,buttons:t.buttons,action:o},e.lastEvent="mouse"}function ot(e){let t=e.target.dataset?.screenId;if(t===void 0)return null;let o=de();return o&&o.id===parseInt(t)?o:null}function vr(){let e=de();e&&e.mouse&&(e.mouse.buttons=0,e.mouse.action="up")}var wr=!1;function xo(){b("touchStarted",!1),b("touches",{}),b("lastTouches",{}),b("touchEventListenersActive",0),b("onTouchEventListeners",{}),ne(Ir),window.addEventListener("blur",Mr)}function Ft(e){e.onTouchEventListeners={},e.touchEventListenersActive=0}function Ir(e){e.onTouchEventListeners={start:[],end:[],move:[]}}h("startTouch",Pt,[]);function Pt(e){if(!e.touchStarted){let t={passive:!1};e.canvas.addEventListener("touchstart",bo,t),e.canvas.addEventListener("touchmove",Co,t),e.canvas.addEventListener("touchend",rt,t),e.canvas.addEventListener("touchcancel",rt,t),e.touchStarted=!0}}h("stopTouch",Er,[]);function Er(e){e.touchStarted&&(e.canvas.removeEventListener("touchstart",bo),e.canvas.removeEventListener("touchmove",Co),e.canvas.removeEventListener("touchend",rt),e.canvas.removeEventListener("touchcancel",rt),e.touchStarted=!1)}h("intouch",Ar,[]);function Ar(e){return Pt(e),it(e)}h("ontouch",xr,["mode","fn","once","hitBox","customData"]);function xr(e,t){let o=t.mode,n=t.fn,r=t.once,i=t.hitBox,s=t.customData;me(o,n,r,i,["start","end","move"],"ontouch",e.onTouchEventListeners,null,null,s)&&(Pt(e),e.touchEventListenersActive+=1)}h("offtouch",br,["mode","fn"]);function br(e,t){let o=t.mode,n=t.fn;ie(o,n,["start","end","move"],"offtouch",e.onTouchEventListeners)&&(n==null?e.touchEventListenersActive=0:(e.touchEventListenersActive-=1,e.touchEventListenersActive<0&&(e.touchEventListenersActive=0)))}I("setPinchZoom",Cr,["isEnabled"]);function Cr(e){!!e.isEnabled?document.body.style.touchAction="":document.body.style.touchAction="none"}function bo(e){wr=!0;let t=Lt(e);if(t==null)return;jt(t,e,"start");let o=it(t);t.touchEventListenersActive>0&&H("start",o,t.onTouchEventListeners),t.triggerPressListeners&&t.getTouchPress&&(t.triggerPressListeners(t,"down",t.getTouchPress(t)),e.preventDefault()),t.triggerClickListeners&&t.getTouchPress&&t.triggerClickListeners(t,t.getTouchPress(t),"down")}function Co(e){let t=Lt(e);if(t==null)return;jt(t,e,"move");let o=it(t);t.touchEventListenersActive>0&&H("move",o,t.onTouchEventListeners),t.triggerPressListeners&&t.getTouchPress&&t.triggerPressListeners(t,"move",t.getTouchPress(t))}function rt(e){let t=Lt(e);if(t==null)return;jt(t,e,"end");let o=it(t);t.touchEventListenersActive>0&&H("end",o,t.onTouchEventListeners),t.triggerPressListeners&&t.getTouchPress&&t.triggerPressListeners(t,"up",t.getTouchPress(t)),t.triggerClickListeners&&t.getTouchPress&&t.triggerClickListeners(t,t.getTouchPress(t),"up")}function jt(e,t,o){if(!e.clientRect)return;let n={},r=e.clientRect;for(let i=0;i<t.touches.length;i++){let s=t.touches[i],l={};l.x=Math.floor((s.clientX-r.left)/r.width*e.width),l.y=Math.floor((s.clientY-r.top)/r.height*e.height),l.id=s.identifier,e.touches[l.id]?(l.lastX=e.touches[l.id].x,l.lastY=e.touches[l.id].y):(l.lastX=null,l.lastY=null),l.action=o,n[l.id]=l}e.lastTouches=e.touches,e.touches=n,e.lastEvent="touch"}function it(e){let t=[];for(let o in e.touches){let n=e.touches[o],r={x:n.x,y:n.y,id:n.id,lastX:n.lastX,lastY:n.lastY,action:n.action,type:"touch"};t.push(r)}return t}function Lt(e){let t=e.target.dataset?.screenId;if(t===void 0)return null;let o=de();return o&&o.id===parseInt(t)?o:null}function Mr(){let e=de();e&&(e.lastTouches=e.touches,e.touches={})}function Mo(){b("pressEventListenersActive",0),b("onPressEventListeners",{}),b("clickEventListenersActive",0),b("onClickEventListeners",{}),ne(Tr)}function St(e){e.onPressEventListeners={},e.pressEventListenersActive=0}function Rt(e){e.onClickEventListeners={},e.clickEventListenersActive=0}function Tr(e){e.onPressEventListeners={down:[],up:[],move:[]},e.onClickEventListeners={click:[]}}h("inpress",kr,[]);function kr(e){return e.api.startMouse(),e.api.startTouch(),e.lastEvent==="touch"?No(e):e.api.getMouse()}h("onpress",Fr,["mode","fn","once","hitBox","customData"]);function Fr(e,t){let o=t.mode,n=t.fn,r=t.once,i=t.hitBox,s=t.customData;me(o,n,r,i,["down","up","move"],"onpress",e.onPressEventListeners,null,null,s)&&(e.api.startMouse(),e.api.startTouch(),e.pressEventListenersActive+=1)}h("offpress",Pr,["mode","fn"]);function Pr(e,t){let o=t.mode,n=t.fn;ie(o,n,["down","up","move"],"offpress",e.onPressEventListeners)&&(n==null?e.pressEventListenersActive=0:(e.pressEventListenersActive-=1,e.pressEventListenersActive<0&&(e.pressEventListenersActive=0)))}h("onclick",jr,["fn","once","hitBox","customData"]);function jr(e,t){let o=t.fn,n=t.once,r=t.hitBox,i=t.customData;r==null&&(r={x:0,y:0,width:e.width,height:e.height}),me("click",o,n,r,["click"],"onclick",e.onClickEventListeners,null,null,i)&&(e.api.startMouse(),e.api.startTouch(),e.clickEventListenersActive+=1)}h("offclick",Lr,["fn"]);function Lr(e,t){let o=t.fn;ie("click",o,["click"],"offclick",e.onClickEventListeners)&&(o==null?e.clickEventListenersActive=0:(e.clickEventListenersActive-=1,e.clickEventListenersActive<0&&(e.clickEventListenersActive=0)))}$("triggerPressListeners",Sr);function Sr(e,t,o){e.pressEventListenersActive>0&&H(t,o,e.onPressEventListeners)}$("triggerClickListeners",Rr);function Rr(e,t,o){e.clickEventListenersActive>0&&H("click",t,e.onClickEventListeners,o)}$("getTouchPress",No);function No(e){function t(n,r,i){for(let s in n){let l=n[s],c={x:l.x,y:l.y,id:l.id,lastX:l.lastX,lastY:l.lastY,action:l.action,type:"touch"};i!==void 0&&(c.action=i),r.push(c)}}let o=[];if(t(e.touches,o),o.length===0&&t(e.lastTouches,o,"up"),o.length>0){let n=o[0];return n.action==="up"?n.buttons=0:n.buttons=1,n.touches=o,n}else return{x:-1,y:-1,id:-1,lastX:-1,lastY:-1,action:"none",buttons:0,type:"touch"}}var he={},Vt=[],Ot=[],To=!1,pe=!1,D=null,Le=.2,_t=0,ko=-1;function Fo(){window.addEventListener("blur",Yr),window.addEventListener("focus",$r)}function Bt(){Vt.length=0,Ot.length=0}I("startGamepad",st,[]);function st(){To||(window.addEventListener("gamepadconnected",Gr),window.addEventListener("gamepaddisconnected",Wr),To=!0),pe||(pe=!0,D=requestAnimationFrame(qt))}I("stopGamepad",Vr,[]);function Vr(){pe&&(pe=!1,D&&(cancelAnimationFrame(D),D=null))}I("ingamepad",Or,["gamepadIndex"]);function Or(e){let t=e.gamepadIndex;if(st(),Po(),t==null)return Object.values(he).sort((o,n)=>o.index-n.index);if(!Number.isInteger(t)||t<0){let o=new TypeError("ingamepad: gamepadIndex must be a non-negative integer or null.");throw o.code="INVALID_PARAMETERS",o}return he[t]}I("setGamepadSensitivity",Br,["sensitivity"]);function Br(e){let t=e.sensitivity;if(typeof t!="number"||t<0||t>1){let o=new TypeError("setGamepadSensitivity: sensitivity must be a number between 0 and 1.");throw o.code="INVALID_PARAMETERS",o}t===1?Le=.99999:Le=t}I("onGamepadConnected",qr,["fn"]);function qr(e){let t=e.fn;if(typeof t!="function"){let o=new TypeError("onGamepadConnected: fn must be a function.");throw o.code="INVALID_PARAMETERS",o}Vt.push(t),st()}I("onGamepadDisconnected",zr,["fn"]);function zr(e){let t=e.fn;if(typeof t!="function"){let o=new TypeError("onGamepadDisconnected: fn must be a function.");throw o.code="INVALID_PARAMETERS",o}Ot.push(t),st()}function Gr(e){jo(e.gamepad);let t=he[e.gamepad.index];for(let o of Vt)o(t)}function Wr(e){let t={index:e.gamepad.index,id:e.gamepad.id,mapping:e.gamepad.mapping,connected:e.gamepad.connected};for(let o of Ot)o(t);delete he[e.gamepad.index]}function qt(){pe&&(Po(),_t+=1,D=requestAnimationFrame(qt))}function Po(){let e;if(ko!==_t){ko=_t,"getGamepads"in navigator?e=navigator.getGamepads():"webkitGetGamepads"in navigator?e=navigator.webkitGetGamepads():e=[];for(let t=0;t<e.length;t++)e[t]&&e[t].index in he&&jo(e[t])}}function Ur(e){let t={index:e.index,id:e.id,connected:e.connected,mapping:e.mapping,timestamp:e.timestamp,vibrationActuator:e.vibrationActuator,axes:[],lastAxes:[],buttons:[]};return t.getButton=function(o){return o<0||o>=this.buttons.length?null:this.buttons[o]},t.getButtonPressed=function(o){return o<0||o>=this.buttons.length?null:this.buttons[o].pressed},t.getButtonJustPressed=function(o){return o<0||o>=this.buttons.length?!1:this.buttons[o].pressStarted},t.getButtonJustReleased=function(o){return o<0||o>=this.buttons.length?!1:this.buttons[o].pressReleased},t.getAxis=function(o){return o<0||o>=this.axes.length?0:this.axes[o]},t.getAxisChanged=function(o){if(o<0||o>=this.axes.length)return!1;let n=this.axes[o],r=this.lastAxes[o]||0;return n!==r},t}function jo(e){let t=he[e.index];t||(t=Ur(e),he[e.index]=t);let o=[];for(let n=0;n<e.buttons.length;n+=1){let r=e.buttons[n],i=t.buttons[n]||{pressed:!1};o.push({pressed:r.pressed,value:r.value,pressStarted:!i.pressed&&r.pressed,pressReleased:i.pressed&&!r.pressed})}t.buttons=o,t.lastAxes=t.axes.slice(),t.axes=[];for(let n=0;n<e.axes.length;n++)t.axes.push(Kr(e.axes[n]));t.timestamp=e.timestamp,t.connected=e.connected,t.vibrationActuator=e.vibrationActuator}function Kr(e){return Math.abs(e)<Le?0:(e=e-Math.sign(e)*Le,e=e/(1-Le),e)}function Yr(){pe&&D&&(cancelAnimationFrame(D),D=null)}function $r(){pe&&!D&&(D=requestAnimationFrame(qt))}function Lo(){h("clearEvents",Hr,["type"],!0)}function Hr(e,t){let o=t.type,n=Array.isArray(o)?o:o?[o]:null;if(!n){Nt(),Bt(),e&&(Tt(e),Ft(e),St(e),Rt(e));return}for(let r of n){let i=r.toLowerCase();if(i==="keyboard")Nt();else if(i==="gamepad")Bt();else if(i==="mouse"){if(!e){let s=new Error("clearEvents: No screen available to clear mouse events.");throw s.code="NO_SCREEN",s}Tt(e)}else if(i==="touch"){if(!e){let s=new Error("clearEvents: No screen available to clear touch events.");throw s.code="NO_SCREEN",s}Ft(e)}else if(i==="press"){if(!e){let s=new Error("clearEvents: No screen available to clear press events.");throw s.code="NO_SCREEN",s}St(e)}else if(i==="click"){if(!e){let s=new Error("clearEvents: No screen available to clear click events.");throw s.code="NO_SCREEN",s}Rt(e)}else{let s=new Error(`clearEvents: Invalid type "${r}". Valid types: keyboard, mouse, touch, press, click, gamepad.`);throw s.code="INVALID_TYPE",s}}}function me(e,t,o,n,r,i,s,l,c,a){let u=!1;for(let d=0;d<r.length;d++)if(e===r[d]){u=!0;break}if(!u){let d=new Error(`${i}: mode needs to be one of the following: ${r.join(", ")}.`);throw d.code="INVALID_MODE",d}if(o=!!o,!B(t)){let d=new Error(`${i}: fn is not a valid function.`);throw d.code="INVALID_FUNCTION",d}if(n&&(!Number.isInteger(n.x)||!Number.isInteger(n.y)||!Number.isInteger(n.width)||!Number.isInteger(n.height))){let d=new Error(`${i}: hitBox must have properties x, y, width, and height whose values are integers.`);throw d.code="INVALID_HITBOX",d}return setTimeout(()=>{let d=t,g=e;typeof l=="string"&&(g=e+l);let f=t;o&&(f=(y,p)=>{ie(e,d,r,i,s,l),d(y,p)}),s[g]||(s[g]=[]),s[g].push({fn:f,hitBox:n,extraData:c,clickDown:!1,originalFn:d,customData:a})},1),!0}function ie(e,t,o,n,r,i){let s=!1;for(let c=0;c<o.length;c++)if(e===o[c]){s=!0;break}if(!s){let c=new Error(`${n}: mode needs to be one of the following: ${o.join(", ")}.`);throw c.code="INVALID_MODE",c}typeof i=="string"&&(e+=i);let l=t==null;if(!l&&!B(t)){let c=new Error(`${n}: fn is not a valid function.`);throw c.code="INVALID_FUNCTION",c}if(r[e]){if(l)delete r[e];else{for(let c=r[e].length-1;c>=0;c--)r[e][c].originalFn===t&&r[e].splice(c,1);r[e].length===0&&delete r[e]}return!0}return!1}function H(e,t,o,n){if(!o[e])return;let r=o[e].slice();for(let i=0;i<r.length;i++){let s=r[i];if(!(n==="up"&&!s.clickDown))if(s.hitBox){let l=!1,c;if(Array.isArray(t)){c=[];for(let a=0;a<t.length;a++){let u=t[a];Oe(u,s.hitBox)&&c.push(u)}c.length>0&&(l=!0)}else c=t,Oe(t,s.hitBox)&&(l=!0);l&&(n==="down"?s.clickDown=!0:(s.clickDown=!1,s.fn(c,s.customData)))}else s.fn(t,s.customData)}}function So(){b("cursor",{x:0,y:0})}G("pset",Zr,["x","y"]);function Zr(e,t){let o=m(t.x,null),n=m(t.y,null);if(o===null||n===null){let i=new TypeError("pset: Parameters x and y must be integers.");throw i.code="INVALID_PARAMETER",i}if(!gt(o,n,0,0,e.width,e.height))return;let r=e.color;M(e),e.pen(e,o,n,r),N(e),e.cursor.x=o,e.cursor.y=n}W("pset",Qr,["x","y"]);function Qr(e,t){let o=A(t.x,null),n=A(t.y,null);if(o===null||n===null){let r=new TypeError("pset: Parameters x and y must be numbers.");throw r.code="INVALID_PARAMETER",r}e.api.render(),e.context.beginPath(),e.context.moveTo(o,n),e.context.lineTo(o,n),e.context.stroke(),e.cursor.x=o,e.cursor.y=n}G("line",Jr,["x1","y1","x2","y2"]);function Jr(e,t){let o=m(t.x1,null),n=m(t.y1,null),r=m(t.x2,null),i=m(t.y2,null);if(o===null||n===null||r===null||i===null){let g=new TypeError("line: Arguments x1, y1, x2, and y2 must be integers.");throw g.code="INVALID_COORDINATES",g}let s=e.color,l=Math.abs(r-o),c=Math.abs(i-n),a;o<r?a=1:a=-1;let u;n<i?u=1:u=-1;let d=l-c;for(M(e),e.pen(e,o,n,s);!(o===r&&n===i);){let g=d<<1;g>-c&&(d-=c,o+=a),g<l&&(d+=l,n+=u),e.pen(e,o,n,s)}N(e)}W("line",Dr,["x1","y1","x2","y2"]);function Dr(e,t){let o=A(t.x1,null),n=A(t.y1,null),r=A(t.x2,null),i=A(t.y2,null);if(o===null||n===null||r===null||i===null){let s=new TypeError("line: Parameters x1, y1, x2, y2 must be numbers.");throw s.code="INVALID_PARAMETER",s}e.api.render(),e.context.strokeStyle=e.color.hex,e.context.beginPath(),e.context.moveTo(o,n),e.context.lineTo(r,i),e.context.stroke()}G("rect",e0,["x","y","width","height","fillColor"]);function e0(e,t){let o=m(t.x,null),n=m(t.y,null),r=m(t.width,null),i=m(t.height,null),s=t.fillColor;if(o===null||n===null||r===null||i===null){let u=new TypeError("rect: Paramters x, y, width, and height must be integers.");throw u.code="INVALID_PARAMETER",u}let l=!1;if(s!=null){if(s=q(e,s),s===null){let u=new TypeError("rect: Parameter fillColor must be a valid color format.");throw u.code="INVALID_PARAMETER",u}l=!0}let c=o+r-1,a=n+i-1;if(e.api.line(o,n,c,n),e.api.line(c,n,c,a),e.api.line(c,a,o,a),e.api.line(o,a,o,n),l&&r>e.penData.size&&i>e.penData.size&&r>2&&i>2){let u=e.color;e.color=s,M(e),n=n+e.penData.size;let d=a-e.penData.size+1;o=o+e.penData.size;let g=c-e.penData.size+1;for(o<0&&(o=0),g>e.width&&(g=e.width),n<0&&(n=0),d>e.height&&(d=e.height);n<d;n+=1)for(let f=o;f<g;f+=1)e.pen(e,f,n,s);N(e),e.color=u}}W("rect",t0,["x","y","width","height","fillColor"]);function t0(e,t){let o=A(t.x,null),n=A(t.y,null),r=A(t.width,null),i=A(t.height),s=t.fillColor,l=!1;if(o===null||n===null||r===null||i===null){let c=new TypeError("rect: Parameters x, y, width, height must be numbers.");throw c.code="INVALID_PARAMETER",c}if(s!=null){if(s=q(e,s),s===null){let c=new TypeError("rect: Parameter fillColor must be a valid color format.");throw c.code="INVALID_PARAMETER",c}l=!0}e.api.render(),e.context.beginPath(),e.context.strokeStyle=e.color.hex,e.context.rect(o,n,r,i),l&&(e.context.fillStyle=s.hex,e.context.fill()),e.context.stroke()}G("circle",o0,["x","y","radius","fillColor"]);function o0(e,t){let o=m(t.x,null),n=m(t.y,null),r=m(t.radius,null),i=t.fillColor,s=!1;if(o===null||n===null||r===null){let d=new TypeError("circle: Paramters x, y, and radius must be integers.");throw d.code="INVALID_PARAMETERS",d}if(i!=null){if(i=q(e,i),i===null){let d=new TypeError("circle: Parameter fillColor must be a valid color format.");throw d.code="INVALID_PARAMETER",d}s=!0}M(e);let l=e.color;if(s){let d=r-1,g=d*d;for(let f=-d;f<=d;f++){let y=n+f;if(y<0||y>=e.height)continue;let p=Math.floor(Math.sqrt(g-f*f));for(let v=o-p;v<=o+p;v++){if(v<0||v>=e.width)continue;let w=(y*e.width+v)*4,k=e.imageData2;k[w]=i.r,k[w+1]=i.g,k[w+2]=i.b,k[w+3]=i.a}}}r-=1;let c=r,a=0;r>1?(e.pen(e,c+o,a+n,l),e.pen(e,-c+o,a+n,l),e.pen(e,o,c+n,l),e.pen(e,o,-c+n,l)):r===1?(e.pen(e,o+1,n,l),e.pen(e,o-1,n,l),e.pen(e,o,n+1,l),e.pen(e,o,n-1,l),a=c+1):r===0&&(e.pen(e,o,n,l),a=c+1);let u=1-r;for(;c>a;)a+=1,u<=0?u=u+2*a+1:(c-=1,u=u+2*a-2*c+1),e.pen(e,c+o,a+n,l),e.pen(e,-c+o,a+n,l),e.pen(e,c+o,-a+n,l),e.pen(e,-c+o,-a+n,l),c!=a&&(e.pen(e,a+o,c+n,l),e.pen(e,-a+o,c+n,l),e.pen(e,a+o,-c+n,l),e.pen(e,-a+o,-c+n,l));N(e)}W("circle",n0,["x","y","radius","fillColor"]);function n0(e,t){let o=A(t.x+.5,null),n=A(t.y+.5,null),r=A(t.radius-.9,null),i=t.fillColor;if(isNaN(o)||isNaN(n)||isNaN(r)){let a=new TypeError("circle: Parameters cx, cy, r must be numbers.");throw a.code="INVALID_PARAMETERS",a}let s=!1;if(i!=null){if(i=q(e,i,"circle"),i===null){let a=new TypeError("circle: Parameter fillColor must be a valid color format.");throw a.code="INVALID_PARAMETER",a}s=!0}e.api.render();let l=T(0),c=T(360);e.context.beginPath(),e.context.arc(o,n,r,l,c),s&&(e.context.fillStyle=i.hex,e.context.fill()),e.context.strokeStyle=e.color.hex,e.context.stroke()}h("put",r0,["data","x","y","includeZero"]);function r0(e,t){let o=t.data,n=Math.round(t.x),r=Math.round(t.y),i=!!t.includeZero;if(!o||o.length<1)return;if(isNaN(n)||isNaN(r)){let u=new TypeError("put: Parameters x and y must be integers.");throw u.code="INVALID_COORDINATES",u}let s;n<0?s=n*-1:s=0;let l;r<0?l=r*-1:l=0;let c=o[0].length-s,a=o.length-l;if(n+s+c>=e.width&&(c=e.width-n+s),r+l+a>=e.height&&(a=e.height-r+l),!(c<=0||a<=0)){M(e);for(let u=l;u<l+a;u++)for(let d=s;d<s+c;d++){let g=e.pal[o[u][d]],f=(e.width*(r+u)+(n+d))*4;(g.a>0||i)&&(e.imageData2[f]=g.r,e.imageData2[f+1]=g.g,e.imageData2[f+2]=g.b,e.imageData2[f+3]=g.a)}N(e)}}h("get",i0,["x1","y1","x2","y2","tolerance"]);function i0(e,t){let o=Math.round(t.x1),n=Math.round(t.y1),r=Math.round(t.x2),i=Math.round(t.y2),s=t.tolerance,l=!!t.isAddToPalette;if(isNaN(o)||isNaN(n)||isNaN(r)||isNaN(i)){let g=new TypeError("get: Parameters x1, x2, y1, y2 must be integers.");throw g.code="INVALID_COORDINATES",g}if(s==null)s=1;else if(isNaN(s)){let g=new TypeError("get: Parameter tolerance must be a number.");throw g.code="INVALID_TOLERANCE",g}if(o=x(o,0,e.width-1),r=x(r,0,e.width-1),n=x(n,0,e.height-1),i=x(i,0,e.height-1),o>r){let g=o;o=r,r=g}if(n>i){let g=n;n=i,i=g}M(e);let c=e.imageData2,a=[],u;s===1?u=g=>{let f=le(c[g],c[g+1],c[g+2],c[g+3]);e.palMap.has(f)?a[d].push(e.palMap.get(f)):a[d].push(0)}:u=g=>{let f=ae(c[g],c[g+1],c[g+2],c[g+3]),y=fe(e,f,s);y===null?a[d].push(0):a[d].push(y)};let d=0;for(let g=n;g<=i;g++){a.push([]);for(let f=o;f<=r;f++){let y=(e.width*g+f)*4;u(y)}d+=1}return a}h("getPixel",s0,["x","y"]);function s0(e,t){let o=Math.round(t.x),n=Math.round(t.y);if(!Number.isInteger(o)||!Number.isInteger(n)){let c=new TypeError("getPixel: Arguments x and y must be integers.");throw c.code="INVALID_COORDINATES",c}if(o<0||o>=e.width||n<0||n>=e.height){let c=new RangeError("getPixel: Coordinates are out of bounds.");throw c.code="OUT_OF_BOUNDS",c}M(e);let r=e.imageData2,i=(e.width*n+o)*4,s=ae(r[i],r[i+1],r[i+2],r[i+3]);return fe(e,s)}h("getPixelColor",c0,["x","y"]);function c0(e,t){let o=Math.round(t.x),n=Math.round(t.y);if(!Number.isInteger(o)||!Number.isInteger(n)){let l=new TypeError("getPixelColor: Arguments x and y must be integers.");throw l.code="INVALID_COORDINATES",l}if(o<0||o>=e.width||n<0||n>=e.height){let l=new RangeError("getPixelColor: Coordinates are out of bounds.");throw l.code="OUT_OF_BOUNDS",l}M(e);let r=e.imageData2,i=(e.width*n+o)*4;return ae(r[i],r[i+1],r[i+2],r[i+3])}G("arc",a0,["x","y","radius","angle1","angle2"]);function a0(e,t){let o=m(t.x,null),n=m(t.y,null),r=m(t.radius,null),i=m(t.angle1,null),s=m(t.angle2,null);if(o===null||n===null||r===null||i===null||s===null){let f=new TypeError("arc: Argument's x, y, radius, angle1, and angle2 must be integers.");throw f.code="INVALID_PARAMETERS",f}i=(i+360)%360,s=(s+360)%360;let l=i>s;M(e);let c=e.color;r-=1,r<0&&(r=0);let a=r,u=0;function d(f,y){let p=ft(Math.atan2(y-n,f-o));p=(p+360)%360,l?(p>=i||p<=s)&&e.pen(e,f,y,c):p>=i&&p<=s&&e.pen(e,f,y,c)}if(r>1)d(a+o,u+n,c),d(-a+o,u+n,c),d(o,a+n,c),d(o,-a+n,c);else if(r===1){d(o+1,n,c),d(o-1,n,c),d(o,n+1,c),d(o,n-1,c),N(e);return}else if(r===0){e.pen(e,o,n,c),N(e);return}let g=1-r;for(;a>u;)u+=1,g<=0?g=g+2*u+1:(a-=1,g=g+2*u-2*a+1),d(a+o,u+n,c),d(-a+o,u+n,c),d(a+o,-u+n,c),d(-a+o,-u+n,c),a!=u&&(d(u+o,a+n,c),d(-u+o,a+n,c),d(u+o,-a+n,c),d(-u+o,-a+n,c));N(e)}W("arc",u0,["x","y","radius","angle1","angle2"]);function u0(e,t){let o=A(t.x,null),n=A(t.y,null),r=A(t.radius,null),i=A(t.angle1,null),s=A(t.angle2,null);if(o===null||n===null||r===null||i===null||s===null){let a=new TypeError("arc: Argument's x, y, radius, angle1, and angle2 must be numbers.");throw a.code="INVALID_PARAMETERS",a}o=o+.5,n=n+.5,r=r-.9,r<0&&(r=0),e.api.render();let l=T(i),c=T(s);e.context.beginPath(),e.context.strokeStyle=e.color.hex,e.context.moveTo(o+Math.cos(l)*r,n+Math.sin(l)*r),e.context.arc(o,n,r,l,c),e.context.stroke()}G("ellipse",d0,["x","y","radiusX","radiusY","fillColor"]);function d0(e,t){let o=m(t.x,null),n=m(t.y,null),r=m(t.radiusX,null),i=m(t.radiusY,null),s=t.fillColor;if(o===null||n===null||r===null||i===null){let p=new TypeError("ellipse: Parameters x, y, radiusX, radiusY must be integers.");throw p.code="INVALID_PARAMETER",p}let l=!1;if(s!==null){if(s=q(e,s),s===null){let p=new TypeError("ellipse: Parameter fillColor must be a valid color format.");throw p.code="INVALID_PARAMETER",p}l=!0}M(e);let c=e.color;if(r===0&&i===0){e.pen(e,Math.floor(o),Math.floor(n),c),N(e);return}if(l){let p=r*r,v=i*i;for(let w=-i;w<=i;w++){let k=n+w;if(k<0||k>=e.height)continue;let O=Math.floor(r*Math.sqrt(1-w*w/v));for(let V=o-O;V<=o+O;V++){if(V<0||V>=e.width)continue;let z=(k*e.width+V)*4,C=e.imageData2;C[z]=s.r,C[z+1]=s.g,C[z+2]=s.b,C[z+3]=s.a}}}let a=0,u=i,d=i*i-r*r*i+.25*r*r,g=2*i*i*a,f=2*r*r*u;for(;g<f;)e.pen(e,Math.floor(a+o),Math.floor(u+n),c),e.pen(e,Math.floor(-a+o),Math.floor(u+n),c),e.pen(e,Math.floor(a+o),Math.floor(-u+n),c),e.pen(e,Math.floor(-a+o),Math.floor(-u+n),c),d<0?(a++,g=g+2*i*i,d=d+g+i*i):(a++,u--,g=g+2*i*i,f=f-2*r*r,d=d+g-f+i*i);let y=i*i*((a+.5)*(a+.5))+r*r*((u-1)*(u-1))-r*r*i*i;for(;u>=0;)e.pen(e,Math.floor(a+o),Math.floor(u+n),c),e.pen(e,Math.floor(-a+o),Math.floor(u+n),c),e.pen(e,Math.floor(a+o),Math.floor(-u+n),c),e.pen(e,Math.floor(-a+o),Math.floor(-u+n),c),y>0?(u--,f=f-2*r*r,y=y+r*r-f):(u--,a++,g=g+2*i*i,f=f-2*r*r,y=y+g-f+r*r);N(e)}W("ellipse",g0,["x","y","radiusX","radiusY","fillColor"]);function g0(e,t){let o=m(t.x,null),n=m(t.y,null),r=m(t.radiusX,null),i=m(t.radiusY,null),s=t.fillColor;if(o===null||n===null||r===null||i===null){let c=new TypeError("ellipse: Parameters x, y, radiusX, radiusY must be integers.");throw c.code="INVALID_PARAMETER",c}let l=!1;if(s!=null){if(s=q(e,s),s===null){let c=new TypeError("ellipse: Parameter fillColor must be a valid color format.");throw c.code="INVALID_PARAMETER",c}l=!0}e.isDirty&&e.api.render(),e.context.beginPath(),e.context.strokeStyle=e.color.hex,e.context.moveTo(o+r,n),e.context.ellipse(o,n,r,i,0,Math.PI*2,!1),l&&(e.context.fillStyle=s.hex,e.context.fill()),e.context.stroke()}h("filterImg",f0,["filter","x1","y1","x2","y2"]);function f0(e,t){let o=t.filter,n=m(t.x1,0),r=m(t.y1,0),i=m(t.x2,e.width-1),s=m(t.y2,e.height-1);if(!B(o)){let c=new TypeError("filterImg: Argument filter must be a callback function.");throw c.code="INVALID_CALLBACK",c}if(n=x(n,0,e.width-1),r=x(r,0,e.height-1),i=x(i,0,e.width-1),s=x(s,0,e.height-1),n>i){let c=n;n=i,i=c}if(r>s){let c=r;r=s,s=c}M(e);let l=e.imageData2;for(let c=r;c<=s;c++)for(let a=n;a<=i;a++){let u=(e.width*c+a)*4,d=o({r:l[u],g:l[u+1],b:l[u+2],a:l[u+3]},a,c);d&&Number.isInteger(d.r)&&Number.isInteger(d.g)&&Number.isInteger(d.b)&&Number.isInteger(d.a)&&(l[u]=x(d.r,0,255),l[u+1]=x(d.g,0,255),l[u+2]=x(d.b,0,255),l[u+3]=x(d.a,0,255))}N(e)}G("bezier",m0,["xStart","yStart","x1","y1","x2","y2","xEnd","yEnd"]);function m0(e,t){let o=Math.round(t.xStart),n=Math.round(t.yStart),r=Math.round(t.x1),i=Math.round(t.y1),s=Math.round(t.x2),l=Math.round(t.y2),c=Math.round(t.xEnd),a=Math.round(t.yEnd);if(isNaN(o)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(s)||isNaN(l)||isNaN(c)||isNaN(a)){let w=new TypeError("bezier: Arguments xStart, yStart, x1, y1, x2, y2, xEnd, and yEnd must be numbers.");throw w.code="INVALID_PARAMETERS",w}let u=e.color;M(e);let d=e.penData.size,g=[{x:o,y:n},{x:r,y:i},{x:s,y:l},{x:c,y:a}],f=zt(0,g);e.pen(e,f.x,f.y,u);let y=.1,p=.1;for(;y<1;){let w=zt(y,g);p0(w,f)>d&&p>1e-5?(y-=p,p=p*.75):(e.pen(e,w.x,w.y,u),f=w),y+=p}let v=zt(1,g);e.pen(e,v.x,v.y,u),N(e)}W("bezier",h0,["xStart","yStart","x1","y1","x2","y2","xEnd","yEnd"]);function h0(e,t){let o=t.xStart+.5,n=t.yStart+.5,r=t.x1+.5,i=t.y1+.5,s=t.x2+.5,l=t.y2+.5,c=t.xEnd+.5,a=t.yEnd+.5;if(isNaN(o)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(s)||isNaN(l)||isNaN(c)||isNaN(a)){let u=new TypeError("bezier: Parameters xStart, yStart, x1, y1, x2, y2, xEnd, and yEnd must be numbers.");throw u.code="INVALID_PARAMETERS",u}e.api.render(),e.context.strokeStyle=e.color.hex,e.context.beginPath(),e.context.moveTo(o,n),e.context.bezierCurveTo(r,i,s,l,c,a),e.context.stroke()}function p0(e,t){let o=e.x-t.x,n=e.y-t.y;return o*o+n*n}function zt(e,t){let o=1-e,n=o*o,r=o*o*o,i=e*e,s=e*e*e;return{x:Math.round(r*t[0].x+3*n*e*t[1].x+3*o*i*t[2].x+s*t[3].x),y:Math.round(r*t[0].y+3*n*e*t[1].y+3*o*i*t[2].y+s*t[3].y)}}function Ro(){b("angle",0)}h("draw",y0,["drawString"]);function y0(e,t){let o=t.drawString;if(typeof o!="string"){let y=new TypeError("draw: drawString must be a string.");throw y.code="INVALID_PARAMETER",y}o=o.toUpperCase();let n=o.match(/(#[A-Z0-9]+)/g);if(n)for(let y=0;y<n.length;y++)o=o.replace("C"+n[y],"O"+y);o=o.replace(/[^CRBFGLATDHUENMPSO0-9#,]/g,""),o=o.replace(/(TA)/gi,"T"),o=o.replace(/(ARC)/gi,"Z");let r=/(?=C|O|R|B|F|G|L|A|T|D|G|H|U|E|N|M|P|S|Z)/,i=o.split(r),s=!1,l={x:e.cursor.x,y:e.cursor.y,angle:e.angle},c=!1,a=!1,u,d,g,f=1;for(let y=0;y<i.length;y++){let p=i[y].split(/(\d+)/);switch(p[0]){case"C":{let v=Number(p[1]);e.api.setColor(v),c=!0;break}case"O":{let v=n[p[1]];e.api.setColor(v),c=!0;break}case"D":{let v=m(p[1],1)*f,w=T(90)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"E":{let v=m(p[1],1)*f;v=Math.sqrt(v*v+v*v);let w=T(315)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"F":{let v=m(p[1],1)*f;v=Math.sqrt(v*v+v*v);let w=T(45)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"G":{let v=m(p[1],1)*f;v=Math.sqrt(v*v+v*v);let w=T(135)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"H":{let v=m(p[1],1)*f;v=Math.sqrt(v*v+v*v);let w=T(225)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"L":{let v=m(p[1],1)*f,w=T(180)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"R":{let v=m(p[1],1)*f,w=T(0)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"U":{let v=m(p[1],1)*f,w=T(270)+e.angle;e.cursor.x+=Math.round(Math.cos(w)*v),e.cursor.y+=Math.round(Math.sin(w)*v);break}case"P":{let v=m(p[1],0),w=m(p[3],null);e.api.paint(e.cursor.x,e.cursor.y,v,1,w),c=!0;break}case"S":{f=m(p[1],4)/4,c=!0;break}case"Z":u=m(p[1],1),d=m(p[3],1),g=m(p[5],1),a=!0;break;case"A":e.angle=T(x(m(p[1],0),0,3)*90),c=!0;break;case"T":e.angle=T(x(m(p[1],0),-360,360)),c=!0;break;case"M":e.cursor.x=m(p[1],1),e.cursor.y=m(p[3],1),c=!0;break;default:c=!0}c||(a?e.api.arc(e.cursor.x,e.cursor.y,u,d,g):e.api.line(l.x,l.y,e.cursor.x,e.cursor.y)),c=!1,a=!1,s&&(s=!1,e.cursor.x=l.x,e.cursor.y=l.y,e.angle=l.angle),p[0]==="N"?s=!0:l={x:e.cursor.x,y:e.cursor.y,angle:e.angle},p[0]==="B"&&(c=!0)}}h("paint",I0,["x","y","fillColor","tolerance","boundaryColor"]);function I0(e,t){let o=m(t.x,null),n=m(t.y,null),r=t.fillColor,i=A(t.tolerance,1),s=t.boundaryColor;if(o===null||n===null){let C=new TypeError("paint: Parameters x and y must be integers");throw C.code="INVALID_PARAMETER",C}if(i<0||i>1){let C=new RangeError("paint: Parameter tolerance must be a number between 0 and 1.");throw C.code="INVALID_PARAMETER",C}if(r=q(e,r),r===null){let C=new RangeError("paint: Parameter fillColor is not a valid color format.");throw C.code="INVALID_PARAMETER",C}M(e);let l=e.imageData2,c=e.width,a=e.height;if(o<0||o>=c||n<0||n>=a)return;let u=(n*c+o)*4,d=l[u],g=l[u+1],f=l[u+2],y=l[u+3];if(d===r.r&&g===r.g&&f===r.b&&y===r.a)return;let p=[.2,.68,.07,.05],v=65025*p.reduce((C,L)=>C+L),w=i*(2-i)*v,k=new Uint8Array(c*a),O=[];O.push({x:o,y:n}),k[n*c+o]=1;let V;if(s!==null){if(s=q(e,s),s===null){let L=new RangeError("paint: Parameter boundaryColor is not a valid color format.");throw L.code="INVALID_PARAMETER",L}let C={r:s.r,g:s.g,b:s.b,a:s.a};V=L=>{let te=ue(C,L,p);return v-te>=w}}else{let C={r:d,g,b:f,a:y};V=L=>{let te=ue(C,L,p);return v-te<w}}let z=0;for(;z<O.length;){let C=O[z++],L=C.x,te=C.y,ve=(te*c+L)*4,rn={r:l[ve],g:l[ve+1],b:l[ve+2],a:l[ve+3]};V(rn)||(e.blend(e,C.x,C.y,r),ct(O,k,L+1,te,c,a),ct(O,k,L-1,te,c,a),ct(O,k,L,te+1,c,a),ct(O,k,L,te-1,c,a))}N(e)}function ct(e,t,o,n,r,i){if(o<0||o>=r||n<0||n>=i)return;let s=n*r+o;t[s]===0&&(t[s]=1,e.push({x:o,y:n}))}var _={},be=0;I("loadImage",_o,["src","name","onLoad","onError"]);function _o(e){let t=e.src,o=e.name,n=e.onLoad,r=e.onError,i="loadImage: Parameter src must be a string URL, Image element, or Canvas element.";if(typeof t=="string"){if(t===""){let l=new TypeError(i);throw l.code="INVALID_SRC",l}}else if(t&&typeof t=="object"){if(t.tagName!=="IMG"&&t.tagName!=="CANVAS"){let l=new TypeError(i);throw l.code="INVALID_SRC",l}}else{let l=new TypeError(i);throw l.code="INVALID_SRC",l}if(o&&typeof o!="string"){let l=new TypeError("loadImage: Parameter name must be a string.");throw l.code="INVALID_NAME",l}if((!o||o==="")&&(be+=1,o=""+be),_[o]){let l=new TypeError("loadImage: Parameter name must be unique.");throw l.code="INVALID_NAME",l}if(n!=null&&!B(n)){let l=new TypeError("loadImage: Parameter onLoad must be a function.");throw l.code="INVALID_CALLBACK",l}if(r!=null&&!B(r)){let l=new TypeError("loadImage: Parameter onError must be a function.");throw l.code="INVALID_CALLBACK",l}let s;return typeof t!="string"?(s=t,_[o]={status:"ready",type:"image",image:s,width:s.width,height:s.height},n&&n(s),o):(_[o]={status:"loading"},s=new Image,we(),s.onload=function(){_[o]={status:"ready",type:"image",image:s,width:s.width,height:s.height},n&&n(s),Q()},s.onerror=function(l){_[o]={status:"error",error:l},r&&r(l),Q()},s.src=t,o)}I("loadSpritesheet",A0,["src","name","width","height","margin"]);function A0(e){let t=e.src,o=e.name,n=e.width,r=e.height,i=e.margin,s=!1;if(i==null&&(i=0),n==null&&r==null?(s=!0,n=0,r=0,i=0):(n=Math.round(n),r=Math.round(r),i=Math.round(i)),!s&&(!Number.isInteger(n)||!Number.isInteger(r))){let l=new TypeError("loadSpriteSheet: width and height must be integers.");throw l.code="INVALID_DIMENSIONS",l}if(!s&&(n<1||r<1)){let l=new RangeError("loadSpriteSheet: width and height must be greater than 0.");throw l.code="INVALID_DIMENSIONS",l}if(!Number.isInteger(i)){let l=new TypeError("loadSpriteSheet: margin must be an integer.");throw l.code="INVALID_MARGIN",l}return(!o||o==="")&&(be+=1,o=""+be),_o({src:t,name:o,onLoad:function(){let l=_[o];l.type="spritesheet",l.spriteWidth=n,l.spriteHeight=r,l.margin=i,l.frames=[],l.isAuto=s;let c=l.image.width,a=l.image.height;s?k0(l,c,a):T0(l,c,a)}}),o}I("removeImage",x0,["name"]);function x0(e){let t=e.name;if(typeof t!="string"){let o=new TypeError("removeImage: name must be a string.");throw o.code="INVALID_NAME",o}delete _[t]}h("getImage",b0,["name","x1","y1","x2","y2"]);function b0(e,t){let o=t.name,n=Math.round(t.x1),r=Math.round(t.y1),i=Math.round(t.x2),s=Math.round(t.y2);if(isNaN(n)||isNaN(r)||isNaN(i)||isNaN(s)){let d=new TypeError("getImage: parameters x1, x2, y1, y2 must be integers.");throw d.code="INVALID_COORDINATES",d}if(!o||o==="")be+=1,o=""+be;else if(typeof o!="string"){let d=new TypeError("getImage: name must be a string.");throw d.code="INVALID_NAME",d}else if(_[o]){let d=new Error(`getImage: name "${o}" is already used; name must be unique.`);throw d.code="DUPLICATE_NAME",d}let l=document.createElement("canvas"),c=l.getContext("2d"),a=Math.abs(n-i),u=Math.abs(r-s);return l.width=a,l.height=u,e.api.render(),c.drawImage(e.canvas,n,r,a,u,0,0,a,u),_[o]={status:"ready",image:l,type:"image",width:a,height:u},o}h("getSpritesheetData",C0,["name"]);function C0(e,t){let o=t.name;if(!_[o]){let i=new Error("getSpritesheetData: invalid sprite name");throw i.code="INVALID_NAME",i}let n=_[o];if(n.type!=="spritesheet"){let i=new Error("getSpritesheetData: image is not a spritesheet");throw i.code="NOT_A_SPRITESHEET",i}let r={frameCount:n.frames.length,frames:[]};for(let i=0;i<n.frames.length;i++)r.frames.push({index:i,x:n.frames[i].x,y:n.frames[i].y,width:n.frames[i].width,height:n.frames[i].height,left:n.frames[i].x,top:n.frames[i].y,right:n.frames[i].right,bottom:n.frames[i].bottom});return r}h("drawImage",M0,["name","x","y","angle","anchorX","anchorY","alpha","scaleX","scaleY"]);function M0(e,t){let o=t.name,n=t.x||0,r=t.y||0,i=t.angle,s=t.anchorX,l=t.anchorY,c=t.alpha,a=t.scaleX,u=t.scaleY,d;if(typeof o=="string"){if(!_[o]){let f=new Error(`drawImage: Image "${o}" not found.`);throw f.code="IMAGE_NOT_FOUND",f}let g=_[o];if(g.status==="loading"){let f=new Error(`drawImage: Image "${o}" is still loading. Use $.ready() to wait for it.`);throw f.code="IMAGE_NOT_READY",f}if(g.status==="error"){let f=new Error(`drawImage: Image "${o}" failed to load.`);throw f.code="IMAGE_LOAD_FAILED",f}d=g.image}else if(o&&typeof o=="object")if(o.screen===!0){if(d=o.canvas(),!d){let g=new Error("drawImage: Screen has no canvas.");throw g.code="INVALID_SCREEN",g}}else if(o.tagName==="CANVAS"||o.tagName==="IMG")d=o;else{let g=new TypeError("drawImage: Parameter name must be a string, screen object, Canvas element, or Image element.");throw g.code="INVALID_NAME",g}else{let g=new TypeError("drawImage: Parameter name must be a string, screen object, Canvas element, or Image element.");throw g.code="INVALID_NAME",g}if(isNaN(n)||isNaN(r)){let g=new TypeError("drawImage: parameters x and y must be numbers");throw g.code="INVALID_COORDINATES",g}Vo(e,d,n,r,i,s,l,c,null,a,u)}h("drawSprite",N0,["name","frame","x","y","angle","anchorX","anchorY","alpha","scaleX","scaleY"]);function N0(e,t){let o=t.name,n=t.frame||0,r=t.x||0,i=t.y||0,s=t.angle,l=t.anchorX,c=t.anchorY,a=t.alpha,u=t.scaleX,d=t.scaleY;if(!_[o]){let p=new Error("drawSprite: invalid sprite name");throw p.code="INVALID_NAME",p}let g=_[o];if(g.type!=="spritesheet"){let p=new Error("drawSprite: image is not a spritesheet");throw p.code="NOT_A_SPRITESHEET",p}if(!Number.isInteger(n)||n>=g.frames.length||n<0){let p=new RangeError("drawSprite: frame number is not valid");throw p.code="INVALID_FRAME",p}if(isNaN(r)||isNaN(i)){let p=new TypeError("drawSprite: parameters x and y must be numbers");throw p.code="INVALID_COORDINATES",p}let f=g.image,y=g.frames[n];Vo(e,f,r,i,s,l,c,a,y,u,d)}function Vo(e,t,o,n,r,i,s,l,c,a,u){(a==null||isNaN(Number(a)))&&(a=1),(u==null||isNaN(Number(u)))&&(u=1),r==null&&(r=0),r=T(r),i||(i=0),s||(s=0),!l&&l!==0&&(l=255),c?(i=Math.round(c.width*i),s=Math.round(c.height*s)):(i=Math.round(t.width*i),s=Math.round(t.height*s));let d=e.context,g=d.globalAlpha;d.globalAlpha=l/255,e.api.render(),d.translate(o,n),d.rotate(r),d.scale(a,u),c==null?d.drawImage(t,-i,-s):d.drawImage(t,c.x,c.y,c.width,c.height,-i,-s,c.width,c.height),d.scale(1/a,1/u),d.rotate(-r),d.translate(-o,-n),d.globalAlpha=g}function T0(e,t,o){let n=e.margin,r=e.margin,i=n+e.spriteWidth,s=r+e.spriteHeight;for(;s<=o-e.margin;){for(;i<=t-e.margin;)e.frames.push({x:n,y:r,width:e.spriteWidth,height:e.spriteHeight,right:n+e.spriteWidth-1,bottom:r+e.spriteHeight-1}),n+=e.spriteWidth+e.margin,i=n+e.spriteWidth;n=e.margin,i=n+e.spriteWidth,r+=e.spriteHeight+e.margin,s=r+e.spriteHeight}}function k0(e,t,o){let n=document.createElement("canvas");n.width=t,n.height=o;let r=n.getContext("2d",{willReadFrequently:!0});r.drawImage(e.image,0,0);let i=r.getImageData(0,0,t,o).data,s=new Uint8Array(t*o),l=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];for(let c=3;c<i.length;c+=4)if(i[c]>0){let a=(c-3)/4,u=a%t,d=Math.floor(a/t),g=d*t+u;if(s[g])continue;let f={x:t,y:o,width:0,height:0,right:0,bottom:0},y=[];y.push({x:u,y:d}),s[g]=1;let p=0;for(;p<y.length;){let v=y[p++],w=v.x,k=v.y;f.x=Math.min(f.x,w),f.y=Math.min(f.y,k),f.right=Math.max(f.right,w),f.bottom=Math.max(f.bottom,k);for(let O of l){let V=w+O[0],z=k+O[1];if(V<0||V>=t||z<0||z>=o)continue;let C=z*t+V;if(s[C])continue;let L=C*4;i[L+3]>0&&(s[C]=1,y.push({x:V,y:z}))}}f.width=f.right-f.x+1,f.height=f.bottom-f.y+1,f.width+f.height>4&&e.frames.push(f)}}var Z=[],qo={},zo=null,Oo=0,Bo=0;function Go(){oe("font",()=>zo)}function Wo(e){return qo[e]}I("loadFont",P0,["fontSrc","width","height","charSet","isEncoded"]);function P0(e){let t=e.fontSrc,o=Math.round(e.width),n=Math.round(e.height),r=e.charSet,i=!!e.isEncoded;if(isNaN(o)||isNaN(n)){let c=new TypeError("loadFont: width and height must be integers.");throw c.code="INVALID_DIMENSIONS",c}if(!r){r=[];for(let c=0;c<256;c+=1)r.push(c)}if(!(Array.isArray(r)||typeof r=="string")){let c=new TypeError("loadFont: charSet must be an array or a string.");throw c.code="INVALID_CHARSET",c}if(typeof r=="string"){let c=[];for(let a=0;a<r.length;a+=1)c.push(r.charCodeAt(a));r=c}let s={};for(let c=0;c<r.length;c+=1)s[r[c]]=c;let l={id:Oo,width:o,height:n,data:[],chars:s,charSet:r,mode:i?"pixel":"bitmap",bitmapId:null};return Z[l.id]=l,Oo+=1,i?l.data=V0(t,o,n):O0(t,l),l.id}I("setDefaultFont",j0,["fontId"]);function j0(e){let t=parseInt(e.fontId);if(isNaN(t)||t<0||!Z[t]){let o=new RangeError("setDefaultFont: invalid fontId");throw o.code="INVALID_FONT_ID",o}zo=Z[t]}h("setFont",L0,["font"]);function L0(e,t){let o=t.font,n;if(typeof o=="string")e.context.font=o,e.context.textBaseline="top",n={name:e.context.font,width:10,height:10,mode:"canvas"};else if(Z[o])n=Z[o];else{let r=new RangeError("setFont: invalid fontId");throw r.code="INVALID_FONT_ID",r}e.font=n,Uo(e)}h("setFontSize",S0,["width","height"]);function S0(e,t){if(e.font.mode!=="bitmap"){let r=new RangeError("setFontSize: only bitmap fonts can change sizes. Load a bitmap font before setting the font size.");throw r.code="INVALID_SIZE",r}let o=m(t.width,null),n=m(t.height,null);if(!o||o<1||!n||n<1){let r=new RangeError("setFontSize: width and height must be an integer greater than 0");throw r.code="INVALID_SIZE",r}e.font.width=o,e.font.height=n,Uo(e)}I("getAvailableFonts",R0,[]);function R0(){let e=[];for(let t=0;t<Z.length;t++)Z[t]&&e.push({id:Z[t].id,width:Z[t].width,height:Z[t].height,mode:Z[t].mode});return e}h("setChar",_0,["charCode","data"]);function _0(e,t){let o=t.charCode,n=t.data;if(typeof o=="string")o=o.charCodeAt(0);else if(o=m(o,null),o===null){let s=new TypeError("setChar: charCode must be an integer or a string");throw s.code="INVALID_CHAR_CODE",s}let r=e.font;if(!Array.isArray(n))if(typeof n=="string")n=dt(n,r.width,r.height);else{let s=new TypeError("setChar: data must be a 2D array or an encode string");throw s.code="INVALID_DATA",s}if(n.length!==r.height){let s=new RangeError(`setChar: data height (${n.length}) must match font height (${r.height})`);throw s.code="INVALID_DATA_HEIGHT",s}for(let s=0;s<n.length;s++)if(!Array.isArray(n[s])||n[s].length!==r.width){let l=new RangeError(`setChar: data width at row ${s} must match font width (${r.width})`);throw l.code="INVALID_DATA_WIDTH",l}let i=r.chars[o];if(i===void 0){let s=new RangeError("setChar: character not in font character set");throw s.code="CHAR_NOT_IN_FONT",s}r.data[i]=n}function Uo(e){if(e.font.mode==="canvas"){let o=Math.round(e.context.measureText("M").width*2),n=document.createElement("canvas");n.width=o,n.height=o;let r=n.getContext("2d",{willReadFrequently:!0});r.font=e.context.font,r.textBaseline="top",r.fillStyle="#FF0000";let i="WHMGLIyzjpgl_|,.";for(let d of i)r.fillText(d,0,0);let s=1/0,l=0,c=1/0,a=0,u=r.getImageData(0,0,o,o).data;for(let d=0;d<o;d++)for(let g=0;g<o;g++){let f=(d*o+g)*4;u[f]===255&&(s=Math.min(g,s),l=Math.max(g,l),c=Math.min(d,c),a=Math.max(d,a))}e.font.width=l-s,e.font.height=a-c}e.printCursor.cols=Math.floor(e.width/e.font.width),e.printCursor.rows=Math.floor(e.height/e.font.height)}function V0(e,t,o){let i="",s=[];e=""+e;let l=e.split(",");for(let a=0;a<l.length;a++){let u=parseInt(l[a],32).toString(2);for(;u.length<32;)u="0"+u;i+=u}let c=0;if(i.length%32>0)return console.warn("loadFont: Invalid font data."),s;for(;c<i.length;){s.push([]);let a=s.length-1;for(let u=0;u<o;u+=1){s[a].push([]);for(let d=0;d<t;d+=1){let g;c>=i.length?g=0:(g=parseInt(i[c]),isNaN(g)&&(g=0)),s[a][u].push(g),c+=1}}}return s}function O0(e,t){let o,n={image:null,width:t.width,height:t.height};if(typeof e=="string")o=new Image,we(),o.onload=function(){n.image=o,Q()},o.onerror=function(r){console.warn("loadFont: unable to load image for font."),Q()},o.src=e;else if(e instanceof HTMLImageElement)n.image=e;else{let r=new TypeError("loadFont: fontSrc must be a string or Image element.");throw r.code="INVALID_FONT_SRC",r}t.bitmapId=Bo,Bo+=1,qo[t.bitmapId]=n}function Yo(){b("printCursor",{x:0,y:0,cols:0,rows:0,breakWord:!0})}h("print",B0,["msg","isInline","isCentered"]);function B0(e,t){let o=t.msg,n=!!t.isInline,r=!!t.isCentered;if(e.font.height>e.height)return;o==null?o="":typeof o!="string"&&(o=""+o),o=o.replace(/\t/g,"    ");let i=o.split(/\n/);for(let s=0;s<i.length;s++)Gt(e,i[s],n,r)}h("setPos",q0,["col","row"]);function q0(e,t){let o=t.col,n=t.row;if(o!=null){if(isNaN(o)){let i=new TypeError("setPos: parameter col must be a number");throw i.code="INVALID_COL",i}let r=Math.floor(o*e.font.width);r>e.width&&(r=e.width-e.font.width),e.printCursor.x=r}if(n!=null){if(isNaN(n)){let i=new TypeError("setPos: parameter row must be a number");throw i.code="INVALID_ROW",i}let r=Math.floor(n*e.font.height);r>e.height&&(r=e.height-e.font.height),e.printCursor.y=r}}h("setPosPx",z0,["x","y"]);function z0(e,t){let o=t.x,n=t.y;if(o!=null){if(isNaN(o)){let r=new TypeError("setPosPx: parameter x must be a number");throw r.code="INVALID_X",r}e.printCursor.x=Math.round(o)}if(n!=null){if(isNaN(n)){let r=new TypeError("setPosPx: parameter y must be a number");throw r.code="INVALID_Y",r}e.printCursor.y=Math.round(n)}}h("getPos",G0,[]);function G0(e){return{col:Math.floor(e.printCursor.x/e.font.width),row:Math.floor(e.printCursor.y/e.font.height)}}h("getPosPx",W0,[]);function W0(e){return{x:e.printCursor.x,y:e.printCursor.y}}h("getCols",U0,[]);function U0(e){return e.printCursor.cols}h("getRows",K0,[]);function K0(e){return e.printCursor.rows}h("setWordBreak",Y0,["isEnabled"]);function Y0(e,t){e.printCursor.breakWord=!!t.isEnabled}h("piCalcWidth",$0,["msg"]);function $0(e,t){let o=t.msg||"";return e.font.width*o.length}h("canvasCalcWidth",X0,["msg"]);function X0(e,t){let o=t.msg||"";return e.context.measureText(o).width}function Gt(e,t,o,n){let r=e.printCursor,i=e.font,s=Z0(e,t);if(n&&(r.x=Math.floor((r.cols-t.length)/2)*i.width),!o&&!n&&s+r.x>e.width&&t.length>1){let l=s+r.x-e.width,a=(s-l)/s,u=Math.floor(t.length*a),d=t.substring(0,u),g=t.substring(u,t.length);if(r.breakWord){let f=d.lastIndexOf(" ");f>-1&&(g=d.substring(f).trim()+g,d=d.substring(0,f))}Gt(e,d,o,n),Gt(e,g,o,n);return}r.y+i.height>e.height&&(i.mode==="canvas"&&e.api.render(),H0(e,i.height),r.y-=i.height),i.mode==="pixel"?Q0(e,t,r.x,r.y):i.mode==="bitmap"?D0(e,t,r.x,r.y):i.mode==="canvas"&&J0(e,t,r.x,r.y),o?(r.x+=i.width*t.length,r.x>e.width-i.width&&(r.x=0,r.y+=i.height)):(r.y+=i.height,r.x=0)}function H0(e,t){if(!(t<=0)){M(e);for(let o=t;o<e.height;o++)for(let n=0;n<e.width;n++){let r=(e.width*o+n)*4,i=(e.width*(o-t)+n)*4,s=e.imageData2;s[i]=s[r],s[i+1]=s[r+1],s[i+2]=s[r+2],s[i+3]=s[r+3]}for(let o=e.height-t;o<e.height;o++)for(let n=0;n<e.width;n++){let r=(e.width*o+n)*4;e.imageData2[r]=0,e.imageData2[r+1]=0,e.imageData2[r+2]=0,e.imageData2[r+3]=0}N(e)}}function Z0(e,t){let o=e.font;return o.mode==="canvas"?e.context.measureText(t).width:o.width*t.length}function Q0(e,t,o,n){let r=e.font,i=e.pal;e.pal=[e.pal[0],e.color];for(let s=0;s<t.length;s++){let l=r.chars[t.charCodeAt(s)];l!==void 0&&e.api.put(r.data[l],o+r.width*s,n)}e.pal=i}function J0(e,t,o,n){e.api.render(),e.context.fillText(t,o,n),e.imageData=null}function D0(e,t,o,n){e.api.render();let r=e.font,i=Wo(r.bitmapId);if(!i){let u=new TypeError("print: font bitmap not found");throw u.code="FONT_BITMAP_NOT_FOUND",u}let s=i.image.width,l=i.width,c=i.height,a=Math.floor(s/l);for(let u=0;u<t.length;u++){let d=r.chars[t.charCodeAt(u)];if(d!==void 0){let g=d%a*l,f=Math.floor(d/a)*c,y=o+r.width*u;e.context.drawImage(i.image,g,f,l,c,y,n,r.width,r.height)}}e.imageData=null}var Wt=null,R={},$o=0,ee={},Xo=0,lt=.75;function Ut(e){ee[e]&&ee[e].oscillator.stop(0)}function Kt(e,t,o,n,r,i,s,l,c,a){let u=e.createOscillator(),d=e.createGain(),g=e.createGain();if(g.gain.value=lt,u.frequency.value=t,l==="custom"){let p=c[0],v=c[1],w=e.createPeriodicWave(p,v);u.setPeriodicWave(w)}else u.type=l;n===0?d.gain.value=o:d.gain.value=0,u.connect(d),d.connect(g),g.connect(e.destination);let f=e.currentTime+a;n>0&&d.gain.setValueCurveAtTime(new Float32Array([0,o]),f,n),r>0&&d.gain.setValueCurveAtTime(new Float32Array([o,.8*o]),f+n,r),i>0&&d.gain.setValueCurveAtTime(new Float32Array([.8*o,.1*o,0]),f+n+r,i),u.start(f),u.stop(f+s);let y="sound_"+Xo;return Xo+=1,ee[y]={oscillator:u,master:g,audioContext:e},setTimeout(()=>{delete ee[y]},(f+s)*1e3),y}I("createAudioPool",ti,["src","poolSize"]);function ti(e){let t=e.src,o=m(e.poolSize,1);if(!t||typeof t!="string"){let i=new TypeError("createAudioPool: Parameter src must be a non-empty string.");throw i.code="INVALID_SRC",i}if(o<1){let i=new RangeError("createAudioPool: Parameter poolSize must be an integer greater than 0.");throw i.code="INVALID_POOL_SIZE",i}let n={pool:[],index:0};for(let i=0;i<o;i++){let s=new Audio(t);Ho(n,s)}let r="audioPool_"+$o;return R[r]=n,$o+=1,r}I("deleteAudioPool",oi,["audioId"]);function oi(e){let t=e.audioId;if(!R[t]){let o=new Error(`deleteAudioPool: Audio pool "${t}" not found.`);throw o.code="AUDIO_POOL_NOT_FOUND",o}for(let o=0;o<R[t].pool.length;o++){let n=R[t].pool[o];n.audio.pause(),clearTimeout(n.timeout)}delete R[t]}I("playAudioPool",ni,["audioId","volume","startTime","duration"]);function ni(e){let t=e.audioId,o=A(e.volume,1),n=A(e.startTime,0),r=A(e.duration,0);if(!R[t]){let c=new Error(`playAudioPool: Audio pool "${t}" not found.`);throw c.code="AUDIO_POOL_NOT_FOUND",c}if(o<0||o>1){let c=new RangeError("playAudioPool: Parameter volume must be a number between 0 and 1.");throw c.code="INVALID_VOLUME",c}if(n<0){let c=new RangeError("playAudioPool: Parameter startTime must be a number greater than or equal to 0.");throw c.code="INVALID_START_TIME",c}if(r<0){let c=new RangeError("playAudioPool: Parameter duration must be a number greater than or equal to 0.");throw c.code="INVALID_DURATION",c}let i=R[t];if(i.pool.length===0){let c=new Error("playAudioPool: Audio pool has no sounds loaded.");throw c.code="EMPTY_POOL",c}let s=i.pool[i.index],l=s.audio;l.volume=lt*o,s.volume=o,l.currentTime=n,r>0&&(clearTimeout(s.timeout),s.timeout=setTimeout(()=>{l.pause(),l.currentTime=0},r*1e3)),l.play(),i.index+=1,i.index>=i.pool.length&&(i.index=0)}I("stopAudioPool",ri,["audioId"]);function ri(e){let t=e.audioId;if(t==null){for(let o in R)for(let n=0;n<R[o].pool.length;n++){let r=R[o].pool[n];r.audio.pause(),clearTimeout(r.timeout)}return}if(!R[t]){let o=new Error(`stopAudioPool: Audio pool "${t}" not found.`);throw o.code="AUDIO_POOL_NOT_FOUND",o}for(let o=0;o<R[t].pool.length;o++){let n=R[t].pool[o];n.audio.pause(),clearTimeout(n.timeout)}}I("sound",ii,["frequency","duration","volume","oType","delay","attack","decay"]);function ii(e){let t=Math.round(A(e.frequency,440)),o=A(e.duration,1),n=A(e.volume,1),r=e.oType!=null?e.oType:"triangle",i=A(e.delay,0),s=A(e.attack,0),l=A(e.decay,.1);if(o<0){let u=new RangeError("sound: Parameter duration must be a number greater than or equal to 0.");throw u.code="INVALID_DURATION",u}if(n<0||n>1){let u=new RangeError("sound: Parameter volume must be a number between 0 and 1.");throw u.code="INVALID_VOLUME",u}if(s<0){let u=new RangeError("sound: Parameter attack must be a number greater than or equal to 0.");throw u.code="INVALID_ATTACK",u}if(i<0){let u=new RangeError("sound: Parameter delay must be a number greater than or equal to 0.");throw u.code="INVALID_DELAY",u}let c=null;if(Array.isArray(r)){if(r.length!==2||r[0].length===0||r[1].length===0||r[0].length!==r[1].length){let u=new TypeError("sound: Parameter oType array must contain two non-empty arrays of equal length.");throw u.code="INVALID_WAVE_TABLE",u}c=[];for(let u=0;u<r.length;u++){for(let d=0;d<r[u].length;d++)if(isNaN(r[u][d])){let g=new TypeError("sound: Parameter oType array must only contain numbers.");throw g.code="INVALID_WAVE_TABLE_VALUE",g}c.push(new Float32Array(r[u]))}r="custom"}else if(typeof r!="string"){let u=new TypeError("sound: Parameter oType must be a string or an array.");throw u.code="INVALID_OTYPE",u}else if(["triangle","sine","square","sawtooth"].indexOf(r)===-1){let d=new Error("sound: Parameter oType must be one of: triangle, sine, square, sawtooth.");throw d.code="INVALID_OTYPE",d}if(!Wt){let u=window.AudioContext||window.webkitAudioContext;Wt=new u}let a=s+o+l;return Kt(Wt,t,n,s,o,l,a,r,c,i)}I("stopSound",si,["soundId"]);function si(e){let t=e.soundId;if(t==null){for(let o in ee)ee[o].oscillator.stop(0);return}ee[t]&&ee[t].oscillator.stop(0)}I("setVolume",ci,["volume"]);function ci(e){let t=A(e.volume,.75);if(t<0||t>1){let o=new RangeError("setVolume: Parameter volume must be a number between 0 and 1.");throw o.code="INVALID_VOLUME",o}lt=t;for(let o in ee){let n=ee[o];t===0?(n.master.gain.exponentialRampToValueAtTime(.01,n.audioContext.currentTime+.1),n.master.gain.setValueAtTime(0,n.audioContext.currentTime+.11)):n.master.gain.exponentialRampToValueAtTime(t,n.audioContext.currentTime+.1)}for(let o in R)for(let n=0;n<R[o].pool.length;n++){let r=R[o].pool[n];r.audio.volume=lt*r.volume}}function Ho(e,t,o=3){function n(){e.pool.push({audio:t,timeout:0,volume:1}),t.removeEventListener("canplay",n),Q()}function r(){let i=["MEDIA_ERR_ABORTED - fetching process aborted by user","MEDIA_ERR_NETWORK - error occurred when downloading","MEDIA_ERR_DECODE - error occurred when decoding","MEDIA_ERR_SRC_NOT_SUPPORTED - audio/video not supported"],s=t.error.code,l=s-1;l>=0&&l<i.length?(console.error("createAudioPool: "+i[l]),o>0?setTimeout(()=>{t.removeEventListener("canplay",n),t.removeEventListener("error",r);let c=new Audio(t.src);Ho(e,c,o-1)},100):(console.error("createAudioPool: Max retries exceeded for "+t.src),Q())):(console.error("createAudioPool: Unknown error - "+s),Q())}o===3&&we(),t.addEventListener("canplay",n),t.addEventListener("error",r)}var P={},se=[],Zo=0,Se=[],Ce={A:[27.5,55,110,220,440,880,1760,3520,7040,14080],"A#":[29.14,58.27,116.541,233.082,466.164,932.328,1864.655,3729.31,7458.62,14917.24],B:[30.87,61.74,123.471,246.942,493.883,987.767,1975.533,3951.066,7902.132,15804.264],C:[16.35,32.7,65.41,130.813,261.626,523.251,1046.502,2093.005,4186.009,8372.018],"C#":[17.32,34.65,69.296,138.591,277.183,554.365,1108.731,2217.461,4434.922,8869.844],D:[18.35,36.71,73.416,146.832,293.665,587.33,1174.659,2349.318,4698.636,9397.272],"D#":[19.45,38.89,77.782,155.563,311.127,622.254,1244.508,2489.016,4978.032,9956.064],E:[20.6,41.2,82.407,164.814,329.628,659.255,1318.51,2637.021,5274.042,10548.084],F:[21.83,43.65,87.307,174.614,349.228,698.456,1396.913,2793.826,5587.652,11175.304],"F#":[23.12,46.25,92.499,184.997,369.994,739.989,1479.978,2959.955,5919.91,11839.82],G:[24.5,49,97.999,195.998,391.995,783.991,1567.982,3135.964,6271.928,12543.856],"G#":[25.96,51.91,103.826,207.652,415.305,830.609,1661.219,3322.438,6644.876,13289.752]},Qo=[0,16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87,32.7,34.65,36.71,38.89,41.2,43.65,46.25,49,51.91,55,58.27,61.74,65.406,69.296,73.416,77.782,82.407,87.307,92.499,97.999,103.826,110,116.541,123.471,130.813,138.591,146.832,155.563,164.814,174.614,184.997,195.998,207.652,220,233.082,246.942,261.626,277.183,293.665,311.127,329.628,349.228,369.994,391.995,415.305,440,466.164,493.883,523.251,554.365,587.33,622.254,659.255,698.456,739.989,783.991,830.609,880,932.328,987.767,1046.502,1108.731,1174.659,1244.508,1318.51,1396.913,1479.978,1567.982,1661.219,1760,1864.655,1975.533,2093.005,2217.461,2349.318,2489.016,2637.021,2793.826,2959.955,3135.964,3322.438,3520,3729.31,3951.066,4186.009,4434.922,4698.636,4978.032,5274.042,5587.652,5919.91,6271.928,6644.876,7040,7458.62,7902.132,8372.018,8869.844,9397.272,9956.064,10548.084,11175.304,11839.82,13289.752,14080,14917.24,15804.264];I("play",ai,["playString"]);function ai(e){let t=e.playString;if(typeof t!="string"){let i=new TypeError("play: Parameter playString must be a string.");throw i.code="INVALID_PLAY_STRING",i}let o=di(t);Se=[],Yt(o),Se.sort((i,s)=>i.time-s.time);let n=window.AudioContext||window.webkitAudioContext,r=new n;for(let i=0;i<Se.length;i++){let s=Se[i];s.track.sounds.push(Kt(r,s.frequency,s.volume,s.attackTime,s.sustainTime,s.decayTime,s.stopTime,s.oType,s.waveTables,s.time))}}I("stopPlay",ui,["trackId"]);function ui(e){let t=e.trackId;if(t===null){for(let o=0;o<se.length;o++){let n=P[se[o]];if(n){for(let r=0;r<n.sounds.length;r++)Ut(n.sounds[r]);delete P[se[o]]}}se.length=0;return}if(P[t]){let o=P[t];for(let n=0;n<o.sounds.length;n++)Ut(o.sounds[n]);Jo(t)}}function di(e){let t;e=e.split(/\s+/).join("").toUpperCase();let o=[],n=0;for(;n>-1;)if(n=e.indexOf("[["),n>-1){let a=e.indexOf("]]",n);o.push(e.substring(n,a+2));let u=o.length-1;e=e.replace(o[u],"W"+u)}for(let a=0;a<o.length;a++){if(o[a]=JSON.parse(o[a]),o[a].length!==2||o[a][0].length!==o[a][1].length){console.error("play: Wavetables must have 2 arrays of same length. Defaulting to triangle wave."),o[a]="triangle";continue}for(let u=0;u<2;u++){for(let d=0;d<o[a][u].length;d++)o[a][u][d]=parseFloat(o[a][u][d]),isNaN(o[a][u][d])&&(o[a][u][d]=0);o[a][u]=new Float32Array(o[a][u])}}let r=e.split(","),i=[],s="(?=WS|WQ|WW|WT|W\\d[\\d]?|V\\d|Q\\d|O\\d|\\<|\\>|N\\d\\d?|L\\d\\d?|MS|MN|ML|MU\\d|MU\\-\\d|MK\\d[\\d]?[\\d]?|MZ\\d[\\d]?[\\d]?|MX\\d[\\d]?[\\d]?|MY\\d[\\d]?[\\d]?|MW|P[\\d]?|T\\d|[[A|B|C|D|E|F|G][\\d]?[\\+|\\-|\\#|\\.\\.?]?)",l=new RegExp(s),c;for(let a=0;a<r.length;a++){r[a]=r[a].replace(/SINE/g,"WS"),r[a]=r[a].replace(/SQUARE/g,"WQ"),r[a]=r[a].replace(/SAWTOOTH/g,"WW"),r[a]=r[a].replace(/TRIANGLE/g,"WT"),r[a]=r[a].replace(/MD/g,"MZ"),r[a]=r[a].replace(/MA/g,"MY"),r[a]=r[a].replace(/MT/g,"MX"),r[a]=r[a].replace(/MO/g,"MU"),r[a]=r[a].replace(/MB/g,""),r[a]=r[a].replace(/MF/g,"");let u=Zo;t===void 0&&(t=u),Zo+=1,P[u]={id:u,notes:[],noteId:0,decayRate:.2,attackRate:.15,sustainRate:.65,fullNote:!1,extra:1,space:"normal",interval:0,time:0,simultaneousPlay:a>0,tempo:60/120,noteLength:.25,pace:.875,octave:4,octaveExtra:0,volume:1,trackIds:i,type:"triangle",waveTables:o,sounds:[]},se.push(u),i.push(u),a>0&&(c.simultaneousPlay=u);let d=r[a].split(l);for(let g=0;g<d.length;g++){let f=d[g].indexOf("-");if(f>-1&&"ABCDEFG".indexOf(d[g][0])===-1){let y={name:d[g].substring(0,f),val:d[g].substring(f)};P[u].notes.push(y),c=y}else{let y=d[g].split(/(\d+)/),p={name:y[0]};y.length>1&&(p.val=y[1]),P[u].notes.push(p),c=p}}}return t}function Yt(e){let t=P[e];if(t.noteId>=t.notes.length)return;let o=t.notes[t.noteId],n=0,r,i=!1;switch(t.extra=0,o.name.charAt(0)){case"A":case"B":case"C":case"D":case"E":case"F":case"G":n=gi(t,o),i=!0;break;case"N":isNaN(Number(o.val))||(r=m(o.val,0),r>=0&&r<Qo.length&&(n=Qo[r]),i=!0);break;case"O":isNaN(Number(o.val))||(r=m(o.val,4),r>=0&&r<Ce.A.length&&(t.octave=r));break;case">":t.octave+=1,t.octave>=Ce.A.length&&(t.octave=Ce.A.length-1);break;case"<":t.octave-=1,t.octave<0&&(t.octave=0);break;case"L":isNaN(Number(o.val))||(r=m(o.val,1),t.noteLength=$t(r));break;case"T":isNaN(Number(o.val))||(r=m(o.val,120),r>=32&&r<256&&(t.tempo=60/r));break;case"M":fi(t,o);break;case"P":isNaN(Number(o.val))||(i=!0,r=m(o.val,1),t.extra=$t(r));break;case"V":isNaN(Number(o.val))||(r=m(o.val,50),r<0?r=0:r>100&&(r=100),t.volume=r/100);break;case"W":mi(t,o);break}t.extra>0?t.interval=t.tempo*t.extra*t.pace*4:t.interval=t.tempo*t.noteLength*t.pace*4,P[o.simultaneousPlay]&&(P[o.simultaneousPlay].time=t.time,pi(P[o.simultaneousPlay].id,e),Yt(P[o.simultaneousPlay].id)),n>0&&hi(t,n),t.noteId+=1,t.noteId<t.notes.length?(i&&(t.time+=t.interval),Yt(e)):setTimeout(()=>{P[e]&&Jo(e)},(t.time+t.interval)*1e3)}function gi(e,t){let o=t.name;o=o.replace(/\+/g,"#"),o=o.replace("C-","B"),o=o.replace("D-","C#"),o=o.replace("E-","D#"),o=o.replace("G-","F#"),o=o.replace("A-","G#"),o=o.replace("B-","A#"),o=o.replace("E#","F"),o=o.replace("B#","C"),t.name.indexOf("..")>0?e.extra=1.75*e.noteLength:t.name.indexOf(".")>0&&(e.extra=1.5*e.noteLength),o=o.replace(/\./g,"");let n=0;if(Ce[o]){let r=e.octave+e.octaveExtra;r<Ce[o].length&&(n=Ce[o][r])}if(!isNaN(Number(t.val))){let r=m(t.val,1);e.extra=$t(r)}return n}function fi(e,t){switch(t.name){case"MS":e.pace=.75;break;case"MN":e.pace=.875;break;case"ML":e.pace=1;break;case"MU":if(!isNaN(Number(t.val))){let o=m(t.val,0);e.octaveExtra=o}break;case"MY":if(!isNaN(Number(t.val))){let o=m(t.val,25);e.attackRate=o/100}break;case"MX":if(!isNaN(Number(t.val))){let o=m(t.val,25);e.sustainRate=o/100}break;case"MZ":if(!isNaN(Number(t.val))){let o=m(t.val,25);e.decayRate=o/100}break;case"MW":e.fullNote=!e.fullNote;break}}function mi(e,t){if(t.name==="WS")e.type="sine";else if(t.name==="WQ")e.type="square";else if(t.name==="WW")e.type="sawtooth";else if(t.name==="WT")e.type="triangle";else if(!isNaN(Number(t.val))){let o=m(t.val,-1);e.waveTables[o]&&(e.type=o)}}function hi(e,t){let o=e.volume,n=e.interval*e.attackRate,r=e.interval*e.sustainRate,i=e.interval*e.decayRate,s;e.fullNote&&n+r+i>e.interval?s=e.interval:s=n+r+i;let l,c=null;typeof e.type=="string"?l=e.type:(c=e.waveTables[e.type],Array.isArray(c)?l="custom":(l=c,c=null));let a={frequency:t,volume:o,attackTime:n,sustainTime:r,decayTime:i,stopTime:s,oType:l,waveTables:c,time:e.time,track:e};Se.push(a)}function pi(e,t){let o=P[e],n=P[t];o.decayRate=n.decayRate,o.attackRate=n.attackRate,o.sustainRate=n.sustainRate,o.fullNote=n.fullNote,o.extra=n.extra,o.space=n.space,o.interval=n.interval,o.tempo=n.tempo,o.noteLength=n.noteLength,o.pace=n.pace,o.octave=n.octave,o.octaveExtra=n.octaveExtra,o.volume=n.volume,o.type=n.type}function Jo(e){let t=P[e].trackIds;for(let o=t.length;o>=0;o--)delete P[t[o]];for(let o=se.length-1;o>=0;o--)P[se[o]]||se.splice(o,1)}function $t(e){return e>=1&&e<65?1/e:.875}var at=[],Do=null,en=!1;function tn(){Do=Te(),en=!0,Ii()}I("registerPlugin",yi,["name","version","description","init"]);function yi(e){if(!e.name||typeof e.name!="string"){let o=new TypeError("registerPlugin: Plugin must have a 'name' property.");throw o.code="INVALID_PLUGIN_NAME",o}if(!e.init||typeof e.init!="function"){let o=new TypeError(`registerPlugin: Plugin '${e.name}' must have an 'init' function.`);throw o.code="INVALID_PLUGIN_INIT",o}if(at.find(o=>o.name===e.name)){let o=new Error(`registerPlugin: Plugin '${e.name}' is already registered.`);throw o.code="DUPLICATE_PLUGIN",o}let t={name:e.name,version:e.version||"unknown",description:e.description||"",config:e,initialized:!1};at.push(t),en&&on(t)}I("getPlugins",wi,[]);function wi(){return at.map(e=>({name:e.name,version:e.version,description:e.description,initialized:e.initialized}))}function on(e){if(e.initialized)return;let t={addCommand:I,addScreenCommand:h,addPixelCommand:G,addAACommand:W,addScreenDataItem:b,addScreenDataItemGetter:oe,addScreenInternalCommands:$,addScreenInitFunction:ne,addScreenCleanupFunction:bt,getApi:()=>Do,utils:S};try{e.config.init(t),e.initialized=!0}catch(o){let n=new Error(`registerPlugin: Failed to initialize plugin '${e.name}': ${o.message}`);throw n.code="PLUGIN_INIT_FAILED",n.originalError=o,n}We()}function Ii(){for(let e of at)e.initialized||on(e)}function nn(e){e.loadFont("0,14004,2602800,oidnrt,3po8cff,3vnhgs4,1uv77og,3hpuv70,73g00,3vjgoef,3o00000,0,71ji,k9o000,1sg,1ogoc3p,jp4ir8,19fvt51,31ovfn3,cevfh,31vrooc,1tv52h8,2g0kula,2d2hcsp,8r2jg0,3vvvj,f33opv,8efh0g,3ho84fj,2200idv,2c40237,3r4g000,87000i,3vv901h,3jptvvv,3vnjpsc,0,g8420,22h800,57p9,3p80ea7,237000i,889019,111cc02,0,88420g,g4211,28oc,140011o,1000000,11000,1s00000,400,3333100,sjam9o,1g8423,203i888,1s060ho,hg0654,2fgg1sg,1o2e01p,3p4e07,211hgg0,oi64hg,1h4e13,31g0c,o00100,gg444,41000v,v0010,1088803,2110080,sqb41o,1h4if4,20729oi,1o07421,1o0s94,19701sg,1sgf03p,3p0g03,384p4c0,14if4i8,1o8423,201o84i,s04ihg,2h40842,43o12r,1ul8g25,2blej03,28ka4s0,s97i10,1h4ib3,10729oi,140321g,ho0v21,21014i,14i6025,a4k404,1al9ok0,12a22i4,24k421,7g8og,1s06210,21g1gc3,30g0c2,42300g,2g00000,1v,o40000,1o2f3,10210s9,s003i1,1o0211,251g00c,14s700g,23gg800,6kjo4s,ge4i94,8021,g04,1884218,3180421,21000a,1ul8g01,3294i00,64i8o0,c5310,200ca30,2102ok8,g003j0,3jo0023,221000i,14i6g00,24k400,8lbsk0,a2118,14i70,2e01s44,u02230,20g0630,31g082,622019,1000001,74a5u0,sg83go,3i80i93,30110oi,1oe22jg,joqh07,17hlg4,1o2f39g,33g4u6j,2841o66,gkc971,34g0oie,e411h4,3gsi030,211osh6,423hg0,1g84720,230g8e9,c94jp4,1goi97i,133p0u8,u06pmr,1sjf94j,34i8c93,94hg0c,14i604l,3inbvgk,2603ooc,1tdvstn,3phsif4,2prfurv,2qc67i1,3ooe4n,42rp8k,gs473h,jh8ua3,561igo,ggc231,30gg842,e110oi,14c2229,i8o887,94i9si,1km94jh,301s003,2703o00,40108,3g000f4,u,40g951,108d0kc,630gg0,g84000,2a8i000,92a800,1404g28,2mkll5,1lbfvdv,2rv210g,10g8421,u10g9s,84u118,2hbka50,7oka,1s217g,11bka5e,252h8ka,ka0fg8,n8kat0,21fg0ka,lu000j,30g9s00,7g84,8421o0,g84vg,1v,84210g,1og8000,vg0084,9v210g,1og8722,252hcka,kb421s,u842,352nc00,3u00fo0,7cka5i,42p81v,vg1b,2o01r51,vg03u0,ka5fo0,3u00f,320001v,ka52h8,3o0043h,21o007,843h00,ua52,252nska,9v217s,10g84u0,7,84vvvv,3vvu000,vvvtgo,1goc60o,1goc63f,3vvo000,2e53g,hp5upf,287i90g,10g003s,2h81uh4,44no00,1ska200,18s880,etgg84,1sc94hh,3hh4u94,267k631,15jfk3p,2i9s0fb,1f0004u,2iuo01p,221so70,64i94i,3u0vg7s,gs40,e01088,1o0020g,23g0452,421042,425110,3g0800,5500kk,oi6000,400,c,1gg,12go062,252g1o2,88f000,1ose00",6,6,null,!0),e.loadFont("0,ugs,3gvtm2u,1tvmss7,vtskvf,2v710g0,g8efjg,21008e2,vfl8gs,g8e77p,311o003,f7hg00,3vvpoc7,vvu045,h8igg0,3v1mrdm,3efu71h,1ep4i8o,oi94hg,33oof4j,34233hg,u97i95,cq08mn,2pspiqc,21gsfn3,400233,2v3go40,gsv213,3jggka5,a50180,1val6h8,2h80e9j,94hj4s,3p,3jo08ef,24fjghv,gsvah0,2100842,lfjgg0,82fgg,2000044,v41000,8421,3g00098,1voa800,8477r,3g000vf,2e21000,0,8e7,4200g0,18ka000,kaf,2afih80,gug70b,33000p9,442ac0,gk4aki,1380844,0,ggg841,100g41,211100,k4fh1,1000021,fh0g00,0,2110000,f00000,0,210000g,2222200,1p2jamb,jg08ca,4213s0,1p21332,no0sh0,260k9o0,8ca97o,11o1ug8,u0k9o0,oggf4a,jg1uh1,442100,1p2h74a,jg0sh8,2f0g9o0,84000,2100042,10gg,888820,20g000f,2007o00,10820gg,2200sh0,22200g0,1p2nalq,3g08a8,2hfka40,3oi9729,ng0c98,g828o0,3oi94i9,ng1u94,e42bs0,3si8721,700c98,g9i8s0,252hfka,k80s42,4211o0,s4214i,1301ia5,c52j60,3gg8421,no12ra,2l8ka40,25il9ka,k80sh8,2h8k9o0,3oi9721,700sh8,2h8l9o3,3oi9731,1680sh8,e0k9o0,3ta4210,23g12h8,2h8k9o0,252h8k9,11012h8,2lal980,24ka22h,14812h5,4211o0,3t22222,no1og8,g843g0,210820g,g41o42,4213g0,gkh8g0,0,1v,g82000,7,17k9u0,30g8539,lg0007,h849o0,c216kq,1jc0007,hfk1o0,oi8e21,700006,2h8jo5s,30ga6i9,m80806,4211o0,4030ga,k9pg84,2a62h40,1g84210,23g000d,lalak0,mcka,k80007,h8k9o0,u4i9,323g006,2i93g8e,r6i1,700007,2g70bo0,10gu421,hg0008,2h8kpk0,h8k9,1100008,2lal980,h511,1480008,2h8jo5s,v111,7o0642,o210c0,g84010,2101g42,321300,15c0000,45,h8kbs0,1p2g8jg,309o0i0,i94hs0,o0e8nq,3g0sh6,274hs0,240c13i,13o0o06,274hs0,g0c13i,13o0007,g83gcc,1p2e8nq,3g1207,hfk1o0,1g0e8nq,3g1406,4211o0,1p2c210,23g0o06,4211o0,248a8nq,k80840,e8nq40,c0v43h,7o000c,267khk0,skifki,14o08a0,e8k9o0,12074a,jg0g40,e8k9o0,gk08ka,jg0g40,h8k9o0,1208k9,3g9p245,h8igg0,240h8ka,jg0847,2g83og8,oi8e22,ng12af,24fh0g0,3ome4it,if4c52,e212go,o0c13i,13o0c06,4211o0,88074a,jg0022,h8k9o0,1lc0f4a,k80qj0,pakq40,1p4i7g3,3g00oi9,c07g00,g04442,jg0000,v84000,fg8,g00iq6,r5cecv,15kbdiq,3s84080,842100,aaa2g,2g000k5,555000,1348p26,1268ll5,1l5d9ba,3ctreup,3erm842,4210g8,g84270,210g84e,4e10g8,ka52n8,2h8k000,fh8ka,s270,210ga5e,21eh8ka,ka52h8,2h8k00f,21eh8ka,kat0no,a52,25fg000,g8s270,0,e10g8,g8421s,842,4fo000,7s,210g842,43p0g8,7s,842,4fp0g8,g87i1s,210ga52,252p8ka,ka5i1s,3,342p8ka,katg7s,f,30ep8ka,ka5i1c,2h8k00f,30fo000,katg7c,2h8k84f,30fo000,ka52ns,f,30fp0g8,7s,2h8ka52,253o000,g87i1s,3,343p0g8,1s,2h8ka52,25fp8ka,g8vi7s,210g842,4e0000,1s,210hvvv,3vvvvvv,7v,3vvvose,se73ho,e73hos,1osfvvv,3vg0000,cqki,2i400e8,2u8ni10,1uh842,4000fq,252h8k0,3t28322,no0007,2ka5100,i94jl,2200cp,2210g80,3s8e8k9,313sc98,1voa8o0,oigoa9,mc0e83,f8c5s0,impdd,g00117,2iqbp10,oggf41,1g0sh8,2h8ka40,v07o1,3o0084f,24203s0,g41110,7o0888,8203s0,c94i10,210g842,4252go,oc0fo0,31g00cp,206co00,oi9300,0,630000,1g,721,216h8c,3h4i94g,oi2,8f0000,e73h,3000000",6,8,null,!0),e.loadFont("0,0,1v839c1,2upj0bu,1vfvmvv,31ufvru,1mftvnu,1u3g400,83gv7u,1u3g400,s7oe7u,3v7oe3s,810e3s,3v7oe3s,61s,u1g000,3vvvpu3,31ufvvv,3opi2,116cf00,3vs76dt,2upjgvv,7ge3rt,36cpj3o,u6cpj6,u1gvgo,vj6fpg,o71s70,1vm6vr3,1hmfpm0,2clkf77,3jjomkp,20e1u7u,3se1000,10sfnu,v0s0g0,c3ovgo,c7sf0o,1j6cpj6,1j00pg0,1vtnmrr,dhm6o0,v66e3c,1m3hj3o,0,1v7svg0,c3ovgo,1v3o67v,c3ovgo,c1g600,c1g60o,1v3o600,1g37u,61g000,30o7u,1g30000,1g60,30fs000,28pnv,1j28000,1gf3u,3vvu000,fvvru,u1g000,0,0,o7gu1g,o00c00,1m6or00,0,1m6pvjc,3v6or00,o7pg3o,6fgc00,cdj0o,o6dhg0,s6oe3m,3ecotg0,1g61g00,0,c30o30,1g30600,1g3060o,c30o00,6cf7v,u6c000,30c7s,o30000,0,30c30,7s,0,0,30c00,30o61g,1gc1000,1ucdjmu,3recv00,o70c1g,o31v00,1sco31o,1gcpv00,1sco31o,6cou00,e3or6c,3v0o7g0,3uc1u0c,6cou00,s61g7o,36cou00,3uco30o,o30c00,1scpj3o,36cou00,1scpj3s,61gs00,30c00,30c00,30c00,30c30,c30o60,1g30600,1v00,fo000,1g3060c,c30o00,1sco30o,o00c00,1ucdnmu,3fc0u00,o7hj6c,3ucpj00,3u6cpjs,1j6dv00,u6dg60,306cf00,3s6opj6,1j6pu00,3v64q3o,1k65vg0,3v64q3o,1k61s00,u6dg60,376cfg0,36cpj7s,36cpj00,1s30c1g,o30u00,f0o30c,36cou00,3j6cr3o,1m6dpg0,3o60o30,1h6dvg0,33etvnu,3bcdhg0,33edtmu,37cdhg0,s6phm6,336oe00,3u6cpjs,1g61s00,1scpj6c,3e7g700,3u6cpjs,1m6dpg0,1scpo3g,ecou00,3ub8c1g,o30u00,36cpj6c,36cpv00,36cpj6c,367gc00,33cdhmm,3vethg0,33ccr1o,s6phg0,36cpj3o,o30u00,3vcd30o,p6dvg0,1s60o30,1g60u00,3060c0o,60c0g0,1s1g60o,c1gu00,83gr66,0,0,7v,o30600,0,u0c,1ucotg0,3g60o3s,1j6dn00,u6c,30cou00,e0o33s,36cotg0,u6c,3uc0u00,s6oo7g,1g61s00,tmc,367o37o,3g60r3m,1j6dpg0,o00s1g,o30u00,60030c,6cpj3o,3g60pjc,1s6ppg0,1o30c1g,o30u00,1j7u,3vddhg0,1u6c,36cpj00,u6c,36cou00,1n36,1j7oo7g,tmc,367o30u,1n3m,1j61s00,v60,1s0pu00,830v1g,o38600,1j6c,36cotg0,1j6c,367gc00,1hmm,3vfsr00,1hjc,s6phg0,1j6c,367o37o,1v4o,o69v00,e30c70,o30700,c1g600,c1g600,3g30c0s,o31o00,1rdo000,0,10e3c,33cdvg0,1scpg6c,1s1g33o,co06c,36covg0,e00u6c,3uc0u00,1vc6f06,v6cfo0,3600u0c,1ucovg0,3g00u0c,1ucovg0,o30u0c,1ucovg0,u60,307g31o,1vc6f36,1v60f00,3600u6c,3uc0u00,3g00u6c,3uc0u00,3600s1g,o30u00,1ucce0o,c1gf00,3g00s1g,o30u00,333gr66,3vcdhg0,o3003o,36fpj00,e01v30,1s61v00,voc,1vsovo0,v6pj7u,36cpjg0,1sco03o,36cou00,co03o,36cou00,e003o,36cou00,1sco06c,36covg0,e006c,36covg0,co06c,367o37o,31hgf36,1j3o600,3601j6c,36cou00,c1gvm0,307s60o,s6op7g,1gedv00,36cou7s,ofoc1g,3scpj7q,33cvhm7,71m61s,c1hm3g,e00u0c,1ucovg0,s00s1g,o30u00,1o03o,36cou00,1o06c,36covg0,fg07o,36cpj00,3u01j7c,3udpj00,u6or1u,7s000,s6or1o,7o000,o00c30,30cou00,7s,30c0000,7s,60o000,31sdj6u,pmdj0f,31sdj6r,rmvjo3,c1g00o,c1g600,36pmc,1j36000,cophj,1jco000,h8g8k8,h8g8k8,1aqklda,1aqklda,3dnfmve,3dnfmve,c1g60o,c1g60o,c1g60o,3s1g60o,c1hu0o,3s1g60o,r3cdhm,3r3cdhm,0,3v3cdhm,1u0o,3s1g60o,r3dtg6,3r3cdhm,r3cdhm,r3cdhm,1vg6,3r3cdhm,r3dtg6,3v00000,r3cdhm,3v00000,c1hu0o,3s00000,0,3s1g60o,c1g60o,fg0000,c1g60o,3vg0000,0,3vhg60o,c1g60o,fhg60o,0,3vg0000,c1g60o,3vhg60o,c1g7oo,fhg60o,r3cdhm,rjcdhm,r3cdpg,vg0000,fpg,rjcdhm,r3dto0,3vg0000,1vo0,3rjcdhm,r3cdpg,rjcdhm,1vo0,3vg0000,r3dto0,3rjcdhm,c1hvo0,3vg0000,r3cdhm,3vg0000,1vo0,3vhg60o,0,3vjcdhm,r3cdhm,vg0000,c1g7oo,fg0000,7oo,fhg60o,0,vjcdhm,r3cdhm,3vjcdhm,c1hvoo,3vhg60o,c1g60o,3s00000,0,fhg60o,3vvvvvv,3vvvvvv,0,3vvvvvv,3of1s7g,3of1s7g,7gu3of,7gu3of,3vvvvvv,0,tms,34dotg0,7hj7o,36fhg60,fpj60,30c1g00,fsr3c,1m6or00,3ucoo1g,1gcpv00,vmo,3cdgs00,6cpj6,1j7oo60,7dn0o,c1g600,3u30u6c,367gc7s,s6phnu,336oe00,s6phm6,1m6prg0,e3063s,36cou00,vmr,3dns000,30ovmr,3dnso60,s61g7o,3060e00,1scpj6c,36cpj00,fo07s,fo000,o31v1g,o01v00,1g3061g,1g01v00,c30o1g,c01v00,71m6oo,c1g60o,c1g60o,cdhm3g,o3007s,30c00,7dn00,1rdo000,s6or1o,0,o,c00000,0,c00000,7go30c,3m6of0s,1s6or3c,1m00000,1o1gc30,1s00000,f1s,u3o000",8,8,null,!0),e.loadFont("0,0,0,0,1v839c1,20rr6c1,1v00000,vnv,3dvvvu3,3jvuvg0,0,6pvnu,3vfsv1o,800000,g,s7pvjs,s10000,0,c3of77,3jue60o,u00000,61s,1vfvvru,c1gf00,0,o,u3o600,0,3vvvvvv,3vufgu3,3jvvvvv,3vvu000,f36,1144phs,0,3vvvvvv,31pjfdt,2cs7vvv,3vvu000,f0s6hi,1scpj6c,1s00000,f36,1j6cf0o,1v1g600,0,vj6fpg,o30s7g,3g00000,vr3,1vm6or3,1jufpm0,0,c1hmps,3jjpmoo,c00000,1060,3gfhvno,3gc1000,0,10c3hu,3v3s3g6,100000,61s,1v1g60o,1v3o600,0,1j6cpj6,1j6c036,1j00000,vur,3dtmuor,dhm6o0,3s,3360e3c,33ccr1o,6ccv00,0,0,3vftvg0,0,c3ovgo,c1gvhs,c7s000,61s,1v1g60o,c1g600,0,c1g60o,c1gvhs,c00000,0,c0pvgc,c00000,0,c30,3v60c00,0,0,c1g60,3v00000,0,a3c,3v6oa00,0,g,s3gv3s,3vfs000,0,ftvjs,1u3ge0g,0,0,0,0,0,c3of1s,c1g00o,c00000,6cpj6,i00000,0,0,1m6pvjc,1m6pvjc,1m00000,c1gv66,31c0v06,23ccv0o,c00000,1gm6,61gc36,3300000,e3c,1m3gtms,36cotg0,1g,o30o00,0,0,30o,o30c1g,o1g300,0,o1g30c,60o30o,o00000,0,1j3pvps,1j00000,0,60o,1v1g600,0,0,0,c1g61g,0,0,3v00000,0,0,0,1g600,0,10c30o,o61g40,0,v66,37dttn6,33ccv00,0,c3gu0o,c1g60o,1v00000,v66,30o61g,1gcdvg0,0,1ucc1g6,u0c1m6,1u00000,30s,u6pj7u,60o7g0,0,3vc1g60,3u0c1m6,1u00000,e30,30c1v66,33ccv00,0,3vcc1gc,c30c1g,o00000,v66,33ccv66,33ccv00,0,1ucdhm6,1v0c1gc,1s00000,o,c00000,c1g000,0,1g600,60o,o00000,1gc,c30o1g,c0o1g0,0,3u,vg0,0,o1g,c0o1gc,c30o00,0,1ucdhgc,c1g00o,c00000,v66,33dtnmu,3ec0v00,0,83gr66,33fthm6,3300000,1v36,1j6cv36,1j6dv00,0,u6dgm0,30c1gj6,u00000,1u3c,1j6cpj6,1j6pu00,0,3v6coj8,1s6goj6,3v00000,1vj6,1h6gu38,1g61s00,0,u6dgm0,30dthj6,t00000,1hm6,33cdvm6,33cdhg0,0,u1g60o,c1g60o,u00000,7gc,60o30c,36cou00,0,3j6cr3c,1s6or36,3j00000,1s30,1g60o30,1h6dvg0,0,33etvnu,3bcdhm6,3300000,1hn6,3rftnme,33cdhg0,0,s6phm6,33cdhjc,s00000,1v36,1j6cv30,1g61s00,0,1ucdhm6,33ddnjs,60s000,1v36,1j6cv3c,1j6dpg0,0,1ucdhj0,s0phm6,1u00000,vju,1d1g60o,c1gf00,0,33cdhm6,33cdhm6,1u00000,1hm6,33cdhm6,1m3g400,0,33cdhm6,3bddvjs,1m00000,1hm6,1m3ge1o,1mcdhg0,0,1j6cpj6,u1g60o,u00000,1vm6,261gc30,31cdvg0,0,u30c1g,o30c1g,u00000,1060,3g70e0s,70c0g0,0,u0o30c,60o30c,u00000,83gr66,0,0,0,0,0,1vo0,o30600,0,0,0,3o,67pj6c,1r00000,1o30,1g7gr36,1j6cv00,0,3s,33c1g66,1u00000,70c,63or6c,36cotg0,0,3s,33ftg66,1u00000,e3c,1i61s30,1g61s00,0,3m,36cpj3s,6cou00,1o30,1g6otj6,1j6dpg0,0,c1g01o,c1g60o,u00000,1g6,s1g6,30cpj6,u00000,3g60o36,1m7gr36,3j00000,e0o,c1g60o,c1gf00,0,7c,3vddlmm,3300000,0,dopj6,1j6cpg0,0,3s,33cdhm6,1u00000,0,dopj6,1j7oo30,3o00000,3m,36cpj3s,60o7g0,0,dotj6,1g61s00,0,3s,3370766,1u00000,41g,ofoc1g,o3c700,0,6c,36cpj6c,1r00000,0,6cpj6,1j3o600,0,66,33ddlnu,1m00000,0,ccr1o,s6phg0,0,66,33cdhju,30pu00,0,ftj0o,o6dvg0,0,71g60o,1o1g60o,700000,60o,c1g00o,c1g600,0,1o1g60o,71g60o,1o00000,tms,0,0,0,41o,1mcdhnu,0,f36,31c1g62,1j3o306,1u00000,36co06c,36cpj6c,1r00000,o61g,7phnu,30ccv00,g,s6o03o,67pj6c,1r00000,1j6c,7g33s,36cotg0,30,o1g03o,67pj6c,1r00000,3gr1o,7g33s,36cotg0,0,f36,1g6cf0c,33o000,10e3c,7phnu,30ccv00,0,36co03s,33ftg66,1u00000,60c0o,7phnu,30ccv00,0,1j6c01o,c1g60o,u00000,1gf36,3g60o,c1gf00,30,o1g01o,c1g60o,u00000,cdhgg,s6phm6,3vcdhg0,e3c,s00e3c,33cdvm6,3300000,c30o00,3v6co3s,1g6dvg0,0,1j3m,r7tm6o,1n00000,fjc,36cpvmc,36cpjg0,g,s6o03s,33cdhm6,1u00000,1hm6,7phm6,33ccv00,30,o1g03s,33cdhm6,1u00000,30u6c,cpj6c,36cotg0,30,o1g06c,36cpj6c,1r00000,1hm6,cdhm6,337s1gc,1s00066,333gr66,33cdhjc,s00000,cdhg0,33cdhm6,33ccv00,o,c3opj0,1g6cf0o,c00000,3gr34,1gf0o30,1gedv00,0,1j6cf0o,1v1gvgo,c00000,fhj6c,3sc9j6u,36cphg0,e,dhg60o,1v1g60o,cdgs00,1gc30,7g33s,36cotg0,c,c3001o,c1g60o,u00000,1gc30,7phm6,33ccv00,o,o6006c,36cpj6c,1r00000,tms,dopj6,1j6cpg0,tms,cdpnm,3vdtjm6,3300000,3or3c,v00vg0,0,1o,1m6oe00,1u00000,0,c1g,30c30,33ccv00,0,0,3vc1g60,0,0,1vg6,30c000,60,30cdj6o,o61n46,61gfg0,c1g66,36dgc36,379sfg6,300000,c1g00o,c3of1s,c00000,0,r6pm3c,r00000,0,1m3c,r6pm00,0,8k84a4,8k84a4,8k84a4,8k8lda,1aqklda,1aqklda,1aqklda,3enfnbn,3enfnbn,3enfnbn,3ene60o,c1g60o,c1g60o,c1g60o,c1g60o,c1g67o,c1g60o,c1g60o,c1g67o,cfg60o,c1g60o,r3cdhm,r3cdnm,r3cdhm,r3c000,0,fsdhm,r3cdhm,0,fg67o,c1g60o,c1gdhm,r3cdnm,3fcdhm,r3cdhm,r3cdhm,r3cdhm,r3cdhm,r3c000,7u,3fcdhm,r3cdhm,r3cdhm,rfc1nu,0,dhm,r3cdhm,rfs000,0,c1g60o,cfg67o,0,0,0,fg60o,c1g60o,c1g60o,c1g60v,0,60o,c1g60o,cfu000,0,0,7v,c1g60o,c1g60o,c1g60o,c1u60o,c1g60o,0,7v,0,60o,c1g60o,cfu60o,c1g60o,c1g60o,c1u60v,c1g60o,c1gdhm,r3cdhm,r3edhm,r3cdhm,r3cdhm,r3ec1v,0,0,1v,o3edhm,r3cdhm,r3cdhm,rfe07v,0,0,7v,fedhm,r3cdhm,r3cdhm,r3ec1n,r3cdhm,r3c000,7v,fu000,0,r3cdhm,rfe07n,r3cdhm,r3c60o,c1g67v,fu000,0,r3cdhm,r3cdnv,0,0,7v,fu60o,c1g60o,0,7v,r3cdhm,r3cdhm,r3cdhm,r3u000,0,c1g60o,c1u60v,0,0,v,c1u60o,c1g60o,0,1v,r3cdhm,r3cdhm,r3cdhm,rfudhm,r3cdhm,c1g60o,cfu67v,c1g60o,c1g60o,c1g60o,cfg000,0,0,v,c1g60o,c1hvvv,3vvvvvv,3vvvvvv,3vvvvvv,0,7v,3vvvvvv,3vvvs7g,3of1s7g,3of1s7g,3of1s7g,7gu3of,7gu3of,7gu3of,7gvvvv,3vvvvvv,3vg0000,0,0,7dn6o,3cdotg0,0,v66,3ucdhns,30c0g00,1vm6,33c1g60,30c1g00,0,1vjc,1m6or3c,1m00000,1vm6,1g3061g,1gcdvg0,0,3u,3cdhm6o,1o00000,0,1j6cpj6,1u60o60,0,tms,c1g60o,c00000,vgo,u6cpj6,u1gvg0,0,s6phm6,3vcdhjc,s00000,e3c,33cdhjc,1m6prg0,0,f3060c,v6cpj6,u00000,0,7tmur,1v00000,0,1gcvmr,3dv6vj0,3000000,71g,1g60v30,1g30700,0,7phm6,33cdhm6,3300000,7u,1vg0,fs000,0,1g63u,c1g000,3vg0000,c0o,60c30o,o00vg0,0,61gc30,o1g300,1v00000,3gr,dhg60o,c1g60o,c1g60o,c1g60o,c1hm6o,1o00000,o,c00vg0,c1g000,0,tms,7dn00,0,3gr3c,s00000,0,0,0,c1g000,0,0,o,0,f,60o30c,6eor1s,e00000,dgr3c,1m6or00,0,3g,3c30o68,3s00000,0,0,1u7ov3s,1u7o000,0",8,14,null,!0),e.loadFont("0,0,0,0,vk1,2io30dt,2co30bu,0,vnv,3dvvvu3,3jvvvru,0,0,1mftvnu,3v7oe0g,0,0,83gv7u,1u3g400,0,o,u3ppv7,3jhg61s,0,o,u7tvvv,1v1g61s,0,0,0,0,0,3vvvvvv,3vvvpu3,31ufvvv,3vvvvvv,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,vr3,1vm6or3,1hmfpv6,3000000,o,cdmf77,udm60o,0,81g70,3ofhvno,3oe1g40,0,41ge,f3tvhu,f0s1g2,0,61s,1v1g60o,1v3o600,0,pj6,1j6cpj6,1j00pj6,0,vur,3dtmuor,dhm6or,0,7phj0,s6phm6,1m3g366,1u00000,0,0,3vftvnu,0,61s,1v1g60o,1v3o63u,0,61s,1v1g60o,c1g60o,0,60o,c1g60o,c7sf0o,0,0,1g37u,61g000,0,0,30o7u,1g30000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61s,u3o60o,c0060o,0,6cpj6,i00000,0,0,3c,1mfsr3c,1mfsr3c,0,c1gv66,31c0v06,38dhjs,c1g000,0,31cc30o,o61hk6,0,e3c,1m3gtms,36cpj3m,0,30c1g,1g00000,0,0,30o,o30c1g,o3060c,0,c0o,60o30c,60o61g,0,0,6cf7v,u6c000,0,0,1g63u,c1g000,0,0,0,1g60o,o00000,0,7u,0,0,0,0,60o,0,0,10c30o,o61g40,0,f36,31s7mur,31s6phs,0,61o,1s1g60o,c1g63u,0,v66,30o61g,1gc1hnu,0,v66,30cf06,30dhjs,0,30s,u6pj7u,60o30u,0,1vm0,30c1v06,30dhjs,0,e30,30c1v66,33cdhjs,0,1vm6,30c30o,o30c1g,0,v66,33ccv66,33cdhjs,0,v66,33ccvg6,30c33o,0,0,c1g000,1g600,0,0,c1g000,1g61g,0,6,61gc30,o1g306,0,0,7s000,1v00000,0,30,o1g306,61gc30,0,v66,330o60o,c0060o,0,3s,33cdnmu,3fdpg3s,0,41o,1mcdhnu,33cdhm6,0,1v36,1j6cv36,1j6cpns,0,f36,31c1g60,30c4phs,0,1u3c,1j6cpj6,1j6cr7o,0,1vj6,1h6gu38,1g64pnu,0,1vj6,1h6gu38,1g60o7g,0,f36,31c1g6u,33ccphq,0,1hm6,33cdvm6,33cdhm6,0,f0o,c1g60o,c1g61s,0,7gc,60o30c,36cpj3o,0,1pj6,1j6ou3o,1m6cpn6,0,1s30,1g60o30,1g64pnu,0,1gv7,3vvvmu3,31s7gu3,0,1hn6,3rftnme,33cdhm6,0,v66,33cdhm6,33cdhjs,0,1v36,1j6cv30,1g60o7g,0,v66,33cdhm6,33ddnjs,60s000,1v36,1j6cv3c,1j6cpn6,0,v66,3360e0c,3cdhjs,0,1vur,2chg60o,c1g61s,0,1hm6,33cdhm6,33cdhjs,0,1gu3,31s7gu3,31mcf0o,0,1gu3,31s7gur,3dvupj6,0,1gu3,1j3o60o,u6dgu3,0,1gu3,31mcf0o,c1g61s,0,1vu3,230o61g,1gc3gvv,0,f1g,o30c1g,o30c1s,0,40,30e0s1o,e0s1g2,0,f0c,60o30c,60o31s,0,83gr66,0,0,0,0,0,0,fu000,o30600,0,0,0,0,7g33s,36cpj3m,0,1o30,1g7gr36,1j6cpjs,0,0,7phm0,30c1hjs,0,70c,63or6c,36cpj3m,0,0,7phnu,30c1hjs,0,e3c,1i61s30,1g60o7g,0,0,7dj6c,36cpj3s,6cou00,1o30,1g6otj6,1j6cpn6,0,60o,3g60o,c1g61s,0,1g6,s1g6,30c1g6,1j6cf00,1o30,1g6cr3o,1s6opn6,0,e0o,c1g60o,c1g61s,0,0,edvur,3dtnmur,0,0,dopj6,1j6cpj6,0,0,7phm6,33cdhjs,0,0,dopj6,1j6cpjs,1g61s00,0,7dj6c,36cpj3s,60o7g0,0,dotj6,1g60o7g,0,0,7phj0,s0phjs,0,41g,ofoc1g,o30dgs,0,0,cpj6c,36cpj3m,0,0,c7gu3,31mcf0o,0,0,c7gu3,3dtnvr6,0,0,c6phs,c3opm3,0,0,cdhm6,33cdhju,30pu00,0,ftj0o,o61hnu,0,3go,c1gs0o,c1g60e,0,60o,c1g00o,c1g60o,0,s0o,c1g3go,c1g63g,0,tms,0,0,0,0,83gr66,33cdvg0,0,f36,31c1g60,316cf0c,37o000,1j00,cpj6c,36cpj3m,0,o61g,7phnu,30c1hjs,0,10e3c,7g33s,36cpj3m,0,1j00,7g33s,36cpj3m,0,60c0o,7g33s,36cpj3m,0,3gr1o,7g33s,36cpj3m,0,0,u6co30,1j3o306,u00000,10e3c,7phnu,30c1hjs,0,1hg0,7phnu,30c1hjs,0,60c0o,7phnu,30c1hjs,0,pg0,3g60o,c1g61s,0,1gf36,3g60o,c1g61s,0,60c0o,3g60o,c1g61s,0,cc00g,s6phm6,3vcdhm6,0,s6oe00,s6phm6,3vcdhm6,0,c30o00,3v6co3s,1g60pnu,0,0,6seor,1vdhn3n,0,fjc,36cpvmc,36cpj6e,0,10e3c,7phm6,33cdhjs,0,1hg0,7phm6,33cdhjs,0,60c0o,7phm6,33cdhjs,0,30u6c,cpj6c,36cpj3m,0,60c0o,cpj6c,36cpj3m,0,1hg0,cdhm6,33cdhju,30ou00,cc03s,33cdhm6,33cdhjs,0,cc066,33cdhm6,33cdhjs,0,1g63u,31s1g60,31ns60o,0,3gr34,1gf0o30,1g61pns,0,1gr6,u1hvoo,3vhg60o,0,fopj6,1u64pjf,1j6cpnj,0,s6oo,c1gvgo,c1g60o,3c70000,1gc30,7g33s,36cpj3m,0,o61g,3g60o,c1g61s,0,1gc30,7phm6,33cdhjs,0,1gc30,cpj6c,36cpj3m,0,tms,dopj6,1j6cpj6,0,1rdo066,3jfdvmu,37cdhm6,0,3or3c,v00vg0,0,0,3gr3c,s00v00,0,0,c1g,30c30,30cdhjs,0,0,1vm0,30c1g00,0,0,1vg6,30c1g0,0,c1g62,33co61g,1gct6o6,61u000,c1g62,33co61g,1jct5hu,30c000,60o,1g60o,u3of0o,0,0,3cr6o,1m3c000,0,0,dgr1m,1mdg000,0,8k84a4,8k84a4,8k84a4,8k84a4,1aqklda,1aqklda,1aqklda,1aqklda,3enfnbn,3enfnbn,3enfnbn,3enfnbn,c1g60o,c1g60o,c1g60o,c1g60o,c1g60o,c1g67o,c1g60o,c1g60o,c1g60o,cfg67o,c1g60o,c1g60o,r3cdhm,r3cdnm,r3cdhm,r3cdhm,0,7u,r3cdhm,r3cdhm,0,fg67o,c1g60o,c1g60o,r3cdhm,rfc1nm,r3cdhm,r3cdhm,r3cdhm,r3cdhm,r3cdhm,r3cdhm,0,fs1nm,r3cdhm,r3cdhm,r3cdhm,rfc1nu,0,0,r3cdhm,r3cdnu,0,0,c1g60o,cfg67o,0,0,0,7o,c1g60o,c1g60o,c1g60o,c1g60v,0,0,c1g60o,c1g67v,0,0,0,7v,c1g60o,c1g60o,c1g60o,c1g60v,c1g60o,c1g60o,0,7v,0,0,c1g60o,c1g67v,c1g60o,c1g60o,c1g60o,c1u60v,c1g60o,c1g60o,r3cdhm,r3cdhn,r3cdhm,r3cdhm,r3cdhm,r3ec1v,0,0,0,3uc1n,r3cdhm,r3cdhm,r3cdhm,rfe07v,0,0,0,fu07n,r3cdhm,r3cdhm,r3cdhm,r3ec1n,r3cdhm,r3cdhm,0,fu07v,0,0,r3cdhm,rfe07n,r3cdhm,r3cdhm,c1g60o,cfu07v,0,0,r3cdhm,r3cdnv,0,0,0,fu07v,c1g60o,c1g60o,0,7v,r3cdhm,r3cdhm,r3cdhm,r3cdhv,0,0,c1g60o,c1u60v,0,0,0,1u60v,c1g60o,c1g60o,0,1v,r3cdhm,r3cdhm,r3cdhm,r3cdnv,r3cdhm,r3cdhm,c1g60o,cfu67v,c1g60o,c1g60o,c1g60o,c1g67o,0,0,0,v,c1g60o,c1g60o,3vvvvvv,3vvvvvv,3vvvvvv,3vvvvvv,0,7v,3vvvvvv,3vvvvvv,3of1s7g,3of1s7g,3of1s7g,3of1s7g,7gu3of,7gu3of,7gu3of,7gu3of,3vvvvvv,3vvvvo0,0,0,0,7dn6o,3cdhn3m,0,u6c,36cpm6c,33cdhmc,0,1vm6,33c1g60,30c1g60,0,0,3v6or3c,1m6or3c,0,7u,3360c0o,o61hnu,0,0,7tm6o,3cdhm3g,0,0,1j6cpj6,1j7oo30,3000000,0,1rdo60o,c1g60o,0,3u,c3opj6,1j3o63u,0,1o,1mcdhnu,33ccr1o,0,e3c,33cdhjc,1m6or7e,0,7hg,c0ofj6,1j6cphs,0,0,7tmur,3dns000,0,3,37tmur,3pnso60,0,71g,1g60v30,1g60c0s,0,3s,33cdhm6,33cdhm6,0,0,3v0007u,1vg0,0,0,c1gvgo,c0007v,0,1g,c0o1gc,c3003u,0,c,c30o1g,c0o03u,0,3gr,dhg60o,c1g60o,c1g60o,c1g60o,c1g60o,3cdhm3g,0,0,c1g03u,1g600,0,0,7dn00,1rdo000,0,3gr3c,s00000,0,0,0,o,c00000,0,0,0,c00000,0,u30c,60o37c,1m6of0s,0,dgr3c,1m6or00,0,0,71m1g,1gchu00,0,0,0,1u7ov3s,1u7ov00,0",8,16,null,!0),e.setDefaultFont(1)}var xi="2.0.0-alpha.1",Re={version:xi};Dt(Re,F);xt();io();co();Lo();So();Ro();Go();Yo();uo();yo();xo();Fo();Mo();tn();We();nn(Re);typeof window<"u"&&(window.pi=Re,window.$===void 0&&(window.$=Re));var Oi=Re;export{Oi as default,Re as pi};
/**
 * Pi.js - Main Entry Point
 * 
 * Graphics and sound library for retro-style games and demos.
 * 
 * @module pi.js
 * @author Andy Stubbs
 * @license Apache-2.0
 */
//# sourceMappingURL=pi.esm.min.js.map
