/**
 * Pi.js - Graphics and Sound Library
 * @version 2.0.0-alpha.1
 * @author Andy Stubbs
 * @license Apache-2.0
 * @preserve
 */
var z=Object.defineProperty;var K=(e,t)=>{for(var n in t)z(e,n,{get:t[n],enumerable:!0})};var i={nextScreenId:0,screens:{},activeScreen:null,images:{},imageCount:0,defaultPrompt:"\xDB",defaultFont:{},nextFontId:0,fonts:{},defaultPalette:[],defaultColor:7,commands:{},screenCommands:{},defaultPenDraw:null,pens:{},penList:[],blendCommands:{},blendCommandsList:[],defaultBlendCmd:null,settings:{},settingsList:[],volume:.75,isTouchScreen:!1,defaultInputFocus:typeof window<"u"?window:null},y=[];var b={};K(b,{binarySearch:()=>ce,cToHex:()=>x,canAddEventListeners:()=>B,checkColor:()=>Q,clamp:()=>$,colorStringToColor:()=>_,colorStringToHex:()=>Y,compareColors:()=>X,convertToArray:()=>ue,convertToColor:()=>J,copyProperties:()=>le,dataToHex:()=>ee,degreesToRadian:()=>oe,deleteProperties:()=>fe,getInt:()=>pe,getWindowSize:()=>de,hexToColor:()=>O,hexToData:()=>Z,inRange:()=>te,inRange2:()=>ne,isArray:()=>S,isDomElement:()=>A,isFunction:()=>L,isInteger:()=>m,math:()=>me,pad:()=>ie,padL:()=>H,padR:()=>se,queueMicrotask:()=>ge,radiansToDegrees:()=>ae,rgbToColor:()=>I,rgbToHex:()=>F,rndRange:()=>re});var L=e=>typeof e=="function",A=e=>e instanceof Element,S=Array.isArray,m=Number.isInteger,B=e=>typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function";function O(e){let t,n,r,o,s;return s=e,e.length===4?(t=parseInt(e.slice(1,2),16)*16-1,n=parseInt(e.slice(2,3),16)*16-1,r=parseInt(e.slice(3,4),16)*16-1):(t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16)),e.length===9?(s=e.slice(0,7),o=parseInt(e.slice(7,9),16)):o=255,{r:t,g:n,b:r,a:o,s:`rgba(${t},${n},${r},${Math.round(o/255*1e3)/1e3})`,s2:s}}function x(e){m(e)||(e=Math.round(e)),e=$(e,0,255);let t=Number(e).toString(16);return t.length<2?"0"+t:t.toUpperCase()}function F(e,t,n,r){return isNaN(r)&&(r=255),"#"+x(e)+x(t)+x(n)+x(r)}function I(e,t,n,r){return O(F(e,t,n,r))}function _(e){let n=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});n.fillStyle=e,n.fillRect(0,0,1,1);let r=n.getImageData(0,0,1,1).data;return I(r[0],r[1],r[2],r[3])}function Y(e){return _(e).s2}function G(e){e=e.slice(e.indexOf("(")+1,e.indexOf(")"));let t=e.split(","),n=[];for(let r=0;r<t.length;r++){let o;r===3?o=parseFloat(t[r].trim())*255:o=parseInt(t[r].trim()),n.push(o)}return n}function J(e){if(e===void 0)return null;if(S(e)&&e.length>2)return I(e[0],e[1],e[2],e[3]);if(m(e?.r)&&m(e?.g)&&m(e?.b))return I(e.r,e.g,e.b,e.a);if(typeof e!="string")return null;if(/(^#[0-9A-F]{8}$)|(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e))return O(e);if(e.indexOf("rgb")===0){let n=G(e);return n.length<3?null:I(n[0],n[1],n[2],n[3])}return _(e)}function Q(e){let t=new Option().style;return t.color=e,t.color!==""}function X(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function Z(e,t,n){e=e.toUpperCase();let r=[],o=0,s="",d=0;for(let g=0;g<n;g++){r.push([]);for(let h=0;h<t;h++){if(d>=s.length){let C=parseInt(e[o],16);isNaN(C)&&(C=0),s=H(C.toString(2),4,"0"),o+=1,d=0}r[g].push(parseInt(s[d])),d+=1}}return r}function ee(e){let t="",n="";for(let r=0;r<e.length;r++)for(let o=0;o<e[r].length;o++)n+=e[r][o],n.length===4&&(t+=parseInt(n,2).toString(16),n="");return t}function $(e,t,n){return Math.min(Math.max(e,t),n)}function te(e,t){return e.x>=t.x&&e.x<t.x+t.width&&e.y>=t.y&&e.y<t.y+t.height}function ne(e,t,n,r,o,s){return e>=n&&e<n+o&&t>=r&&t<r+s}function re(e,t){return Math.random()*(t-e)+e}function oe(e){return e*(Math.PI/180)}function ae(e){return e*(180/Math.PI)}function H(e,t,n){typeof n!="string"&&(n=" ");let r="";e=e+"";for(let o=e.length;o<t;o++)r+=n;return r+e}function se(e,t,n){typeof n!="string"&&(n=" "),e=e+"";for(let r=e.length;r<t;r++)e+=n;return e}function ie(e,t,n){for((typeof n!="string"||n.length===0)&&(n=" "),e=e+"";e.length<t;)e=n+e+n;return e.length>t&&(e=e.substr(0,t)),e}function le(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function ue(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function fe(e){for(let t in e)e.hasOwnProperty(t)&&delete e[t]}function de(){let e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return{width:e,height:t}}function ce(e,t,n){let r=0,o=e.length-1;for(;r<=o;){let s=o+r>>1,d=n(t,e[s],s);if(d>0)r=s+1;else if(d<0)o=s-1;else return s}return-r-1}function pe(e,t){return e=parseInt(e),isNaN(e)&&(e=t),e}var me=Object.freeze({deg30:Math.PI/6,deg45:Math.PI/4,deg60:Math.PI/3,deg90:Math.PI/2,deg120:2*Math.PI/3,deg135:3*Math.PI/4,deg150:5*Math.PI/6,deg180:Math.PI,deg210:7*Math.PI/6,deg225:5*Math.PI/4,deg240:4*Math.PI/3,deg270:3*Math.PI/2,deg300:5*Math.PI/3,deg315:7*Math.PI/4,deg330:11*Math.PI/6,deg360:Math.PI*2}),ge=window.queueMicrotask||(e=>setTimeout(e,0));function E(e,t,n,r,o,s){i.commands[e]=t,n||y.push({name:e,fn:t,isScreen:r,parameters:o||[],isSet:s,noParse:s})}function V(e,t,n,r){E(e,function(o,s){o.pixelMode?t(o,s):n(o,s)},!1,!0,r)}function k(e,t,n,r){i.settings[e]={name:e,fn:t,isScreen:n,parameters:r||[]},i.settingsList.push(e)}function P(e,t){if(e.noParse)return t;if(t.length>0&&typeof t[0]=="object"&&t[0]!==null&&!t[0].hasOwnProperty("screen")&&!S(t[0])&&!A(t[0])){let n=t[0],r=[],o=!1;for(let s=0;s<e.parameters.length;s++)n.hasOwnProperty(e.parameters[s])?(r.push(n[e.parameters[s]]),o=!0):r.push(null);if(o)return r}return t}function W(e,t,n){i.penList.push(e),i.pens[e]={cmd:t,cap:n}}function j(e,t){i.blendCommandsList.push(e),i.blendCommands[e]=t}function U(e){y.sort((t,n)=>{let r=t.name.toUpperCase(),o=n.name.toUpperCase();return r<o?-1:r>o?1:0});for(let t of y)he(e,t)}function he(e,t){if(t.isSet){i.screenCommands[t.name]=t,e[t.name]=function(...n){let r=P(t,n);return i.commands[t.name](null,r)};return}t.isScreen?(i.screenCommands[t.name]=t,e[t.name]=function(...n){let r=P(t,n),o=T(void 0,t.name);if(o!==!1)return i.commands[t.name](o,r)}):e[t.name]=function(...n){let r=P(t,n);return i.commands[t.name](r)}}function T(e,t){if(i.activeScreen===null){if(t==="set")return!1;let n=new Error(`${t}: No screens available for command.`);throw n.code="NO_SCREEN",n}if(e==null&&(e=i.activeScreen.id),m(e)&&!i.screens[e]){let n=new Error(`${t}: Invalid screen id.`);throw n.code="INVALID_SCREEN_ID",n}return i.screens[e]}function q(e){let t=e._.data;e._.addCommand("setScreen",n,!1,!1,["screen"]),e._.addSetting("screen",n,!1,["screen"]);function n(l){let a=l[0],u;if(e.util.isInteger(a)?u=a:a&&e.util.isInteger(a.id)&&(u=a.id),!t.screens[u]){let f=new Error("screen: Invalid screen.");throw f.code="INVALID_SCREEN",f}t.activeScreen=t.screens[u]}e._.addCommand("removeAllScreens",r,!1,!1,[]);function r(){for(let l in t.screens)t.screens[l].screenObj.removeScreen();t.nextScreenId=0}e._.addCommand("getScreen",o,!1,!1,["screenId"]);function o(l){let a=l[0];return T(a,"getScreen").screenObj}e._.addCommand("setDefaultColor",s,!1,!1,["color"]),e._.addSetting("defaultColor",s,!1,["color"]);function s(l){let a=l[0];if(!isNaN(Number(a))&&t.defaultPalette.length>a)t.defaultColor=a;else{if(a=e.util.convertToColor(a),a===null){let u=new TypeError("setDefaultColor: invalid color value for parameter color.");throw u.code="INVALID_COLOR",u}t.defaultColor=a}}e._.addCommand("setDefaultPal",d,!1,!1,["pal"]),e._.addSetting("defaultPal",d,!1,["pal"]);function d(l){let a=l[0];if(!e.util.isArray(a)){let f=new TypeError("setDefaultPal: parameter pal is not an array.");throw f.code="INVALID_PARAMETER",f}if(a.length<1){let f=new RangeError("setDefaultPal: parameter pal must have at least one color value.");throw f.code="EMPTY_PALETTE",f}t.defaultPalette=[],a.length>1?t.defaultColor=1:t.defaultColor=0;for(let f=0;f<a.length;f++){let c=e.util.convertToColor(a[f]);c===null?(console.warn("setDefaultPal: invalid color value inside array pal."),t.defaultPalette.push(e.util.convertToColor("#000000"))):t.defaultPalette.push(c)}let u=t.defaultPalette[0];t.defaultPalette[0]=e.util.convertToColor([u.r,u.g,u.b,0])}e._.addCommand("getDefaultPal",g,!1,!1,[]);function g(){let l=[];for(let a of t.defaultPalette)l.push(a);return l}e._.addCommand("setDefaultInputFocus",h,!1,!1,["element"]),e._.addSetting("defaultInputFocus",h,!1,["element"]);function h(l){let a=l[0];if(typeof a=="string"&&(a=document.getElementById(a)),!a||!e.util.canAddEventListeners(a)){let u=new TypeError("setDefaultInputFocus: Invalid argument element. Element must be a DOM element or string id of a DOM element.");throw u.code="INVALID_ELEMENT",u}a.tabIndex>=0||(a.tabIndex=0),t.defaultInputFocus=a,t.commands.reinitKeyboard&&t.commands.reinitKeyboard()}e._.addCommand("set",C,!1,!0,t.settingsList,!0);function C(l,a){let u=a[0];for(let f in u)if(t.settings[f]){let c=t.settings[f],p=u[f];!e.util.isArray(p)&&typeof p=="object"?p=e._.parseOptions(c,[p]):p=[p],c.isScreen?(l||(l=T(void 0,`set ${c.name}`)),c.fn(l,p)):c.fn(p)}}}var Ie="2.0.0-alpha.1",D=0,N=!1,M=[],v=0;function Pe(){D++,N=!0}function we(){D--,D===0&&R()}function R(){if(document.readyState!=="loading"&&D===0){N=!1;let e=M.slice();M.length=0;for(let t of e)t()}else clearTimeout(v),v=setTimeout(R,10)}var w={version:Ie,_:{data:i,addCommand:E,addCommands:V,addSetting:k,addPen:W,addBlendCommand:j,parseOptions:P,wait:Pe,resume:we},util:b};E("ready",ye,!1,!1,["fn"]);function ye(e){let t=e[0];L(t)&&(N?M.push(t):document.readyState==="loading"?(M.push(t),clearTimeout(v),v=setTimeout(R,10)):t())}q(w);U(w);typeof window<"u"&&(window.pi=w,window.$===void 0&&(window.$=w));var Me=w;export{Me as default,w as pi};
/**
 * Pi.js - Main Entry Point
 * 
 * Graphics and sound library for retro-style games and demos.
 * Modernized architecture with legacy API compatibility.
 * 
 * @module pi.js
 * @author Andy Stubbs
 * @license Apache-2.0
 */
//# sourceMappingURL=pi.esm.min.js.map
